window.GibberishAES=(function(){var p=14,v=8,f=false,O=function(P){try{return unescape(encodeURIComponent(P));}catch(Q){throw"Error on UTF-8 encode";}},L=function(P){try{return decodeURIComponent(escape(P));}catch(Q){throw ("Bad Key");}},C=function(R){var S=[],Q,P;if(R.length<16){Q=16-R.length;S=[Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q];}for(P=0;P<R.length;P++){S[P]=R[P];}return S;},h=function(T,R){var P="",S,Q;if(R){S=T[15];if(S>16){throw ("Decryption error: Maybe bad key");}if(S==16){return"";}for(Q=0;Q<16-S;Q++){P+=String.fromCharCode(T[Q]);}}else{for(Q=0;Q<16;Q++){P+=String.fromCharCode(T[Q]);}}return P;},r=function(R){var P="",Q;for(Q=0;Q<R.length;Q++){P+=(R[Q]<16?"0":"")+R[Q].toString(16);}return P;},D=function(Q){var P=[];Q.replace(/(..)/g,function(R){P.push(parseInt(R,16));});return P;},o=function(P,S){var R=[],Q;if(!S){P=O(P);}for(Q=0;Q<P.length;Q++){R[Q]=P.charCodeAt(Q);}return R;},c=function(P){switch(P){case 128:p=10;v=4;break;case 192:p=12;v=6;break;case 256:p=14;v=8;break;default:throw ("Invalid Key Size Specified:"+P);}},t=function(Q){var P=[],R;for(R=0;R<Q;R++){P=P.concat(Math.floor(Math.random()*256));}return P;},q=function(T,V){var W=p>=12?3:2,U=[],R=[],P=[],X=[],Q=T.concat(V),S;P[0]=GibberishAES.Hash.MD5(Q);X=P[0];for(S=1;S<W;S++){P[S]=GibberishAES.Hash.MD5(P[S-1].concat(Q));X=X.concat(P[S]);}U=X.slice(0,4*v);R=X.slice(4*v,4*v+16);return{key:U,iv:R};},b=function(T,S,Q){S=G(S);var V=Math.ceil(T.length/16),U=[],R,P=[];for(R=0;R<V;R++){U[R]=C(T.slice(R*16,R*16+16));}if(T.length%16===0){U.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]);V++;}for(R=0;R<U.length;R++){U[R]=(R===0)?B(U[R],Q):B(U[R],P[R-1]);P[R]=d(U[R],S);}return P;},y=function(V,W,R,S){W=G(W);var X=V.length/16,Q=[],T,P=[],U="";for(T=0;T<X;T++){Q.push(V.slice(T*16,(T+1)*16));}for(T=Q.length-1;T>=0;T--){P[T]=F(Q[T],W);P[T]=(T===0)?B(P[T],R):B(P[T],Q[T-1]);}for(T=0;T<X-1;T++){U+=h(P[T]);}U+=h(P[T],true);return S?U:L(U);},d=function(S,R){f=false;var Q=J(S,R,0),P;for(P=1;P<(p+1);P++){Q=K(Q);Q=a(Q);if(P<p){Q=N(Q);}Q=J(Q,R,P);}return Q;},F=function(S,R){f=true;var Q=J(S,R,p),P;for(P=p-1;P>-1;P--){Q=a(Q);Q=K(Q);Q=J(Q,R,P);if(P>0){Q=N(Q);}}return Q;},K=function(T){var R=f?A:M,P=[],Q;for(Q=0;Q<16;Q++){P[Q]=R[T[Q]];}return P;},a=function(S){var P=[],R=f?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11],Q;for(Q=0;Q<16;Q++){P[Q]=S[R[Q]];}return P;},N=function(Q){var P=[],R;if(!f){for(R=0;R<4;R++){P[R*4]=z[Q[R*4]]^e[Q[1+R*4]]^Q[2+R*4]^Q[3+R*4];P[1+R*4]=Q[R*4]^z[Q[1+R*4]]^e[Q[2+R*4]]^Q[3+R*4];P[2+R*4]=Q[R*4]^Q[1+R*4]^z[Q[2+R*4]]^e[Q[3+R*4]];P[3+R*4]=e[Q[R*4]]^Q[1+R*4]^Q[2+R*4]^z[Q[3+R*4]];}}else{for(R=0;R<4;R++){P[R*4]=m[Q[R*4]]^k[Q[1+R*4]]^E[Q[2+R*4]]^g[Q[3+R*4]];P[1+R*4]=g[Q[R*4]]^m[Q[1+R*4]]^k[Q[2+R*4]]^E[Q[3+R*4]];P[2+R*4]=E[Q[R*4]]^g[Q[1+R*4]]^m[Q[2+R*4]]^k[Q[3+R*4]];P[3+R*4]=k[Q[R*4]]^E[Q[1+R*4]]^g[Q[2+R*4]]^m[Q[3+R*4]];}}return P;},J=function(S,T,Q){var P=[],R;for(R=0;R<16;R++){P[R]=S[R]^T[Q][R];}return P;},B=function(S,R){var P=[],Q;for(Q=0;Q<16;Q++){P[Q]=S[Q]^R[Q];}return P;},G=function(U){var P=[],Q=[],T,V,S,W=[],R;for(T=0;T<v;T++){V=[U[4*T],U[4*T+1],U[4*T+2],U[4*T+3]];P[T]=V;}for(T=v;T<(4*(p+1));T++){P[T]=[];for(S=0;S<4;S++){Q[S]=P[T-1][S];}if(T%v===0){Q=x(w(Q));Q[0]^=H[T/v-1];}else{if(v>6&&T%v==4){Q=x(Q);}}for(S=0;S<4;S++){P[T][S]=P[T-v][S]^Q[S];}}for(T=0;T<(p+1);T++){W[T]=[];for(R=0;R<4;R++){W[T].push(P[T*4+R][0],P[T*4+R][1],P[T*4+R][2],P[T*4+R][3]);}}return W;},x=function(P){for(var Q=0;Q<4;Q++){P[Q]=M[P[Q]];}return P;},w=function(P){var R=P[0],Q;for(Q=0;Q<4;Q++){P[Q]=P[Q+1];}P[3]=R;return P;},M=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],A=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],H=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],z=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,27,25,31,29,19,17,23,21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229],e=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26],g=[0,9,18,27,36,45,54,63,72,65,90,83,108,101,126,119,144,153,130,139,180,189,166,175,216,209,202,195,252,245,238,231,59,50,41,32,31,22,13,4,115,122,97,104,87,94,69,76,171,162,185,176,143,134,157,148,227,234,241,248,199,206,213,220,118,127,100,109,82,91,64,73,62,55,44,37,26,19,8,1,230,239,244,253,194,203,208,217,174,167,188,181,138,131,152,145,77,68,95,86,105,96,123,114,5,12,23,30,33,40,51,58,221,212,207,198,249,240,235,226,149,156,135,142,177,184,163,170,236,229,254,247,200,193,218,211,164,173,182,191,128,137,146,155,124,117,110,103,88,81,74,67,52,61,38,47,16,25,2,11,215,222,197,204,243,250,225,232,159,150,141,132,187,178,169,160,71,78,85,92,99,106,113,120,15,6,29,20,43,34,57,48,154,147,136,129,190,183,172,165,210,219,192,201,246,255,228,237,10,3,24,17,46,39,60,53,66,75,80,89,102,111,116,125,161,168,179,186,133,140,151,158,233,224,251,242,205,196,223,214,49,56,35,42,21,28,7,14,121,112,107,98,93,84,79,70],k=[0,11,22,29,44,39,58,49,88,83,78,69,116,127,98,105,176,187,166,173,156,151,138,129,232,227,254,245,196,207,210,217,123,112,109,102,87,92,65,74,35,40,53,62,15,4,25,18,203,192,221,214,231,236,241,250,147,152,133,142,191,180,169,162,246,253,224,235,218,209,204,199,174,165,184,179,130,137,148,159,70,77,80,91,106,97,124,119,30,21,8,3,50,57,36,47,141,134,155,144,161,170,183,188,213,222,195,200,249,242,239,228,61,54,43,32,17,26,7,12,101,110,115,120,73,66,95,84,247,252,225,234,219,208,205,198,175,164,185,178,131,136,149,158,71,76,81,90,107,96,125,118,31,20,9,2,51,56,37,46,140,135,154,145,160,171,182,189,212,223,194,201,248,243,238,229,60,55,42,33,16,27,6,13,100,111,114,121,72,67,94,85,1,10,23,28,45,38,59,48,89,82,79,68,117,126,99,104,177,186,167,172,157,150,139,128,233,226,255,244,197,206,211,216,122,113,108,103,86,93,64,75,34,41,52,63,14,5,24,19,202,193,220,215,230,237,240,251,146,153,132,143,190,181,168,163],E=[0,13,26,23,52,57,46,35,104,101,114,127,92,81,70,75,208,221,202,199,228,233,254,243,184,181,162,175,140,129,150,155,187,182,161,172,143,130,149,152,211,222,201,196,231,234,253,240,107,102,113,124,95,82,69,72,3,14,25,20,55,58,45,32,109,96,119,122,89,84,67,78,5,8,31,18,49,60,43,38,189,176,167,170,137,132,147,158,213,216,207,194,225,236,251,246,214,219,204,193,226,239,248,245,190,179,164,169,138,135,144,157,6,11,28,17,50,63,40,37,110,99,116,121,90,87,64,77,218,215,192,205,238,227,244,249,178,191,168,165,134,139,156,145,10,7,16,29,62,51,36,41,98,111,120,117,86,91,76,65,97,108,123,118,85,88,79,66,9,4,19,30,61,48,39,42,177,188,171,166,133,136,159,146,217,212,195,206,237,224,247,250,183,186,173,160,131,142,153,148,223,210,197,200,235,230,241,252,103,106,125,112,83,94,73,68,15,2,21,24,59,54,33,44,12,1,22,27,56,53,34,47,100,105,126,115,80,93,74,71,220,209,198,203,232,229,242,255,180,185,174,163,128,141,154,151],m=[0,14,28,18,56,54,36,42,112,126,108,98,72,70,84,90,224,238,252,242,216,214,196,202,144,158,140,130,168,166,180,186,219,213,199,201,227,237,255,241,171,165,183,185,147,157,143,129,59,53,39,41,3,13,31,17,75,69,87,89,115,125,111,97,173,163,177,191,149,155,137,135,221,211,193,207,229,235,249,247,77,67,81,95,117,123,105,103,61,51,33,47,5,11,25,23,118,120,106,100,78,64,82,92,6,8,26,20,62,48,34,44,150,152,138,132,174,160,178,188,230,232,250,244,222,208,194,204,65,79,93,83,121,119,101,107,49,63,45,35,9,7,21,27,161,175,189,179,153,151,133,139,209,223,205,195,233,231,245,251,154,148,134,136,162,172,190,176,234,228,246,248,210,220,206,192,122,116,102,104,66,76,94,80,10,4,22,24,50,60,46,32,236,226,240,254,212,218,200,198,156,146,128,142,164,170,184,182,12,2,16,30,52,58,40,38,124,114,96,110,68,74,88,86,55,57,43,37,15,1,19,29,71,73,91,85,127,113,99,109,215,217,203,197,239,225,243,253,167,169,187,181,159,145,131,141],s=function(T,W,R){var S=t(8),V=q(o(W,R),S),X=V.key,Q=V.iv,P,U=[[83,97,108,116,101,100,95,95].concat(S)];T=o(T,R);P=b(T,X,Q);P=U.concat(P);return I.encode(P);},u=function(R,U,W){var Q=I.decode(R),T=Q.slice(8,16),V=q(o(U,W),T),S=V.key,P=V.iv;Q=Q.slice(16,Q.length);R=y(Q,S,P,W);return R;},l=function(af){function aa(aE,aD){return(aE<<aD)|(aE>>>(32-aD));}function ak(aH,aE){var aJ,aD,aG,aI,aF;aG=(aH&2147483648);aI=(aE&2147483648);aJ=(aH&1073741824);aD=(aE&1073741824);aF=(aH&1073741823)+(aE&1073741823);if(aJ&aD){return(aF^2147483648^aG^aI);}if(aJ|aD){if(aF&1073741824){return(aF^3221225472^aG^aI);}else{return(aF^1073741824^aG^aI);}}else{return(aF^aG^aI);}}function ax(aD,aF,aE){return(aD&aF)|((~aD)&aE);}function aw(aD,aF,aE){return(aD&aE)|(aF&(~aE));}function av(aD,aF,aE){return(aD^aF^aE);}function X(aD,aF,aE){return(aF^(aD|(~aE)));}function ah(aF,aE,aJ,aI,aD,aG,aH){aF=ak(aF,ak(ak(ax(aE,aJ,aI),aD),aH));return ak(aa(aF,aG),aE);}function W(aF,aE,aJ,aI,aD,aG,aH){aF=ak(aF,ak(ak(aw(aE,aJ,aI),aD),aH));return ak(aa(aF,aG),aE);}function aB(aF,aE,aJ,aI,aD,aG,aH){aF=ak(aF,ak(ak(av(aE,aJ,aI),aD),aH));return ak(aa(aF,aG),aE);}function ag(aF,aE,aJ,aI,aD,aG,aH){aF=ak(aF,ak(ak(X(aE,aJ,aI),aD),aH));return ak(aa(aF,aG),aE);}function P(aJ){var aK,aG=aJ.length,aF=aG+8,aE=(aF-(aF%64))/64,aI=(aE+1)*16,aL=[],aD=0,aH=0;while(aH<aG){aK=(aH-(aH%4))/4;aD=(aH%4)*8;aL[aK]=(aL[aK]|(aJ[aH]<<aD));aH++;}aK=(aH-(aH%4))/4;aD=(aH%4)*8;aL[aK]=aL[aK]|(128<<aD);aL[aI-2]=aG<<3;aL[aI-1]=aG>>>29;return aL;}function Y(aF){var aG,aD,aE=[];for(aD=0;aD<=3;aD++){aG=(aF>>>(aD*8))&255;aE=aE.concat(aG);}return aE;}var ai=[],ao,R,aj,Z,Q,aC,aA,az,ay,ar=7,ap=12,am=17,al=22,ae=5,ad=9,ac=14,ab=20,V=4,U=11,T=16,S=23,au=6,at=10,aq=15,an=21;ai=P(af);aC=1732584193;aA=4023233417;az=2562383102;ay=271733878;for(ao=0;ao<ai.length;ao+=16){R=aC;aj=aA;Z=az;Q=ay;aC=ah(aC,aA,az,ay,ai[ao+0],ar,3614090360);ay=ah(ay,aC,aA,az,ai[ao+1],ap,3905402710);az=ah(az,ay,aC,aA,ai[ao+2],am,606105819);aA=ah(aA,az,ay,aC,ai[ao+3],al,3250441966);aC=ah(aC,aA,az,ay,ai[ao+4],ar,4118548399);ay=ah(ay,aC,aA,az,ai[ao+5],ap,1200080426);az=ah(az,ay,aC,aA,ai[ao+6],am,2821735955);aA=ah(aA,az,ay,aC,ai[ao+7],al,4249261313);aC=ah(aC,aA,az,ay,ai[ao+8],ar,1770035416);ay=ah(ay,aC,aA,az,ai[ao+9],ap,2336552879);az=ah(az,ay,aC,aA,ai[ao+10],am,4294925233);aA=ah(aA,az,ay,aC,ai[ao+11],al,2304563134);aC=ah(aC,aA,az,ay,ai[ao+12],ar,1804603682);ay=ah(ay,aC,aA,az,ai[ao+13],ap,4254626195);az=ah(az,ay,aC,aA,ai[ao+14],am,2792965006);aA=ah(aA,az,ay,aC,ai[ao+15],al,1236535329);aC=W(aC,aA,az,ay,ai[ao+1],ae,4129170786);ay=W(ay,aC,aA,az,ai[ao+6],ad,3225465664);az=W(az,ay,aC,aA,ai[ao+11],ac,643717713);aA=W(aA,az,ay,aC,ai[ao+0],ab,3921069994);aC=W(aC,aA,az,ay,ai[ao+5],ae,3593408605);ay=W(ay,aC,aA,az,ai[ao+10],ad,38016083);az=W(az,ay,aC,aA,ai[ao+15],ac,3634488961);aA=W(aA,az,ay,aC,ai[ao+4],ab,3889429448);aC=W(aC,aA,az,ay,ai[ao+9],ae,568446438);ay=W(ay,aC,aA,az,ai[ao+14],ad,3275163606);az=W(az,ay,aC,aA,ai[ao+3],ac,4107603335);aA=W(aA,az,ay,aC,ai[ao+8],ab,1163531501);aC=W(aC,aA,az,ay,ai[ao+13],ae,2850285829);ay=W(ay,aC,aA,az,ai[ao+2],ad,4243563512);az=W(az,ay,aC,aA,ai[ao+7],ac,1735328473);aA=W(aA,az,ay,aC,ai[ao+12],ab,2368359562);aC=aB(aC,aA,az,ay,ai[ao+5],V,4294588738);ay=aB(ay,aC,aA,az,ai[ao+8],U,2272392833);az=aB(az,ay,aC,aA,ai[ao+11],T,1839030562);aA=aB(aA,az,ay,aC,ai[ao+14],S,4259657740);aC=aB(aC,aA,az,ay,ai[ao+1],V,2763975236);ay=aB(ay,aC,aA,az,ai[ao+4],U,1272893353);az=aB(az,ay,aC,aA,ai[ao+7],T,4139469664);aA=aB(aA,az,ay,aC,ai[ao+10],S,3200236656);aC=aB(aC,aA,az,ay,ai[ao+13],V,681279174);ay=aB(ay,aC,aA,az,ai[ao+0],U,3936430074);az=aB(az,ay,aC,aA,ai[ao+3],T,3572445317);aA=aB(aA,az,ay,aC,ai[ao+6],S,76029189);aC=aB(aC,aA,az,ay,ai[ao+9],V,3654602809);ay=aB(ay,aC,aA,az,ai[ao+12],U,3873151461);az=aB(az,ay,aC,aA,ai[ao+15],T,530742520);aA=aB(aA,az,ay,aC,ai[ao+2],S,3299628645);aC=ag(aC,aA,az,ay,ai[ao+0],au,4096336452);ay=ag(ay,aC,aA,az,ai[ao+7],at,1126891415);az=ag(az,ay,aC,aA,ai[ao+14],aq,2878612391);aA=ag(aA,az,ay,aC,ai[ao+5],an,4237533241);aC=ag(aC,aA,az,ay,ai[ao+12],au,1700485571);ay=ag(ay,aC,aA,az,ai[ao+3],at,2399980690);az=ag(az,ay,aC,aA,ai[ao+10],aq,4293915773);aA=ag(aA,az,ay,aC,ai[ao+1],an,2240044497);aC=ag(aC,aA,az,ay,ai[ao+8],au,1873313359);ay=ag(ay,aC,aA,az,ai[ao+15],at,4264355552);az=ag(az,ay,aC,aA,ai[ao+6],aq,2734768916);aA=ag(aA,az,ay,aC,ai[ao+13],an,1309151649);aC=ag(aC,aA,az,ay,ai[ao+4],au,4149444226);ay=ag(ay,aC,aA,az,ai[ao+11],at,3174756917);az=ag(az,ay,aC,aA,ai[ao+2],aq,718787259);aA=ag(aA,az,ay,aC,ai[ao+9],an,3951481745);aC=ak(aC,R);aA=ak(aA,aj);az=ak(az,Z);ay=ak(ay,Q);}return Y(aC).concat(Y(aA),Y(az),Y(ay));},I=(function(){var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=P.split(""),Q=function(T,X){var Y=[],W="",V,U;totalChunks=Math.floor(T.length*16/3);for(V=0;V<T.length*16;V++){Y.push(T[Math.floor(V/16)][V%16]);}for(V=0;V<Y.length;V=V+3){W+=R[Y[V]>>2];W+=R[((Y[V]&3)<<4)|(Y[V+1]>>4)];if(!(Y[V+1]===undefined)){W+=R[((Y[V+1]&15)<<2)|(Y[V+2]>>6)];}else{W+="=";}if(!(Y[V+2]===undefined)){W+=R[Y[V+2]&63];}else{W+="=";}}U=W.slice(0,64)+"\n";for(V=1;V<(Math.ceil(W.length/64));V++){U+=W.slice(V*64,V*64+64)+(Math.ceil(W.length/64)==V+1?"":"\n");}return U;},S=function(U){U=U.replace(/\n/g,"");var W=[],X=[],T=[],V;for(V=0;V<U.length;V=V+4){X[0]=P.indexOf(U.charAt(V));X[1]=P.indexOf(U.charAt(V+1));X[2]=P.indexOf(U.charAt(V+2));X[3]=P.indexOf(U.charAt(V+3));T[0]=(X[0]<<2)|(X[1]>>4);T[1]=((X[1]&15)<<4)|(X[2]>>2);T[2]=((X[2]&3)<<6)|X[3];W.push(T[0],T[1],T[2]);}W=W.slice(0,W.length-(W.length%16));return W;};if(typeof Array.indexOf==="function"){P=R;}return{encode:Q,decode:S};})();return{size:c,h2a:D,expandKey:G,encryptBlock:d,decryptBlock:F,Decrypt:f,s2a:o,rawEncrypt:b,dec:u,openSSLKey:q,a2h:r,enc:s,Hash:{MD5:l},Base64:I};})();if(typeof define==="function"){define(function(){return GibberishAES;});}var FastBase64={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encLookup:[],Init:function(){for(var a=0;a<4096;a++){this.encLookup[a]=this.chars[a>>6]+this.chars[a&63];}},Encode:function(f){var a=f.length;var g="";var d=0;while(a>2){n=(f[d]<<16)|(f[d+1]<<8)|f[d+2];g+=this.encLookup[n>>12]+this.encLookup[n&4095];a-=3;d+=3;}if(a>0){var e=(f[d]&252)>>2;var c=(f[d]&3)<<4;if(a>1){c|=(f[++d]&240)>>4;}g+=this.chars[e];g+=this.chars[c];if(a==2){var b=(f[d++]&15)<<2;b|=(f[d]&192)>>6;g+=this.chars[b];}if(a==1){g+="=";}g+="=";}return g;}};FastBase64.Init();var RIFFWAVE=function(d){d=d||{};this.data=[];this.wav=[];this.dataURI="";this.header=Ext.apply({chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:8000,byteRate:0,blockAlign:0,bitsPerSample:8,subChunk2Id:[100,97,116,97],subChunk2Size:0},d.header);function b(e){return[e&255,(e>>8)&255,(e>>16)&255,(e>>24)&255];}function a(e){return[e&255,(e>>8)&255];}function c(k){var h=[];var f=0;var e=k.length;for(var g=0;g<e;g++){h[f++]=k[g]&255;h[f++]=(k[g]>>8)&255;}return h;}this.Make=function(e){if((d.data instanceof Array)||((typeof(Int16Array)!="undefined")&&(d.data instanceof Int16Array))){this.data=e;this.header.blockAlign=(this.header.numChannels*this.header.bitsPerSample)>>3;this.header.byteRate=this.header.blockAlign*this.header.sampleRate;this.header.subChunk2Size=this.data.length*(this.header.bitsPerSample>>3);this.header.chunkSize=36+this.header.subChunk2Size;}console.debug("RIFFWAVE - "+Ext.encode(this.header));};this.MakeData=function(e){this.wav=this.header.chunkId.concat(b(this.header.chunkSize),this.header.format,this.header.subChunk1Id,b(this.header.subChunk1Size),a(this.header.audioFormat),a(this.header.numChannels),b(this.header.sampleRate),b(this.header.byteRate),a(this.header.blockAlign),a(this.header.bitsPerSample),this.header.subChunk2Id,b(this.header.subChunk2Size),(this.header.bitsPerSample==16)?c(this.data):this.data);this.dataURI="data:audio/wav;base64,"+FastBase64.Encode(this.wav);};if((d.data instanceof Array)||((typeof(Int16Array)!="undefined")&&(d.data instanceof Int16Array))){this.Make(d.data);if(!d.headerOnly){this.MakeData(d.data);}}};if(window.cordova||window.Cordova||window.PhoneGap){(function(b){function a(){}a.prototype.registerDevice=function(d,e,c){b.exec(e,c,"PushNotification","registerDevice",d?[d]:[]);};a.prototype.setTags=function(d,e,c){b.exec(e,c,"PushNotification","setTags",d?[d]:[]);};a.prototype.sendLocation=function(d,e,c){b.exec(e,c,"PushNotification","sendLocation",d?[d]:[]);};a.prototype.onDeviceReady=function(){b.exec(null,null,"PushNotification","onDeviceReady",[]);};a.prototype.unregisterDevice=function(d,c){b.exec(d,c,"PushNotification","unregisterDevice",[]);};a.prototype.createLocalNotification=function(d,e,c){b.exec(e,c,"PushNotification","createLocalNotification",d?[d]:[]);};a.prototype.clearLocalNotification=function(){b.exec(null,null,"PushNotification","clearLocalNotification",[]);};a.prototype.startGeoPushes=function(d,c){b.exec(d,c,"PushNotification","startGeoPushes",[]);};a.prototype.stopGeoPushes=function(d,c){b.exec(d,c,"PushNotification","stopGeoPushes",[]);};a.prototype.setMultiNotificationMode=function(d,c){b.exec(d,c,"PushNotification","setMultiNotificationMode",[]);};a.prototype.setSingleNotificationMode=function(d,c){b.exec(d,c,"PushNotification","setSingleNotificationMode",[]);};a.prototype.setSoundType=function(d,e,c){b.exec(e,c,"PushNotification","setSoundType",[d]);};a.prototype.setVibrateType=function(d,e,c){b.exec(e,c,"PushNotification","setVibrateType",[d]);};a.prototype.setLightScreenOnNotification=function(d,e,c){b.exec(e,c,"PushNotification","setLightScreenOnNotification",[d]);};a.prototype.setEnableLED=function(d,e,c){b.exec(e,c,"PushNotification","setEnableLED",[d]);};a.prototype.sendGoalAchieved=function(d,e,c){b.exec(e,c,"PushNotification","sendGoalAchieved",d?[d]:[]);};a.prototype.startLocationTracking=function(d,e,c){b.exec(e,c,"PushNotification","startLocationTracking",d?[{mode:d}]:[]);};a.prototype.stopLocationTracking=function(d,c){b.exec(d,c,"PushNotification","stopLocationTracking",[]);};a.prototype.getRemoteNotificationStatus=function(c){b.exec(c,c,"PushNotification","getRemoteNotificationStatus",[]);};a.prototype.setApplicationIconBadgeNumber=function(c,d){b.exec(d,d,"PushNotification","setApplicationIconBadgeNumber",[{badge:c}]);};a.prototype.cancelAllLocalNotifications=function(c){b.exec(c,c,"PushNotification","cancelAllLocalNotifications",[]);};a.prototype.notificationCallback=function(d){var c=document.createEvent("HTMLEvents");c.notification=d;c.initEvent("push-notification",true,true,arguments);document.dispatchEvent(c);};b.addConstructor(function(){if(!window.plugins){window.plugins={};}window.plugins.pushNotification=new a();});})(window.cordova||window.Cordova||window.PhoneGap);}window.plugins=window.plugins||{};(function(cordova){var preLoadSendCommon={_mobile:function(cntlr,checkUseProximity,proximityWin,win,fail){var me=gblController,_viewport=cntlr.getViewPortCntlr(),callback=Ext.bind(function(useProximity,_cntlr,_win){_win=_win||Ext.emptyFn;setLoadMask(false);Ext.defer(function(){if(useProximity===true){var proceed,cancel;me.pendingBroadcast=true;$("#earnPtsProceed").one("tap",proceed=function(e){me.pendingBroadcast=false;$("#earnPtsProceed").off("tap",proceed).off("click",proceed);$("#earnPtsCancel").off("tap",cancel);_win(useProximity);return false;}).one("click",proceed);$("#earnPtsCancel").one("tap",cancel=function(e){me.pendingBroadcast=false;$("#earnPtsCancel").off("tap",cancel).off("click",cancel);$("#earnPtsProceed").off("tap",proceed);return false;}).one("click",cancel);$("#earnptspageview").trigger("kickbak:preLoad");}else{$("#earnptspageview").trigger("kickbak:loyalty");}},0.25*1000,_cntlr);},null,[cntlr,win],true);fail=fail||Ext.emptyFn;setLoadMask(true);Ext.defer(function(){if(checkUseProximity){$(document).one("locationupdate",function(position){proximityWin();});_viewport.getGeoLocation();}else{try{var merchant=_viewport.getVenue().getMerchant(),features_config=merchant.get("features_config");if(features_config.enable_mobile){proximityWin();}else{callback(false);}}catch(e){fail();}}},0.25*1000);return callback;},_native:function(cntlr,checkUseProximity,proximityWin,win,fail){var _viewport=cntlr.getViewPortCntlr(),callback=Ext.bind(function(useProximity,_cntlr,_win){var viewport=_cntlr.getViewPortCntlr(),_cleanup=function(){viewport.popUpInProgress=false;_cntlr._actions.hide();_cntlr._actions.destroy();delete _cntlr._actions;};_win=_win||Ext.emptyFn;Ext.Viewport.setMasked(null);Ext.defer(function(){if(!_cntlr._actions){_cntlr._actions=Ext.create("Genesis.view.widgets.PopupItemDetail",(useProximity===true)?{iconType:"prizewon",icon:"phoneInHand",title:cntlr.showToServerMsg(),buttons:[{text:"Cancel",ui:"cancel",handler:_cleanup},{text:"Proceed",ui:"action",handler:function(){_cleanup();_win(useProximity);}}]}:{iconType:"prizewon",icon:"loyaltycard",title:cntlr.showToLoyaltyCardMsg(),buttons:[{text:"Dismiss",ui:"cancel",handler:_cleanup}]});Ext.Viewport.add(_cntlr._actions);}viewport.popUpInProgress=true;_cntlr._actions.show();},0.25*1000);},null,[cntlr,win],true);fail=fail||Ext.emptyFn;Ext.Viewport.setMasked({xtype:"loadmask",message:cntlr.prepareToSendMerchantDeviceMsg});Ext.defer(function(){if(checkUseProximity){_viewport.on("locationupdate",function(position){proximityWin();},null,{single:true});_viewport.getGeoLocation();}else{try{var merchant=_viewport.getVenue().getMerchant(),features_config=merchant.get("features_config");if(features_config.enable_mobile){proximityWin();}else{callback(false);}}catch(e){fail();}}},0.25*1000);return callback;}};if(Genesis.fn.isNative()){window.plugins.proximityID={init:function(s_vol_ratio,r_vol_ratio){cordova.exec(function(){console.log("ProximityIDPlugin Initialized");},function(reason){console.log("Failed to initialize the ProximityIDPlugin! Reason["+reason+"]");},"ProximityIDPlugin","init",[s_vol_ratio+"",r_vol_ratio+""]);window.AudioContext=window.AudioContext||window.webkitAudioContext;},preLoadSend:function(cntlr,checkUseProximity,win,fail){var callback=preLoadSendCommon[(cntlr!==gblController)?"_native":"_mobile"](cntlr,checkUseProximity,function(){Ext.defer(function(){cordova.exec(function(){callback(true);},fail,"ProximityIDPlugin","preLoadIdentity",[]);},0.25*1000,this);},win,fail);},send:function(win,fail){cordova.exec(win,fail,"ProximityIDPlugin","sendIdentity",[]);},scan:function(win,fail,samples,missedThreshold,magThreshold,overlapRatio){cordova.exec(win,fail,"ProximityIDPlugin","scanIdentity",[samples,missedThreshold,magThreshold,overlapRatio]);},stop:function(){cordova.exec(function(){console.log("Stopped ProximityIDPlugin");},function(reason){console.log("Failed to stop the ProximityIDPlugin "+reason);},"ProximityIDPlugin","stop",[]);},setVolume:function(vol){cordova.exec(Ext.emptyFn,Ext.emptyFn,"ProximityIDPlugin","setVolume",[vol]);}};cordova.addConstructor(function(){});}else{_filesAssetCount++;window.plugins.proximityID={loFreq:17000,hiFreq:20000,FREQ_GAP:500,NUM_SIGNALS:3,SHORT_MAX:parseInt(65535/2),sampleRate:44100,duration:1*44100,bufSize:16*1024,bitRate:128,MATCH_THRESHOLD:2,bw:0,sampleConfig:null,freqs:null,context:null,gainNode:null,oscillators:null,audio:null,bytesEncoded:null,unsupportedBrowserMsg:"This browser does not support our Proximity Scanning feature",convertToMono:function(input){var me=this;var splitter=me.context.createChannelSplitter(2);var merger=me.context.createChannelMerger(2);input.connect(splitter);splitter.connect(merger,0,0);splitter.connect(merger,0,1);return merger;},init:function(s_vol_ratio,r_vol_ratio){var me=this;me.bw=(me.hiFreq-me.loFreq)/me.NUM_SIGNALS;Genesis.constants.s_vol=s_vol_ratio*100;Genesis.constants.r_vol=r_vol_ratio*100;window.AudioContext=window.AudioContext||window.webkitAudioContext;console.debug("Initialized Proximity API");},b64toF32:function(input){var binary=atob(input);var len=binary.length;var buffer=new ArrayBuffer(len);var view=new Float32Array(buffer);return view;},generateData:function(offset,length){var me=this,i,c,s_vol=Genesis.constants.s_vol/100,data=new Float32Array(length),_s_vol=s_vol;c=[];for(i=0;i<me.freqs.length;i++){c[i]=2*Math.PI*me.freqs[i]/me.sampleRate;}for(i=0;i<length;i++){for(j=0;j<(me.freqs.length);j++){data[i]+=Math.sin(c[j]*(i+offset));}data[i]=_s_vol*data[i]/(me.freqs.length);}return data;},webAudioFnHandler:function(s_vol,callback){var me=this,context=me.context,gain=me.gainNode;if(!context){context=me.context=new window.AudioContext();context.createGain=context.createGain||context.createGainNode;gain=me.gainNode=context.createGain();gain.connect(context.destination);}me.getFreqs();gain.gain.value=s_vol;me.oscillators=[];for(i=0;i<me.freqs.length;i++){var osc=me.oscillators[i]=context.createOscillator();osc.type=0;osc.frequency.value=me.freqs[i];osc.connect(gain);}console.debug("OSC Gain : "+s_vol);callback(true);},audioFnHandler:function(config,s_vol,win){var me=this,data=config.data=[],_s_vol=s_vol;me.getFreqs();for(var i=0;i<(me.duration);i++){var val=0;for(var j=0;j<me.freqs.length;j++){val+=Math.sin(2*Math.PI*me.freqs[j]*i/me.sampleRate);}val/=me.freqs.length;val=Math.round(_s_vol*((me.SHORT_MAX+1)+(val*me.SHORT_MAX)));data[i]=val;}me.audio=new Audio(new RIFFWAVE(config).dataURI);me.audio.volume=1;console.debug("WAV Gain : "+s_vol);win(true);},mp3WorkerFnHandler:function(e){var me=this;switch(e.data.cmd){case"init":me._duration=me.duration;me.bytesEncoded=Math.min(me._duration,me.bufSize);delete me.sampleConfig.data;_codec.postMessage({cmd:"encode",buf:me.generateData(0,me.bytesEncoded)});break;case"data":if(!me.sampleConfig.data){me.sampleConfig.data=String.fromCharCode.apply(null,e.data.buf);}else{me.sampleConfig.data+=String.fromCharCode.apply(null,e.data.buf);}me._duration-=me.bytesEncoded;if(me._duration>0){me.bytesEncoded=Math.min(me._duration,me.bufSize);_codec.postMessage({cmd:"encode",buf:me.generateData(me.duration-me._duration,me.bytesEncoded)});}else{_codec.postMessage({cmd:"finish"});}break;case"end":me.sampleConfig.data+=String.fromCharCode.apply(null,e.data.buf);me.sampleConfig.data="data:audio/mpeg;base64,"+base64.encode(me.sampleConfig.data);me.audio=new Audio(me.sampleConfig.data);me.audio.volume=1;console.debug("MP3 Gain : "+Genesis.constants.s_vol/100);me.sampleConfig.callback();delete me.sampleConfig;}},mp3FnHandler:function(config,s_vol,useProximity,win){var me=this;if(!_codec.onmessage||(_codec.onmessage==Ext.emptyFn)){_codec.onmessage=Ext.bind(me.mp3WorkerFnHandler,me);}me.getFreqs();config.callback=function(){win(true);};me.sampleConfig=config;_codec.postMessage({cmd:"init",config:{samplerate:me.sampleRate,bitrate:me.bitRate,mode:3,channels:1}});},getFreqs:function(){var me=this,stay,i;do{stay=false;for(i=0;i<me.NUM_SIGNALS-1;i++){me.freqs[i]=parseInt(Math.random()*me.bw)+parseInt(i*me.bw)+parseInt(me.loFreq);}i=me.NUM_SIGNALS-1;me.freqs[i]=parseInt(Math.random()/2*me.bw)+parseInt(i*me.bw)+parseInt(me.loFreq);for(i=0;i<(me.NUM_SIGNALS-1);i++){if((me.freqs[i]+me.FREQ_GAP)>me.freqs[i+1]){stay=true;break;}}}while(stay);},preLoadSend:function(cntlr,checkUseProximity,win,fail){var me=this,s_vol=Genesis.constants.s_vol/100,config={header:{sampleRate:me.sampleRate,numChannels:1,bitsPerSample:16},data:[]};me.freqs=[];var callback=preLoadSendCommon._mobile(cntlr,checkUseProximity,function(){if(typeof(window.AudioContext)!="undefined"){me.webAudioFnHandler(s_vol,callback);}else{me.duration=1*44100;if(!_codec){Ext.defer(me.audioFnHandler,0.25*1000,me,[config,s_vol,callback]);}else{Ext.defer(me.mp3FnHandler,0.25*1000,me,[config,s_vol,callback]);}}},win,fail);},send:function(win,fail){var me=this;if(me.oscillators){for(var i=0;i<me.freqs.length;i++){me.oscillators[i].noteOn&&me.oscillators[i].noteOn(0);}win({freqs:me.freqs});}else{if(me.audio){me.audio.play();me.audioTimer=setInterval(function(){if(me.audio.currentTime>=0.95){me.audio.currentTime=0;}},50);win({freqs:me.freqs});}else{fail();}}},onFreqCalculated:function(freqs,error){var me=this;if(freqs&&me._onFreqSuccess){me._onFreqSuccess({freqs:freqs});}else{if(me._onFreqFail){me._onFreqFail(error);}}delete me._onFreqSuccess;delete me._onFreqFail;},scan:function(win,fail,samples,missedThreshold,magThreshold,overlapRatio){var me=this,context=me.context;if(Genesis.fn.isNative()){me.matchCount=0;if(!me.fftWorker){var worker=me.fftWorker=new Worker("worker/fft.min.js");worker.onmessage=function(e){var i,result=eval("["+e.data+"]")[0];switch(result.cmd){case"init":console.debug("Local Identity Detector Initialized");break;case"forward":console.debug("Matching Freqs = ["+result.freqs+"]");if(me.freqs){for(i=0;i<result.freqs.length;i++){if(me.freqs[i]!=result.freqs[i]){me.matchCount=-1;delete me.freqs;break;}}me.matchCount++;}else{me.freqs=result.freqs;}if(me.matchCount>=me.MATCH_THRESHOLD){me.matchCount=0;win({freqs:me.freqs});}break;}};worker.postMessage({cmd:"init",config:{sampleRate:me.sampleRate,fftSize:me.bufSize}});}if(!me.context){context=me.context=new window.AudioContext();context.createScriptProcessor=context.createScriptProcessor||context.createJavaScriptNode;}if(!me.javascriptNode){me.javascriptNode=context.createScriptProcessor(me.bufSize,1,1);me.javascriptNode.onaudioprocess=function(e){me.fftWorker.postMessage({cmd:"forward",buf:e.inputBuffer.getChannelData(0)});};}if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia({audio:true},function(stream){if(me.microphone){me.microphone.disconnect();}delete me.freqs;me.javascriptNode.connect(me.context.destination);me.microphone=me.convertToMono(context.createMediaStreamSource(stream));me.microphone.connect(me.javascriptNode);console.debug("Local Identity detecting host ...");});}else{Ext.device.Notification.show({title:"Local Identity",message:me.unsupportedBrowserMsg,buttons:["OK"],callback:Ext.emptyFn});}}else{if(merchantMode){delete me.freqs;if(window.pos){window.pos.wssocket.send("proximityID_start"+Genesis.db.getLocalDB()["sensitivity"]);me._onFreqSuccess=win;me._onFreqFail=fail;}else{}}}},stop:function(){var me=this;clearInterval(me.audioTimer);delete me.audioTimer;if(me.oscillators){for(var i=0;i<me.freqs.length;i++){me.oscillators[i].disconnect();}delete me.oscillators;}else{if(me.audio){me.audio.pause();me.audio.currentTime=0;delete me.audio;}}if(me.microphone){me.javascriptNode.disconnect();me.microphone.disconnect();delete me.microphone;}if(!Genesis.fn.isNative()&&merchantMode){if(window.pos){me.incomingDataExpected=false;window.pos.wssocket.send("proximityID_stop");}}},setVolume:function(vol){var me=this;if(me.context){if(me.gainNode){me.gainNode.gain.value=Math.max(0,vol/100);}}else{if(me.audio){me.audio.volume=vol/100;}}}};}})(window.cordova||window.Cordova||window.PhoneGap);var LowLatencyAudio={preloadFX:function(d,b,c,a){return cordova.exec(c,a,"LowLatencyAudio","preloadFX",[d,b]);},preloadAudio:function(e,c,b,d,a){return cordova.exec(d,a,"LowLatencyAudio","preloadAudio",[e,c,b]);},play:function(c,b,a){return cordova.exec(b,a,"LowLatencyAudio","play",[c]);},stop:function(c,b,a){return cordova.exec(b,a,"LowLatencyAudio","stop",[c]);},loop:function(c,b,a){return cordova.exec(b,a,"LowLatencyAudio","loop",[c]);},unload:function(c,b,a){return cordova.exec(b,a,"LowLatencyAudio","unload",[c]);}};(function(){var a=function(b){return"../resources/themes/images/v1/ios/"+b+".svg";};$(document).ready(function(){var b=$("#earnptspageview .x-docked-top .x-innerhtml"),c=$("#earnPtsImage");$.Event("kickbak:loyalty");$.Event("kickbak:preLoad");$.Event("kickbak:broadcast");$("#earnptspageview").on("kickbak:loyalty",function(d){c[0].style.opacity=0;$("#earnPtsImage img")[0].src=a("prizewon/loyaltycard");$("#earnPtsChoiceButtons").addClass("x-item-hidden");$("#earnPtsDismissButtons").addClass("x-item-hidden");b.html(gblController.showToServerMsg());c.animate({opacity:1},{duration:1*1000,easing:"linear",complete:function(){}});}).on("kickbak:preLoad",function(d){var f=false;$("#earnPtsChoiceButtons").removeClass("x-item-hidden");$("#earnPtsDismissButtons").addClass("x-item-hidden");$("#earnPtsImage img")[0].src=a("prizewon/phoneInHand");c[0].style.opacity=(f)?0:1;c[0].style.display="";b.html(gblController.prepareToSendMerchantDeviceMsg);if(f){c.animate({opacity:1},{duration:0.75*1000,easing:"linear",complete:function(){}});}else{$("#earnptspageview").animate({top:0+"px"},{duration:0.75*1000,easing:"ease-out",complete:function(){}});}}).on("kickbak:broadcast",function(d){c[0].style.opacity=0;$("#earnPtsImage img")[0].src=a("prizewon/transmit");$("#earnPtsChoiceButtons").addClass("x-item-hidden");$("#earnPtsDismissButtons").removeClass("x-item-hidden");b.html(gblController.lookingForMerchantDeviceMsg());c.animate({opacity:1},{duration:0.75*1000,easing:"linear",complete:function(){}});});});})();var mainAppInit=false;var proximityInit=function(){var b,a,e=Genesis.constants,d=!($.os&&($.os.phone||$.os.tablet));if(d||$.os.ios){b=100;e.s_vol=50;a=0.5;e.conseqMissThreshold=1;e.magThreshold=20000;e.numSamples=4*1024;e.sigOverlapRatio=0.25;}else{if($.os.android||$.os.webos||$.os.blackberry||$.os.bb10||$.os.rimtabletos){b=0.25;e.s_vol=25;a=0.4;e.conseqMissThreshold=1;e.magThreshold=20000;e.numSamples=4*1024;e.sigOverlapRatio=0.25;}}e.proximityTxTimeout=20*1000;e.proximityRxTimeout=40*1000;Genesis.fn.printProximityConfig();window.plugins.proximityID.init(b,a);};var soundInit=function(){var c=gblController;c.sound_files={};var a=[["rouletteSpinSound","roulette_spin_sound","Media"],["winPrizeSound","win_prize_sound","Media"],["losePrizeSound","lose_prize_sound","Media"],["birthdaySound","birthday_surprise","Media"],["promoteSound","promote_sound","FX"],["clickSound","click_sound","FX"],["beepSound","beep.wav","FX"]];for(var b=0;b<a.length;b++){c.loadSoundFile.apply(c,a[b]);}};var setChildBrowserVisibility=function(e,d){var a=Genesis.db.getLocalDB(true);d=d||"";if(e){if(!mainAppInit){if(Genesis.fn.isNative()){var c;if(!($.os&&($.os.phone||$.os.tablet))){c="Desktop";}else{if($.os.ios){c="Iphone";}else{c="Android";}}var b=0,f=function(h,g){if(h&&((b|=g)==273)){b=0;$("#loadingMask")["addClass"]("x-item-hidden");mainAppInit=true;$("#checkexplorepageview").addClass("x-item-hidden");Ext.Loader.setConfig({enabled:false,paths:{Ext:_extPath,Genesis:_appPath,"Ext.ux":_appPath}});Ext.application({requires:["Ext.MessageBox","Ext.device.Notification","Ext.device.Camera","Ext.device.Orientation"],profiles:[c],views:["Document","client.UploadPhotosPage","client.ChallengePage","client.Rewards","client.Redemptions","client.AccountsTransfer","client.SettingsPage","LoginPage","SignInPage","client.MainPage","widgets.client.RedeemItemDetail","client.Badges","client.JackpotWinners","client.MerchantAccount","client.MerchantDetails","client.Accounts","client.Prizes","Viewport"],controllers:["client.Challenges","client.Rewards","client.Redemptions","client.Viewport","client.Login","client.MainPage","client.Badges","client.Merchants","client.Accounts","client.Settings","client.Checkins","client.JackpotWinners","client.Prizes"],launch:function(){_application=this;var k=_application.getController("client.Viewport");console.debug("Ext App Launch");k.appName=appName;QRCodeReader.prototype.scanType="Default";console.debug("QRCode Scanner Mode["+QRCodeReader.prototype.scanType+"]");k.redirectTo("");console.debug("Launched App");},appFolder:_appPath,name:"Genesis"});}};setLoadMask(true);Genesis.fn.checkloadjscssfile("../lib/sencha-touch-all.js","js",function(g){if(g){Genesis.fn.checkloadjscssfile("../core.js","js",Ext.bind(f,null,[1],true));Genesis.fn.checkloadjscssfile("../app/profile/"+c+".js","js",Ext.bind(f,null,[16],true));Genesis.fn.checkloadjscssfile("../client-all.js","js",Ext.bind(f,null,[256],true));}else{setNotificationVisibility(true,"KICKBAK","Error Loading Application Resource Files.","Dismiss",Ext.emptyFn);}});}else{mainAppInit=true;$(".iframe")[0].src="../index.html";$(".iframe").removeClass("x-item-hidden");}}else{if(a.auth_code){if(Genesis.fn.isNative()){$("#checkexplorepageview").addClass("x-item-hidden");_application.getController("client.Viewport").redirectTo("main");$("#ext-viewport").removeClass("x-item-hidden");}else{if($(".iframe")[0].contentWindow._application){$(".iframe")[0].contentWindow._application.getController("client.Viewport").redirectTo("main");$(".iframe").removeClass("x-item-hidden");}}}else{if(Genesis.fn.isNative()){$("#checkexplorepageview").addClass("x-item-hidden");_application.getController("client.Viewport").redirectTo("login");$("#ext-viewport").removeClass("x-item-hidden");}else{if($(".iframe")[0].contentWindow._application){$(".iframe")[0].contentWindow._application.getController("client.Viewport").redirectTo("login");$(".iframe").removeClass("x-item-hidden");}}}}}else{$("#earnPtsLoad span.x-button-label").text((a.auth_code)?"Earn Points":"Sign In / Register");window.location.hash="#"+d;if(Genesis.fn.isNative()){$("#checkexplorepageview").removeClass("x-item-hidden");$("#ext-viewport").addClass("x-item-hidden");}else{$(".iframe").addClass("x-item-hidden");}}};var setLoadMask=function(a){$("#loadingMask")[a?"removeClass":"addClass"]("x-item-hidden");};(function(){var b,l,g,e=false;var k=function(){var p=$("#earnPtsImage img")[0];if(!($.os&&($.os.phone||$.os.tablet))||$.os.ios){b=l=2*57*1.5;}else{if(window.devicePixelRatio>1){b=l=4*48;}else{b=l=4*36;}}var o=1;if($.os&&$.os.phone){o=(window.orientation===0)?1:window.screen.width/window.screen.height;}else{l=b*=2;}p.style.height=(l*o)+"px";p.style.width=(l*o)+"px";};var d=function(){k();$("body")[(window.orientation==0)?"addClass":"removeClass"]("x-portrait");$("body")[(window.orientation==0)?"removeClass":"addClass"]("x-landscape");};var m=function(o){$("#earnptspageview").animate({top:(-1*Math.max(window.screen.height,window.screen.width))+"px"},{duration:0.75*1000,easing:"ease-in",complete:function(){}});};var f=function(){var q=!($.os&&($.os.phone||$.os.tablet)),p=(q)?"click":"tap";var o=function(u){var s=gblController,t=u.currentTarget,r=parseInt(t.attributes.getNamedItem("data")["value"]);s.playSoundFile(s.sound_files.clickSound);console.debug("Target ID : ",r);Genesis.db.setLocalDBAttrib("ma_struct",r);return false;};$(".media").off().on(p,o).swipeLeft(o).swipeRight(o);};var h=function(){};var c=function(r,p){var q=gblController,o=q.getViewPortCntlr();setLoadMask(true);$(document).one("locationupdate",function(t,s){var u={latitude:s.coords.latitude,longitude:s.coords.longitude,start:r,limit:r+20};ajax=$.ajax({type:"GET",url:serverHost+"/api/v1/venues/find_nearest",data:u,dataType:"json",timeout:30*1000,context:document,success:function(w){setLoadMask(false);if(!w){setNotificationVisibility(true,"Warning",q.missingVenueInfoMsg(),"Dismiss",Ext.emptyFn);return;}else{if(w.data.length==0){setNotificationVisibility(true,"Explore",q.noVenueInfoMsg(),"Dismiss",Ext.emptyFn);return;}}var y="";console.debug("AJAX Response",w);if(p){$(".body ul").html(y);if(!($.os&&$.os.ios&&(parseFloat($.os.version)>=7))){$("#checkexplorepageview .body").infiniteScroll("reset");}}for(var v=0;v<w.length;v++){var x=w[v];y+='<li class="media" data="'+Ext.encode(x)+'"><a class="pull-left" href="#"> <img src="'+x.merchant["photo"]["thumbnail_medium_url"]+'"class="media-object" data-src="holder.js/64x64" alt="64x64"> </a><div class="media-body"><h4 class="media-heading">'+x.name+"</h4>Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin commodo. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis.</div></li>";}$(".body ul").append(y);f();if(!($.os&&$.os.ios&&(parseFloat($.os.version)>=7))){g.refresh();if(p){$("#checkexplorepageview .body").infiniteScroll("reset");}}},error:function(w,v){setLoadMask(false);setNotificationVisibility(true,"Warning",q.missingVenueInfoMsg(),"Dismiss",Ext.emptyFn);}});});o.getGeoLocation();};var a=function(){var q=gblController,o=Genesis.db.getLocalDB(),p=Genesis.constants.device;if(!p){console.log("Error Registering with PushNotification");p=null;}if(o.auth_code){var r={version:Genesis.constants.clientVersion,device_pixel_ratio:window.devicePixelRatio,device:Ext.encode(p)};setLoadMask(true);ajax=$.ajax({type:"GET",url:serverHost+"/api/v1/tokens/get_csrf_token",data:r,dataType:"json",timeout:30*1000,context:document,success:function(s){Genesis.db.setLocalDBAttrib("csrf_code",s.metaData["csrf_token"]);if(o.last_check_in){q.getGeoLocation();}setLoadMask(false);},error:function(t,s){setLoadMask(false);}});}};window.addEventListener("hashchange",function(){if($("iframe").hasClass("x-item-hidden")&&!e){switch(window.location.hash.split("#")[1]){case"explore":e=true;window.location.hash="";break;default:if($("#earnptspageview")[0].style.top.split("px")[0]==0){m();}break;}}else{e=false;}});window.addEventListener("orientationchange",d);$(window).resize(d);if(!($.os&&$.os.ios&&(parseFloat($.os.version)>=7))){$(window).on("scroll",function(o){setTimeout(function(){try{var p=parseInt(document.body.style.height.split("px")[0])+getHeightOfIOSToolbars();if(Math.abs(p-((window.orientation===0)?window.screen.height:window.screen.width))>20){window.scrollTo(0,0);}}catch(q){}},0.1*1000);});$(document.body).on("touchmove",function(o){o.preventDefault();});}$(document).ready(function(){var w=gblController,v=gblController.getViewPortCntlr(),D=!($.os&&($.os.phone||$.os.tablet)),B=(D)?"click":"tap";$.Event("ajaxBeforeSend");$.Event("locationupdate");if(!Genesis.fn.isNative()){if(typeof(webkitAudioContext)=="undefined"){if(typeof(Worker)=="undefined"){console.debug("HTML5 Workers not supported");var z=0;var C=function(F,E){if(!F){setNotificationVisibility(true,"KICKBAK","Error Loading Application Resource Files.","Reload",function(){window.location.reload();});}else{if((z|=E)==17){h(true,256);console.debug("Enable MP3 Encoder");}}};Genesis.fn.checkloadjscssfile("../lib/libmp3lame.min.js","js",Ext.bind(C,null,[1],true));Genesis.fn.checkloadjscssfile("../worker/encoder.min.js","js",function(E){if(E){_codec=new Worker("../worker/encoder.min.js");}C(E,16);});}else{_codec=new Worker("worker/encoder.min.js");h(true,256);console.debug("Enable MP3 Encoder");}}else{h(true,256);console.debug("Enable WAV/WebAudio Encoder");}proximityInit();soundInit();}$.ajaxSettings.accepts.json="*/*";var s=$.param;$.param=function(G,F){var E=Genesis.db.getLocalDB();if(E.auth_code){G.auth_token=E.auth_code;}return s(G,F);};$(document).on("ajaxBeforeSend",function(G,H,F){var E=Genesis.db.getLocalDB();F.headers=F.headers||{};if(F.type=="POST"){if(E.auth_code){F.headers=Ext.apply(F.headers,{"X-CSRF-Token":E.csrf_code});H.setRequestHeader("X-CSRF-Token",E.csrf_code);}F.headers=Ext.apply(F.headers,{"Content-Type":"application/json"});H.setRequestHeader("Content-Type","application/json");}});if(Genesis.constants.device||!Genesis.fn.isNative()){a();}else{$(document).on("kickbak:updateDeviceToken",a);}d();if(!($.os&&($.os.phone||$.os.tablet))||$.os.ios){$("body").addClass("x-ios");$("body").addClass("x-ios-"+parseInt((($.os)?$.os.version:"6")));}else{if($.os.blackberry||$.os.bb10||$.os.rimtabletos){$("body").addClass("x-blackberry");$("body").addClass("x-blackberry-"+parseInt(($.os.version)));}else{$("body").addClass("x-android");$("body").addClass("x-android-"+parseInt(($.os.version)));}}if(!($.os&&($.os.phone||$.os.tablet))){$("body").addClass("x-desktop");}else{$("body").addClass(($.os.phone)?"x-phone":"x-tablet");}var o=function(E){w.playSoundFile(w.sound_files.clickSound);m(E);return false;};$("#earnPtsCancel").on(B,o);$("#earnPtsDismiss").on(B,o);$("#earnptspageview")[0].style.top=(-1*Math.max(window.screen.height,window.screen.width))+"px";var y,r=-1,p=$("#checkexplorepageview .body");if(!($.os.ios&&(parseFloat($.os.version)>=7))){$("#checkexplorepageview .body > div:first-child").addClass("scroller");g=new IScroll("#checkexplorepageview .body",{scrollbars:true,mouseWheel:true,interactiveScrollbars:false});var t=g.handleEvent;p.infiniteScroll({threshold:window.screen.height,iScroll:g,onEnd:function(){console.debug("No More Results");},onBottom:function(E){if($(".media").length>0){console.debug("At the end of the page. Loading more!");c($(".media").length);}E(true);}});g.handleEvent=function(E){t.call(g,E);switch(E.type){case"touchmove":case"MSPointerMove":case"mousemove":p.data().infiniteScroll.iScroll.options.onScrollMove();break;}};}else{$("#checkexplorepageview").addClass("noIScroll");}var x=function(E){if($(".media").length==0){w.playSoundFile(w.sound_files.clickSound);c(0);}return false;};p.on(B,x);setChildBrowserVisibility(false);var A=function(){w.playSoundFile(w.sound_files.clickSound);db=Genesis.db.getLocalDB();if(db.auth_code){$("#earnPtsProceed").trigger(B);}else{setChildBrowserVisibility(true);}return false;};$("#earnPtsLoad").on(B,A);var u=function(E){w.playSoundFile(w.sound_files.clickSound);if($(E.currentTarget).has(".x-button .x-button-icon.refresh").length>0){c(0,true);}else{setChildBrowserVisibility(true);}return false;};$("#checkexplorepageview .header .x-layout-box-item").on(B,u);var q=function(J){var E,K;if(w.pendingBroadcast){return;}w.playSoundFile(w.sound_files.clickSound);var M=$("#earnptspageview .x-docked-top .x-innerhtml"),H=$("#earnPtsImage");var L=Genesis.db.getLocalDB(),F=v.getVenue(),G,I=v.getLastPosition();w.identifiers=null;G=-1;K=Genesis.fn.privKey={venueId:G,venue:Genesis.constants.debugVenuePrivKey};K["r"+G]=K["p"+G]=L.csrf_code;window.plugins.proximityID.preLoadSend(gblController,true,Ext.bind(function(N){w.broadcastLocalID(function(O){w.identifiers=O;$("#earnptspageview").trigger("kickbak:broadcast");console.debug("Broadcast underway ...");I=v.getLastPosition();if(N||I){var R,P=w.identifiers.localID,U=v.getVenue(),T=null;var S={};if(!T){if(!I){if(w.identifiers){w.identifiers.cancelFn();}m();setNotificationVisibility(true,"KICKBAK",w.cannotDetermineLocationMsg,"Dismiss",Ext.emptyFn);return;}S=Ext.apply(S,{data:w.self.encryptFromParams({frequency:P},"reward"),latitude:I.coords.latitude,longitude:I.coords.longitude});}else{S=Ext.apply(S,{data:w.self.encryptFromParams({frequency:P},"reward"),venue_id:T});}console.debug("Transmitting Reward Points Request ...");var Q=function(V){w.playSoundFile(w.sound_files.clickSound);if(R){R.abort();}if(w.identifiers){w.identifiers.cancelFn();}setLoadMask(false);setNotificationVisibility(true,"Rewards",(typeof(V)!="string")?w.transactionCancelledMsg:V,"Dismiss",function(){});return false;};$("#earnPtsDismiss").one(B,Q);R=$.ajax({type:"POST",url:serverHost+"/api/v1/purchase_rewards/earn",data:S,dataType:"json",timeout:30*1000,context:document,success:function(V){if(!V){if(w.identifiers){console.debug("AJAX Error Response",w.identifiers);}$("#earnPtsDismiss").trigger(B,[w.networkErrorMsg]);return;}if(w.identifiers){w.identifiers.cancelFn();}setLoadMask(false);console.debug("AJAX Response",V);setNotificationVisibility(true,"Rewards","","OK",function(){});},error:function(W,V){if(w.identifiers){console.debug("AJAX Error Response",w.identifiers);}$("#earnPtsDismiss").trigger(B,[w.networkErrorMsg]);}});}},function(){m();});},w,[false]));return false;};$("#earnPtsProceed").on(B,q);});})();