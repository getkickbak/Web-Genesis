/*7761b7d938876aec3f71914c6ce9aa2abd38d947*/KickBak.fb={appId:null,titleMsg:"Facebook Connect",fbScope:["email","user_birthday","publish_stream","read_friendlists","publish_actions"],fbConnectErrorMsg:"Cannot retrive Facebook account information!",fbConnectRequestMsg:"By connecting to Facebook, you will receive additional Reward Pts everytime we update your KICKBAK activity to your Facebook account!",fbConnectReconnectMsg:"By connecting to Facebook, you will receive additional Reward Pts everytime we update your KICKBAK activity to your Facebook account!",connectingToFBMsg:function(){return("Connecting to Facebook ..."+KickBak.constants.addCRLF()+"(Tap to Close)")},loggingOutOfFBMsg:"Logging out of Facebook ...",fbConnectFailMsg:"Error Connecting to Facebook.",fbPermissionFailMsg:"Failed to get the required access permission.",friendsRetrieveErrorMsg:"You cannot retrieve your Friends List from Facebook. Login and Try Again.",initFb:function(){var a=this;a.appId=(debugMode)?477780595628080:197968780267830},createFbResponse:function(a){var b=a.birthday.split("/");b=b[2]+"-"+b[0]+"-"+b[1];var c={name:a.name,email:a.email,facebook_id:a.id,facebook_uid:a.username,gender:(a.gender=="male")?"m":"f",birthday:b,photoURL:"http://graph.facebook.com/"+a.id+"/picture?type=square",accessToken:a.accessToken};return c},facebook_onLogin:function(f,e,d){var c=this,b=true;var a=function(){Ext.Viewport.setMasked(null);Ext.Viewport.setMasked({xtype:"loadmask",message:c.connectingToFBMsg(),listeners:{tap:function(){Ext.Viewport.setMasked(null)}}});FB.login(Ext.bind(c.facebook_loginCallback,c),{scope:c.fbScope.toString()})};c.cb={callback:(f)?Ext.bind(function(i,h,g){if((h&&!h.wasSuccessful())){c.facebook_onLogout(null,false);Ext.defer(function(){c.facebook_onLogin(g,false,d)},1,c)}else{g(i,h)}},null,[f],true):Ext.emptyFn,supress:e,iter:0};FB.getLoginStatus(function(g){if(g.status==="connected"){FB.login(Ext.bind(c.facebook_loginCallback,c),{scope:c.fbScope.toString()})}else{var h=["Confirm","Cancel"];d=d||c.fbConnectReconnectMsg;Ext.device.Notification.show({title:c.titleMsg,message:d,buttons:h,callback:function(i){if(i.toLowerCase()==h[0].toLowerCase()){a()}else{c.cb.callback(null,null)}}})}})},facebook_loginCallback:function(a){var b=this,c=null;if(!a||a.cancelled||a.error||(a.status!="connected")){console.debug("FacebookConnect.login:failedWithError:"+((a)?a.message:"None"));if(!b.cb.supress){Ext.device.Notification.show({title:b.titleMsg,message:b.fbConnectErrorMsg,buttons:["Try Again","Continue"],callback:function(d){if(d.toLowerCase()=="try again"){Ext.defer(function(){FB.login(Ext.bind(b.facebook_loginCallback,b),{scope:b.fbScope.toString()})},1,b)}else{Ext.Viewport.setMasked(null);delete b.cb}}})}else{if(!a||a.cancelled||b.cb.iter>=3){Ext.Viewport.setMasked(null);b.cb.callback(null,null);delete b.cb}else{if(b.cb.iter<3){b.cb.iter++;Ext.defer(function(){FB.login(Ext.bind(b.facebook_loginCallback,b),{scope:b.fbScope.toString()})},2*b.cb.iter*1000,b)}}}}else{console.debug("Retrieving Facebook profile information ...");Ext.defer(function(){FB.api("/me",function(d){if(!d.error||(d.id&&(d.id>0))){var e=d.id;console.debug("Session ID["+e+"]");var f=b.createFbResponse(d);console.debug("You`ve logged into Facebook! \nEmail("+f.email+")\nID("+e+")\n");b.cb.callback(f,null);delete b.cb}else{Ext.Viewport.setMasked(null);b.cb.callback(null,null);b.facebook_onLogout(null,false);delete b.cb}})},0.5*1000,b)}},facebook_onLogout:function(a,b){var c=this;a=a||Ext.emptyFn;console.debug("facebook_onLogout");try{if(b){Ext.Viewport.setMasked({xtype:"loadmask",message:c.loggingOutOfFBMsg});FB.logout(function(e){Ext.Viewport.setMasked(null);a()})}else{a()}}catch(d){a()}}};