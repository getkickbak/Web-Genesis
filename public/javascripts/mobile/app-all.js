Ext.define("Genesis.profile.Iphone",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.is.iPhone;}});Ext.define("Genesis.profile.Android",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.is.Android;}});Ext.define("Genesis.profile.Desktop",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.deviceType=="Desktop";}});Ext.define("Genesis.view.widgets.Animation",{extend:"Ext.mixin.Mixin",config:{animationMode:"fold"},lastAnimationProperties:{},constructor:function(a){this.initConfig(a);},getAnimateProperties:function(){var b=this,a=b.renderElement;switch(this.getAnimationMode()){case"fold":return({element:{from:{opacity:0},to:{opacity:1}}});case"slide":return({element:{from:{left:a.getX()+a.getWidth(),top:a.getY()+a.getHeight(),width:a.getWidth(),opacity:0},to:{left:a.getX(),top:a.getY(),width:a.getWidth(),opacity:1}},ghost:{from:0,to:{left:a.getX()-a.getWidth(),top:a.getY()-a.getHeight(),opacity:0}}});case"fade":return({element:{from:{opacity:0},to:{opacity:1}},ghost:{from:0,to:{opacity:0}}});}},animate:function(k,f,j,l,m,e,a){var h=this,c={element:f,easing:"ease-out",duration:e,},b,g,d;this.lastAnimationProperties[f.id]={to:m,onEnd:a};f.setLeft(0);if(Ext.os.is.Android){b=function(o,n){c[n]={opacity:o.opacity,overflow:"hidden"};if(Ext.isDefined(o.left)){c[n].left=o.left;}if(Ext.isDefined(o.top)){c[n].top=o.top;}if(Ext.isDefined(o.width)){c[n].width=o.width;}if(Ext.isDefined(o.height)){c[n].height=o.height;}};if(l){b(l,"from");}if(m){b(m,"to");}}else{g=function(o,n){c[n]={opacity:o.opacity,overflow:"hidden"};if(Ext.isDefined(o.left)||Ext.isDefined(o.top)){c[n].transform={};if(Ext.isDefined(o.left)){c[n].transform.translateX=o.left;}if(Ext.isDefined(o.top)){c[n].transform.translateY=o.top;}}if(Ext.isDefined(o.width)){c[n].width=o.width;}if(Ext.isDefined(o.height)){c[n].height=o.height;}};if(l){g(l,"from");}if(m){g(m,"to");}}fn=function(){if(a){a.call(h);}if(k&&Ext.isNumber(m.width)){k.setWidth(m.width);}h.lastAnimationProperties={};};d=new Ext.fx.Animation(c);d.on("animationend",fn,this);Ext.Animator.run(d);},endAnimation:function(){var c=this.lastAnimationProperties,d,b,a;if(c){for(d in c){b=Ext.get(d);for(a in c[d].to){b.setStyle(a,c[d][a]);}if(c[d].onEnd){c[d].onEnd.call(this);}}}}});Ext.define("Genesis.navigation.Bar",{extend:"Ext.navigation.Bar",config:{defaultBackButtonText:"Back",altBackButtonText:"Close",mode:"slide"},onViewAdd:function(b,g,c){var f=this;var h=b.getLayout().getAnimation();var a=f.titleComponent;f.endAnimation();f.backButtonStack.push(g.config.title||f.getDefaultBackButtonText());f.refreshNavigationBarProxy();var d=f.getNavigationBarProxyProperties();if(d.title.left){}if(d.title.width){a.setWidth(d.title.width);}var e=f.getBackButton();if(b.stack.length>0){e.setText(f.getBackButtonText());e.show();}else{e.hide();}f.titleComponent.setTitle(f.getTitleText());if(h&&h.isAnimation&&b.isPainted()&&f.elementGhost){if(b.getInnerItems().length>1){f.pushTbAnimated(f.getBackButtonText(),this.controller);}else{if(f.elementGhost){f.elementGhost.destroy();delete f.elementGhost;}}}else{if(b.getInnerItems().length>1){f.pushTb(f.getBackButtonText());}else{}}},onViewRemove:function(b,f,c){var e=this;var g=b.getLayout().getAnimation();var a=e.titleComponent;e.endAnimation();e.backButtonStack.pop();e.refreshNavigationBarProxy();var d=e.getNavigationBarProxyProperties();if(d.title.left){}if(d.title.width){a.setWidth(d.title.width);}if(g&&g.isAnimation&&b.isPainted()&&e.elementGhost){e.popTbAnimated(e.getBackButtonText(),this.controller);}else{e.popTb(e.getBackButtonText());}e.titleComponent.setTitle(e.getTitleText());},getTbAnimationProperties:function(){var b=this,a=b.renderElement;switch(this.getMode()){case"slide":if(!this.slideAnimation){this.slideAnimation=new Ext.fx.layout.card.Slide({direction:"left"});}this.slideAnimation.setReverse(false);return this.slideAnimation;case"fade":if(!this.fadeAnimation){this.fadeAnimation=new Ext.fx.layout.card.Fade();}this.fadeAnimation.setReverse(false);return this.fadeAnimation;}},getTbAnimationReverseProperties:function(){var a=this.getTbAnimationProperties();a.setReverse(true);return a;},pushTb:function(e){var d=this;var a=d.getNavigationBarProxyProperties();var c=d.getBackButton();var b=a.backButton;if(b.left){c.setLeft(b.left);}if(b.width){c.setWidth(b.width);}},pushTbAnimated:function(h,d){var g=this;var c=0;var j=g.getBackButton(),a=j.getText();var e=g.getTbAnimationProperties();var f=g.getNavigationBarProxyProperties();var b=f.backButton;if(b.left){j.setLeft(b.left);}if(b.width){j.setWidth(b.width);}g.onActiveItemChange.call(e,null,g.renderElement,g.elementGhost,null,d,function(){g.elementGhost.destroy();delete g.elementGhost;});},popTb:function(e){var d=this,c=d.getBackButton();var a=this.getNavigationBarProxyProperties();if(e&&d.backButtonStack.length){c.setText(this.getBackButtonText());c.show();}else{c.hide();}var b=a.backButton;if(b.left){c.setLeft(b.left);}if(b.width){c.setWidth(b.width);}},popTbAnimated:function(j,e){var h=this;var d=h.element,c=h.renderElement,k=h.getBackButton();var a=k.getText();var g=h.getTbAnimationReverseProperties();var f=this.getNavigationBarProxyProperties();if(j&&h.backButtonStack.length){k.setText(this.getBackButtonText());k.show();}else{k.hide();}var b=f.backButton;if(b.width){k.setWidth(b.width);}h.onActiveItemChange.call(g,null,h.renderElement,h.elementGhost,null,e,function(){h.elementGhost.destroy();delete h.elementGhost;if(!j){k.setText(null);}});},createNavigationBarProxy:function(){var a=this.proxy;if(a){return;}this.proxy=a=Ext.create("Ext.TitleBar",{title:this.backButtonStack[0]});a.add(Ext.applyIf({hidden:false,text:""},this.config.backButton));a.add(this.config.rightButton);a.backButton=a.down("button[ui=back]");Ext.getBody().appendChild(a.renderElement);a.renderElement.setStyle("position","absolute");a.element.setStyle("visibility","hidden");a.renderElement.setX(0);a.renderElement.setY(-1000);},refreshNavigationBarProxy:function(){var c=this.proxy,b=this.renderElement,a=this.backButtonStack,e=a[a.length-1],d=this.getBackButtonText();if(!c){this.createNavigationBarProxy();c=this.proxy;}c.renderElement.setWidth(b.getWidth());c.renderElement.setHeight(b.getHeight());c.setTitle(e);if(d){c.backButton.setText(d);c.backButton.show();}else{}c.refreshTitlePosition();},getNavigationBarProxyProperties:function(){return({title:{left:this.proxy.titleComponent.renderElement.getLeft(),width:this.proxy.titleComponent.renderElement.getWidth()},leftBox:{left:this.proxy.leftBox.renderElement.getLeft(),width:this.proxy.leftBox.renderElement.getWidth()},rightBox:{left:this.proxy.rightBox.renderElement.getLeft(),width:this.proxy.rightBox.renderElement.getWidth()},backButton:{left:this.proxy.backButton.renderElement.getLeft(),width:this.proxy.backButton.renderElement.getWidth()}});},createProxy:function(b,a){var c=(a)?b.element.getParent():b.element,d=Ext.get(c.id+"-proxy");if(!d){d=c.dom.cloneNode(true);d.id=c.id+"-proxy";d.children[0].id=c.dom.children[0].id+"-proxy";c.getParent().dom.appendChild(d);d=Ext.get(d);d.setStyle("position","absolute");d.setY(c.getY());d.setX(c.getX());d.setWidth(c.getWidth());d.dom.style.setProperty("z-index",1,"important");}return d;},reset:function(){this.backButtonStack=[];this.lastAnimationProperties={};this.animating=false;},onActiveItemChange:function(g,h,b,e,a,d){var f=this.getInAnimation(),c=this.getOutAnimation(),h,b;if(h&&b){f.setElement(h);c.setElement(b);c.setOnBeforeEnd(function(j,k){if(k||Ext.Animator.hasRunningAnimations(j)){a.firingArguments[1]=null;a.firingArguments[2]=null;}});c.setOnEnd(function(){a.resume();d();});h.dom.style.setProperty("visibility","hidden","!important");Ext.Animator.run([c,f]);a.pause();}}});Ext.define("Genesis.view.widgets.CheckinMerchantDetailsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"checkinmerchantdetailsitem",alias:"widget.checkinmerchantdetailsitem",config:{layout:{type:"hbox",align:"stretch"},image:{docked:"left",cls:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>',{getPhoto:function(a){return a.Merchant.icon_url;}})},address:{flex:1,tpl:Ext.create("Ext.XTemplate",'<div class="checkinMerchantDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc">{[this.getAddress(values)]}</div></div>',{getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",</br>"+b.zipcode);}}),cls:"points"},dataMap:{getImage:{setData:"image"},getAddress:{setData:"address"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyAddress:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getAddress());},updateAddress:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){if(!d){return;}var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),l=e.first(),j=h.getDataMap(),f,k,g,a;if(!l){return;}for(f in j){g=j[f];k=h[f]();if(k){for(a in g){if(k[a]){switch(g[a]){case"image":case"address":k[a](b);break;default:k[a](b[g[a]]);break;}}}}}l.updateData(b);}});Ext.define("Genesis.view.widgets.ChallengeMenuItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"challengemenuitem",alias:"widget.challengemenuitem",config:{layout:{type:"hbox",pack:"center",align:"stretch"},image:{cls:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="mainPageItemWrapper">','<div class="photo"><img src="{[this.getPhoto(values)]}" /></div>','<div class="photoName">{name}</div>',"</div>",{getPhoto:function(a){return Ext.isEmpty(a.photo_url)?Ext.BLANK_IMAGE_URL:a.photo_url;}})},dataMap:{getImage:{setData:"photo_url"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){if(!d){return;}var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),l=e.first(),j=h.getDataMap(),f,k,g,a;if(!l){return;}for(f in j){g=j[f];k=h[f]();if(k){for(a in g){if(k[a]){switch(g[a]){case"photo_url":k[a](b);break;default:k[a](b[g[a]]);break;}}}}}l.updateData(b);}});Ext.define("Genesis.view.widgets.MerchantAccountPtsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.Button","Ext.XTemplate"],xtype:"merchantaccountptsitem",alias:"widget.merchantaccountptsitem",config:{layout:"fit",background:{cls:"merchantPagePanel",tag:"background",items:[{xtype:"container",docked:"bottom",cls:"container",layout:{type:"hbox",align:"stretch"},defaults:{xtype:"component"},items:[{docked:"right",tag:"points",tpl:"+{points} Pts",cls:"points"},{docked:"right",tag:"coinphoto",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img class="coinphoto" src="{photo_url}" />'}],}],},dataMap:{getBackground:{setData:"background"}}},applyBackground:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Container,this.getBackground());},updateBackground:function(a,b){if(a){this.add(a);}if(b){this.remove(b);}},setDataBackground:function(g){var c=Ext.StoreMgr.get("CustomerStore");var a=Ext.ComponentQuery.query("viewportview")[0];var f=a.getCustomerId();var e=c.getById(g.Merchant.merchant_id);var b=this.query("container[tag=background]")[0];this.setHeight(Ext.Viewport.getSize().width);b.setStyle("background-image:url("+g.Merchant.photo_url+")");var d=this.query("component[tag=points]")[0];d.setData(e.getData());},updateRecord:function(d){if(!d){return;}var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),l=e.first(),j=h.getDataMap(),f,k,g,a;if(!l){return;}for(f in j){g=j[f];k=h[f]();if(k){for(a in g){if(k[a]){switch(g[a]){case"background":h.setDataBackground(b);break;default:k[a](b[g[a]]);break;}}}}}l.updateData(b);}});Ext.define("Genesis.view.widgets.RedemptionsPtsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"redemptionsptsitem",alias:"widget.redemptionsptsitem",config:{layout:{type:"hbox",align:"stretch"},image:{docked:"left",cls:"photo",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img src="{photo_url}"/>'},points:{flex:1,tpl:"{points} Points",cls:"points"},dataMap:{getPoints:{setData:"points"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyPoints:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getPoints());},updatePoints:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){if(!d){return;}var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),l=e.first(),j=h.getDataMap(),f,k,g,a;if(!l){return;}for(f in j){g=j[f];k=h[f]();if(k){for(a in g){if(k[a]){switch(g[a]){case"points":k[a](b);break;default:k[a](b[g[a]]);break;}}}}}l.updateData(b);}});Ext.define("Genesis.view.widgets.RewardsCartItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.field.Select","Ext.XTemplate"],mixins:["Genesis.view.widgets.Animation"],xtype:"rewardscartitem",alias:"widget.rewardscartitem",config:{layout:{type:"hbox",align:"center"},remove:{hidden:true,iconCls:"delete_black2",tag:"deleteItem",iconMask:true,cls:"plain"},qty:{value:0,options:[{text:"1",value:1},{text:"2",value:2},{text:"3",value:3},{text:"4",value:4},{text:"5",value:5},{text:"6",value:6},{text:"7",value:7},{text:"8",value:8},{text:"9",value:9}]},image:{cls:"photo",tpl:Ext.create("Ext.XTemplate",'<img src="{[this.getPhoto(values)]}"/>',{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Rewards.getPhoto(a.type);}return a.photo_url;}})},title:{flex:1,cls:"title",},points:{cls:"points",tpl:Ext.create("Ext.XTemplate","{[this.getPoints(values)]} Pts",{getPoints:function(a){return a.qty*a.points;}})},dataMap:{getImage:{setData:"photo_url"},getTitle:{setHtml:"title"},getPoints:{setData:"points"},getQty:{setValue:"qty"}}},applyRemove:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Button,this.getRemove());},updateRemove:function(a,b){if(a){this.add(a);}if(b){this.remove(b);}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyTitle:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getTitle());},updateTitle:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyPoints:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getPoints());},updatePoints:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyQty:function(a){return Ext.factory(Ext.apply(a,{}),Ext.field.Select,this.getQty());},updateQty:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){if(!d){return;}var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),l=e.first(),j=h.getDataMap(),f,k,g,a;if(!l){return;}for(f in j){g=j[f];k=h[f]();if(k){for(a in g){if(k[a]){switch(g[a]){case"points":case"photo_url":k[a](b);break;default:k[a](b[g[a]]);break;}}}}}l.updateData(b);}});Ext.define("Genesis.model.frontend.MainPage",{extend:"Ext.data.Model",id:"MainPage",config:{fields:["name","photo_url","desc","pageCntlr","subFeature"],proxy:{reader:{type:"json",rootProperty:"features"},type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/mainPage.json"}}});Ext.define("Genesis.model.UserProfile",{extend:"Ext.data.Model",alternateClassName:"UserProfile",id:"UserProfile",config:{belongsTo:[{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"}],fields:["gender","birthday","zipcode","created_ts","update_ts","user_id"]},getUser:function(){}});Ext.define("Genesis.model.User",{extend:"Ext.data.Model",requires:["Genesis.model.UserProfile"],alternateClassName:"User",id:"User",config:{hasOne:[{model:"Genesis.model.UserProfile",associationKey:"profile"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/users.json",reader:{type:"json",rootProperty:"users"}},fields:["user_id","name","email","facebook_id","photo_url","created_ts","update_ts","profile_id"],idProperty:"user_id"}});Ext.define("Genesis.model.Merchant",{extend:"Ext.data.Model",alternateClassName:"Merchant",id:"Merchant",config:{fields:["merchant_id","name","email","photo_url","icon_url","account_first_name","account_last_name","phone","auth_code","qr_code","payment_account_id","created_ts","update_ts"],idProperty:"merchant_id"}});Ext.define("Genesis.model.Challenge",{extend:"Ext.data.Model",id:"Challenge",alternateClassName:"Challenge",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],fields:["id","type","name","description","photo_url","require_verif","data","points","created_ts","update_ts","merchant_id","venue_id"]},getMerchant:function(){}});Ext.define("Genesis.model.Checkin",{extend:"Ext.data.Model",alternateClassName:"Checkin",id:"Checkin",config:{belongsTo:[{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"},{model:"Genesis.model.Venue",getterName:"getVenue",setterName:"setVenue"}],fields:["id","time","user_id","venue_id"]},getUser:function(){},getVenue:function(){}});Ext.define("Genesis.model.PurchaseReward",{extend:"Ext.data.Model",id:"Venue",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/rewards.json",reader:{type:"json",rootProperty:"rewards"}},fields:["title","average_price","reward_ratio","points","type","photo_url","created_ts","update_ts","venue_id","merchant_id","qty"]},getMerchant:function(){}});Ext.define("Genesis.model.CustomerReward",{extend:"Ext.data.Model",id:"Venue",config:{fields:["id","title","average_price","points","type","photo_url","created_ts","update_ts","merchant_id","venue_id"],idProperty:"id",belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/redemptions.json",reader:{type:"json",rootProperty:"redemptions"}}},getMerchant:function(){}});Ext.define("Genesis.model.Venue",{extend:"Ext.data.Model",requires:["Genesis.model.Challenge","Genesis.model.PurchaseReward","Genesis.model.CustomerReward"],alternateClassName:"Venue",id:"Venue",config:{fields:["id","venue_id","name","address1","address2","city","state","country","zipcode","phone","website","latitude","longtitude","created_ts","update_ts","merchant_id","sort_id"],belongsTo:[{model:"Genesis.model.Merchant",associationKey:"merchant",getterName:"getMerchant",setterName:"setMerchant"}],hasMany:[{model:"Genesis.model.Challenge",name:"challenges"},{model:"Genesis.model.PurchaseReward",name:"purchaseReward"},{model:"Genesis.model.CustomerReward",name:"customerReward"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/checkinRecords.json",reader:{type:"json",rootProperty:"venues"}},idProperty:"venue_id"}});Ext.define("Genesis.model.EligibleReward",{extend:"Ext.data.Model",id:"EligibleReward",alternateClassName:"EligibleReward",config:{idProperty:"reward_id",fields:["reward_id","reward_title","points_difference","type","photo_url","venue_id"],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json",reader:{type:"json",rootProperty:"eligibleRewards"}}},statics:{setVenueScanCheckinUrl:function(){this.getProxy().url=Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json";},setVenueCheckinUrl:function(){this.getProxy().url=Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json";},setVenueExploreUrl:function(){this.getProxy().url=Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json";}}});Ext.define("Genesis.model.Customer",{extend:"Ext.data.Model",requires:["Genesis.model.Checkin"],alternateClassName:"Customer",id:"Customer",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"},{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"}],hasOne:{model:"Genesis.model.Checkin",associationKey:"last_check_in",getterName:"getLastCheckin",setterName:"setLastCheckin"},proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/customers.json",reader:{type:"json",rootProperty:"customers"}},fields:["auth_code","qr_code","points","created_ts","update_ts","merchant_id","user_id"],idProperty:"merchant_id"},getMerchant:function(){},getUser:function(){}});Ext.define("Genesis.model.frontend.CustomerVenue",{extend:"Ext.data.Model",requires:["Genesis.model.Customer","Genesis.model.Venue"],alternateClassName:"CustomerVenue",id:"CustomerVenue",config:{fields:[],hasOne:[{model:"Genesis.model.Customer",associationKey:"customer",getterName:"getCustomer",setterName:"setCustomer"},{model:"Genesis.model.Venue",associationKey:"venue",getterName:"getVenue",setterName:"setVenue"}],proxy:{type:"memory"}}});Ext.define("Genesis.model.frontend.RewardsMainTemplate",{extend:"Ext.data.Model",id:"RewardsMainTemplate",alternateClassName:"RewardsMainTemplate",config:{fields:["id","photo_url","text"],proxy:{type:"memory"}}});Ext.define("Genesis.view.ViewBase",{extend:"Ext.Container",xtype:"viewbase",config:{},beforeActivate:function(f,b){var a=Ext.ComponentQuery.query("viewportview")[0];var e=a.getNavigationBar();var c=e.getBackButton();var d=e.proxy.backButton;d.setUi("normal");c.setUi("normal");e.setDefaultBackButtonText(e.getAltBackButtonText());d.setText(e.getAltBackButtonText());if(!b.getXTypes().match("mainpageview")){a.changeAnimationCfg();}},beforeDeactivate:function(b,a){},afterActivate:function(b,a){},afterDeactivate:function(f,b){var a=Ext.ComponentQuery.query("viewportview")[0];var e=a.getNavigationBar();var c=e.getBackButton();var d=e.proxy.backButton;d.setUi("back");c.setUi("back");e.setDefaultBackButtonText(e.config.defaultBackButtonText);d.setText(e.config.defaultBackButtonText);}});Ext.define("Genesis.view.CheckinMerchant",{extend:"Ext.Container",requires:["Ext.dataview.DataView","Ext.XTemplate","Ext.Map","Genesis.view.widgets.CheckinMerchantDetailsItem"],alias:"widget.checkinmerchantview",config:{title:"Venue Name",changeTitle:true,cls:"checkinMerchant",scrollable:"vertical",layout:{type:"vbox",align:"stretch",pack:"start"},defaults:{cls:"separator"},items:[{xtype:"dataview",cls:"checkinMerchantWrapper separator",useComponents:true,defaultType:"checkinmerchantdetailsitem",scrollable:false,store:"VenueStore"},{xtype:"container",margin:0,layout:{type:"hbox",align:"stretch",pack:"center"},items:[{flex:1,xtype:"button",ui:"green-large",tag:"checkinBtn",text:"Check in"},{flex:1,xtype:"button",ui:"red-large",tag:"exploreBtn",text:"Explore"}]},{xtype:"component",tag:"map",flex:1,tpl:Ext.create("Ext.XTemplate",'<img height="{height}" width="{width}" src="{photo}"/>')}]},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.require("Ext.plugin.PullRefresh",function(){Ext.define("Genesis.view.CheckinExplore",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate","Ext.plugin.PullRefresh"],alias:"widget.checkinexploreview",config:{title:"Check-in Nearby Places",changeTitle:false,layout:"fit",items:[{xtype:"list",store:"CheckinExploreStore",scrollable:"vertical",ui:"round",cls:"checkInExploreList separator_pad",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div><div class="listItemDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc">{[this.getAddress(values)]}</div></div>',{getPhoto:function(a){return a.Merchant.icon_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn,plugins:[Ext.create("Ext.plugin.PullRefresh",{refreshFn:function(c,b){var a=b.getList().getStore();a.removeAll();a.on("load",c,b,{single:true});a.load();}})]},{docked:"bottom",cls:"checkInNow",tag:"checkInNow",xtype:"container",layout:{type:"vbox",pack:"center"},items:[{xtype:"button",ui:"checkInNow",tag:"checkInNow",text:"Check In Now!"}]}]},beforeActivate:function(){switch(this.mode){case"checkin":this.getInitialConfig().title="Check-in Nearby Places";break;case"explore":this.getInitialConfig().title="Explore Nearby Places";break;}},beforeDeactivate:function(){},afterActivate:function(b,a){},afterDeactivate:function(){}});});Ext.define("Genesis.view.Viewport",{extend:"Ext.navigation.View",requires:["Ext.MessageBox","Ext.ActionSheet","Ext.fx.layout.Card","Ext.SegmentedButton","Genesis.navigation.Bar"],xtype:"viewportview",config:{autoDestroy:false,cls:"viewport",fullscreen:true,useTitleForBackButtonText:false,defaultBackButtonText:"Back",altBackButtonText:"Close",venueId:0,customerId:0,checkinInfo:{venueId:0,customerId:0},navigationBar:{defaults:{iconMask:true},rightButton:{align:"right",iconMask:true,iconCls:"check_black1"},docked:"top",cls:"navigationBarTop",layout:{pack:"justify",align:"center"},items:[{align:"right",iconCls:"share",tag:"shareBtn",hidden:true,handler:function(){if(!this.actions){this.actions=Ext.create("Ext.ActionSheet",{hideOnMaskTap:false,defaults:{defaultUnit:"em",margin:"0 0 0.5 0",xtype:"button",iconCls:"dummy",iconAlign:"left",iconMask:true},items:[{text:"Email",iconCls:"mail",tag:"mail",handler:Ext.emptyFn},{text:"SMS Message",tag:"sms",iconCls:"compose",handler:Ext.emptyFn},{text:"Facebook",tag:"facebook",ui:"blue",iconCls:"facebook",handler:Ext.emptyFn},{margin:"0.5 0 0 0",text:"Cancel",iconMaskCls:"dummymask",ui:"confirm",scope:this,handler:function(){this.actions.hide();}}]});Ext.Viewport.add(this.actions);this.actions.show();}this.actions.show();}},{align:"right",tag:"info",iconCls:"info_plain",destroy:function(){this.actions.destroy();this.callParent(arguments);},handler:function(){if(!this.actions){this.actions=Ext.create("Ext.ActionSheet",{defaultUnit:"em",padding:"1em",hideOnMaskTap:false,defaults:{defaultUnit:"em"},items:[{margin:"0 0 0.5 0",text:"Logout",handler:Ext.emptyFn},{margin:"0.5 0 0 0",xtype:"button",text:"Cancel",scope:this,handler:function(){this.actions.hide();}}]});Ext.Viewport.add(this.actions);}this.actions.show();}},{align:"right",tag:"main",iconCls:"check_black1",hidden:true},{align:"right",tag:"edit",text:"Edit",hidden:true},{align:"right",tag:"done",text:"Done",hidden:true}]},items:[]},initialize:function(){this.stack=[];this.slideTop=new Ext.fx.layout.Card({duration:300,easing:"ease-out",type:"slide",direction:"top"});this.slideTop.on("animationend",this.onAnimationEnd,this);this.callParent(arguments);var b=this.getLayout(),a=b.getAnimation();a.getOutAnimation().on("animationend","resetAnimationCfg",this);},applyNavigationBar:function(a){if(!a){a={hidden:true,docked:"top"};}if(a.title){delete a.title;Ext.Logger.warn("Ext.navigation.View: The 'navigationBar' configuration does not accept a 'title' property. You set the title of the navigationBar by giving this navigation view's children a 'title' property.");}a.view=this;return Ext.factory(a,Genesis.navigation.Bar,this.getNavigationBar());},resetAnimationCfg:function(){if(!this.getActiveItem().getXTypes().match("viewbase")){var b=this.getLayout(),a;a=b.getAnimation();a.getInAnimation().setDirection(this.defaultInAnimationDir);a.getOutAnimation().setDirection(this.defaultOutAnimationDir);}},changeAnimationCfg:function(){var b=this.getLayout(),a;if(b.isCard){a=b.getAnimation();if(a){this.defaultInAnimationDir=a.getInAnimation().getDirection();this.defaultOutAnimationDir=a.getOutAnimation().getDirection();a.getInAnimation().setDirection("up");a.getOutAnimation().setDirection("up");}}},doPop:function(c){var e=this;e.stack.pop();var f=e.getLayout().getAnimation();var b=e.stack[e.stack.length-1];if(f&&f.isAnimation){f.setReverse(true);var a=(e.getActiveItem()&&!e.getActiveItem().getXTypes().match("viewbase"));var d=e.getNavigationBar();d.setMode((a)?"slide":"fade");d.elementGhost=d.createProxy(d);}e.getNavigationBar().onViewRemove(e,b,null);e.setActiveItem(b);if(f&&f.isAnimation){f.setReverse(false);}return b;},getPreviousItem:function(){var a=this;return a.stack[a.stack.length-1];},push:function(c,b){var e=this;var f=e.getLayout().getAnimation();var d=e.getNavigationBar();d.controller=b;if((e.stack.length==0)&&(!d.titleComponent.getTitle())){d.titleComponent.setTitle(c.config.title||d.getDefaultBackButtonText());}if(f&&f.isAnimation){var a=(!c.getXTypes().match("viewbase"));d.setMode((a)?"slide":"fade");d.elementGhost=d.createProxy(d);}if(e.getInnerItems().indexOf(c)<0){c=e.add(c);}else{e.setActiveItem(c);e.getNavigationBar().onViewAdd(e,c,null);}e.stack.push(c);return c;},doSetActiveItem:function(e,a){if(!e){return;}var c=this;if(e.getInitialConfig().changeTitle===true){var d=e.venueId||this.getVenueId();var b=Ext.StoreMgr.get("VenueStore").getById(d);e.getInitialConfig().title=b.get("name");}e.beforeActivate(e,a);if(a){a.beforeDeactivate(e,a);}c.callParent(arguments);e.afterActivate(e,a);if(a){a.afterDeactivate(e,a);}},onBeforePop:function(d){var c=this;var b=c.stack.length;if(!Ext.isNumber(d)||d<1){d=1;}d=Math.min(d,b);if(d){if(d==b){var a=c.getNavigationBar();a.reset();c.stack=[];a.getBackButton().hide();a.getBackButton().setText(null);}else{c.getNavigationBar().onBeforePop(d);for(i=0;i<d-1;i++){this.stack.pop();}return true;}}return false;},pop:function(a){var b=this.getNavigationBar();b.controller=a||this.getEventDispatcher().controller;this.callParent(arguments);},reset:function(a){var c=this;var b=c.stack.length;this.pop(b,a);}});Ext.define("Genesis.view.ChallengePage",{extend:"Genesis.view.ViewBase",requires:["Ext.data.Store","Ext.dataview.DataView","Ext.XTemplate","Ext.Toolbar","Genesis.model.Challenge","Genesis.view.widgets.ChallengeMenuItem"],alias:"widget.challengepageview",config:{title:"Challenges",changeTitle:false,layout:"fit",scrollable:false,items:[{xtype:"carousel",direction:"horizontal"},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},scrollable:{direction:"horizontal",indicators:false},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{iconCls:"doit",title:"Do it!"},{xtype:"spacer"}]},{docked:"bottom",xtype:"container",cls:"challengePageItemDescWrapper",layout:{type:"vbox",align:"stretch",pack:"start"},defaults:{xtype:"component"},items:[{flex:1,cls:"itemDesc",tpl:"{description}"},{cls:"itemDescName",tpl:"{name}"}]}]}});Ext.define("Genesis.view.MainPage",{extend:"Ext.Carousel",requires:["Ext.dataview.DataView","Ext.XTemplate"],alias:"widget.mainpageview",config:{title:"JustForMyFriends",changeTitle:false,direction:"horizontal"},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.define("Genesis.view.LoginPage",{extend:"Ext.Container",alias:"widget.loginpageview",config:{changeTitle:false},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.define("Genesis.view.Accounts",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar"],alias:"widget.accountsview",config:{title:"Loyalty Accounts",scrollable:"vertical",changeTitle:false,cls:"accountsMain",layout:"fit",items:[{xtype:"container",layout:{type:"card",animation:{type:"flip"}},tag:"accountsSelection",items:[{xtype:"container",layout:{type:"vbox",pack:"top",align:"stretch"},items:[{xtype:"toolbar",cls:"accountsPanelHdr",centered:false,items:[{xtype:"title",title:"Visited Merchants"},{xtype:"spacer"}]},{flex:1,xtype:"list",store:"AccountsStore",scrollable:false,ui:"bottom-round",cls:"accountsPanel separator_pad",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div><div class="listItemDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc noWrap">{[this.getAddress(values)]}</div></div>',{getPhoto:function(a){return a.Merchant.icon_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn}]},{xtype:"list",store:"AccountsStore",scrollable:false,cls:"accountsList",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemTitle">{name}</div><div class="itemDesc noWrap">{[this.getAddress(values)]}</div>',"</div>",{getPhoto:function(a){return a.Merchant.icon_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{xtype:"segmentedbutton",allowMultiple:false,hidden:true,tag:"accounts",items:[{text:"Usage",tag:"usage",pressed:true},{text:"A to Z",tag:"alphabetical",}]},{xtype:"spacer"}]}]},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(b,a){},afterDeactivate:function(){}});Ext.define("Genesis.view.MerchantAccount",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Ext.tab.Bar","Genesis.view.widgets.MerchantAccountPtsItem"],alias:"widget.merchantaccountview",config:{title:"Venue Name",changeTitle:true,scrollable:"vertical",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{tag:"menchantPagePanel",xtype:"dataview",store:{model:"Genesis.model.Venue",autoLoad:false},useComponents:true,scrollable:false,defaultType:"merchantaccountptsitem",defaultUnit:"em",margin:"0 0 0.8 0"},{xtype:"toolbar",cls:"merchantContactPanelHdr",centered:false,items:[{xtype:"title",title:"Contact Us"},{xtype:"spacer"}]},{xtype:"container",cls:"merchantStatsPanel separator",layout:"fit",defaults:{scrollable:false},items:[{docked:"right",xtype:"component",cls:"merchantPhoto",tag:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{photoUrl}"/></div>')},{xtype:"component",cls:"merchantAddress",tag:"merchantAddress",tpl:Ext.create("Ext.XTemplate","{[this.getAddress(values)]}",{getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}})},{xtype:"formpanel",tag:"merchantStats",cls:"merchantStats",defaults:{xtype:"textfield",readOnly:true,labelAlign:"left",labelWidth:"60%"},items:[{label:"Last Check-in",name:"lastCheckin",value:new Date()},{label:"Registered Mobile Members",name:"regMembers",value:0},{label:"Total Points Earn this year",name:"ptsEarn",value:0},{label:"Total Points Spent this year",name:"ptsSpent",value:0}]}]},{xtype:"container",tag:"merchantFeedContainer",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"toolbar",cls:"merchantFeedPanelHdr",centered:false,items:[{xtype:"title",title:"Latest News"},{xtype:"spacer"}]},{xtype:"list",scrollable:false,ui:"bottom-round",store:"EligibleRewardsStore",cls:"merchantFeedPanel separator",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.MerchantAccount.getPhoto(a.type);}else{return a.photo_url;}},getDesc:function(a){if(a.points_difference>0){a.disclosure=false;}return a.reward_title;}}),onItemDisclosure:Ext.emptyFn}]},{xtype:"container",tag:"merchantDescContainer",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"toolbar",cls:"merchantDescPanelHdr",centered:false,items:[{xtype:"title",title:"About Us"},{xtype:"spacer"}]},{xtype:"container",cls:"merchantDescPanel separator",tag:"merchantDescPanel",tpl:"{desc}"}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},scrollable:{direction:"horizontal",indicators:false},defaults:{iconMask:true,iconAlign:"top"},items:[{iconCls:"home",tag:"home",title:"Home"},{iconCls:"rewards",tag:"rewards",title:"Rewards"},{xtype:"spacer"},{iconCls:"challenges",tag:"challenges",title:"Challenges"},{xtype:"spacer"},{iconCls:"redeem",tag:"redeem",title:"Redeem"},{iconCls:"check_black1",tag:"checkin",title:"Check-In"},{tag:"browse",iconCls:"search1",title:"Explore"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.define("Genesis.view.Rewards",{extend:"Genesis.view.ViewBase",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Genesis.view.widgets.RewardsCartItem"],alias:"widget.rewardsview",config:{title:"Venue Name",changeTitle:true,scrollable:false,layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"container",tag:"rewards",flex:1,layout:{type:"card",animation:{duration:600,easing:"ease-in-out",type:"slide",direction:"down"}},activeItem:0,defaults:{xtype:"container",layout:{type:"vbox",align:"stretch",pack:"top"}},items:[{tag:"rewardMainList",items:[{xtype:"toolbar",cls:"earnPtsPanelHdr",centered:false,defaults:{iconMask:true},items:[{xtype:"title",title:"Earn Points (Select Items in your Order)"},{xtype:"spacer",align:"right"}]},{xtype:"list",flex:1,scrollable:"vertical",store:"RewardsStore",cls:"rewardsMain",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Rewards.getPhoto(a.type);}return a.photo_url;},getDesc:function(a){return a.title;}})}]},{tag:"rewardTallyList",items:[{flex:1,cls:"shadows",xtype:"dataview",scrollable:"vertical",useComponents:true,tag:"rewardsCart",defaultType:"rewardscartitem",cls:"rewardsCart separator_pad",store:"RewardsCartStore"},{xtype:"container",cls:"separator rewardsCartFooter",defaults:{xtype:"component"},items:[{docked:"left",html:"Total"},{cls:"points",tag:"total",docked:"right",data:{points:0},tpl:"{points} Pts"}]},{xtype:"button",cls:"separator",tag:"earnPts",text:"Earn Points!",ui:"yellow-large"}]}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},scrollable:{direction:"horizontal",indicators:false},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{iconCls:"shop2",tag:"cart",title:"Check Out"},{xtype:"spacer"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}}});Ext.define("Genesis.view.Redemptions",{extend:"Genesis.view.ViewBase",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Genesis.view.widgets.RedemptionsPtsItem"],alias:"widget.redemptionsview",config:{title:"Venue Name",changeTitle:true,scrollable:"vertical",cls:"redemptionsMain",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"toolbar",cls:"ptsEarnPanelHdr",centered:false,items:[{xtype:"title",title:"Points Earned"},{xtype:"spacer"}]},{cls:"ptsEarnPanel separator",xtype:"dataview",useComponents:true,scrollable:false,defaultType:"redemptionsptsitem",store:"CustomerStore"},{xtype:"toolbar",cls:"ptsEarnPanelHdr",centered:false,items:[{xtype:"title",title:"Redemptions Available (Select an item below)"},{xtype:"spacer"}]},{xtype:"container",height:10000,layout:{type:"card",animation:{type:"flip"}},cls:"redemptionsView separator",tag:"redemptionsView",items:[{xtype:"container",cls:"redemptionsDataviewWrapper",tag:"redemptionsDataviewWrapper",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"list",scrollable:{direction:"horizontal",indicators:false},inline:{wrap:false},cls:"redemptionsDataview separator",loadingText:null,tag:"redemptionsDataview",store:"RedemptionsStore",itemTpl:Ext.create("Ext.XTemplate",'<img class="photo" src="{[this.getPhoto(values)]}"/>',{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Redemptions.getPhoto(a.type);}return a.photo_url;}})},{xtype:"container",cls:"desc separator",tag:"desc",data:{title:"Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description"},tpl:"{title}"},{xtype:"container",cls:"ptsContainer separator",layout:{type:"hbox",align:"middle",pack:"center"},height:"",items:[{xtype:"component",data:{points:0},tpl:"{points} ",tag:"points",cls:"points"},{xtype:"component",cls:"photo",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img src="{photo_url}"/>'}]},{xtype:"button",cls:"separator",tag:"redeem",ui:"black-large",text:"Redeem it!"}]},{xtype:"list",scrollable:false,ui:"bottom-round",store:"RedemptionsStore",cls:"redemptionsList",tag:"redemptionsList",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Redemptions.getPhoto(a.type);}return a.photo_url;},getDesc:function(a){return a.title;}})}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},scrollable:{direction:"horizontal",indicators:false},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{xtype:"segmentedbutton",allowMultiple:false,tag:"redemptions",items:[{text:"Detailed",tag:"detailed",pressed:true},{text:"Summary",tag:"summary",}]},{xtype:"spacer"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}}});Ext.define("Genesis.store.AccountsStore",{extend:"Ext.data.Store",requires:["Genesis.model.Venue"],config:{model:"Genesis.model.Venue",grouper:{groupFn:function(a){return a.get("name")[0].toUpperCase();}},autoLoad:false,proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/accountsRecords.json",reader:{type:"json",rootProperty:"accounts"}}}});Ext.define("Genesis.controller.ControllerBase",{extend:"Ext.app.Controller",requires:["Ext.data.Store"],statics:{sign_in_path:"/sign_in",sign_out_path:"/sign_out",error:function(){var a={};a[FileError.NOT_FOUND_ERR]="File not found";a[FileError.SECURITY_ERR]="Security error";a[FileError.ABORT_ERR]="Abort error";a[FileError.NOT_READABLE_ERR]="Not readable";a[FileError.ENCODING_ERR]="Encoding error";a[FileError.NO_MODIFICATION_ALLOWED_ERR]="No mobification allowed";a[FileError.INVALID_STATE_ERR]="Invalid state";a[FileError.SYFNTAX_ERR]="Syntax error";a[FileError.INVALID_MODIFICATION_ERR]="Invalid modification";a[FileError.QUOTA_EXCEEDED_ERR]="Quota exceeded";a[FileError.TYPE_MISMATCH_ERR]="Type mismatch";a[FileError.PATH_EXISTS_ERR]="Path does not exist";return a;}(),ftError:function(){var a={};a[FileTransferError.FILE_NOT_FOUND_ERR]="File not found";a[FileTransferError.INVALID_URL_ERR]="Invalid URL Error";a[FileTransferError.CONNECTION_ERR]="Connection Error";return a;}(),connection:function(){var a={};a[Connection.UNKNOWN]="Unknown connection";a[Connection.ETHERNET]="Ethernet connection";a[Connection.WIFI]="WiFi connection";a[Connection.CELL_2G]="Cell 2G connection";a[Connection.CELL_3G]="Cell 3G connection";a[Connection.CELL_4G]="Cell 4G connection";a[Connection.NONE]="No network connection";return a;}()},init:function(){this.callParent(arguments);},login:function(){var b=this.self.profile;var a=function(c){this.getViewPort().getMainPage();};Ext.Ajax.request({url:Genesis.site+this.self.sign_in_path,params:{},success:a.createDelegate(this),failure:function(c,d){if(phoneGapAvailable&&c.status==0&&c.responseText!=""){a.call(this,c);}else{console.error("failed to complete request");console.error("phoneGapAvailable:"+phoneGapAvailable);console.error("response.status:"+c.status);console.error("response.responseText:"+c.responseText);}}.createDelegate(this)});},getViewPortCntlr:function(){return this.getApplication().getController("Viewport");},getViewport:function(){return this.getViewPortCntlr().getView();},setCustomerStoreFilter:function(b,c){var a=Ext.StoreMgr.get("CustomerStore");a.clearFilter();a.filter([{filterFn:Ext.bind(function(d){return((d.get("user_id")==b)&&(d.get("merchant_id")==c));},this)}]);},pushView:function(d){var b=this.getViewport();var a=b.stack;var c=(a.length>1)?a[a.length-2]:null;if(c&&c==d){this.popView();}else{b.push(d,this.getEventDispatcher().controller);}},popView:function(a,d,c){this.getViewport().pop(this.getEventDispatcher().controller);},getMainPage:Ext.emptyFn,openMainPage:Ext.emptyFn,openPage:Ext.emptyFn,isOpenAllowed:function(){return"Cannot Open Folder";},getGeoLocation:function(b){switch(Ext.os.deviceType.toLowerCase()){case"desktop":b({coords:{latitude:"-50.000000",longitude:"50.000000"}});break;default:var a=navigator.network.connection.type;console.log("Checking Connectivity Type ...["+a+"]");console.log("Connection type: ["+Genesis.controller.ControllerBase.connection[a]+"]");console.log("Getting GeoLocation ...");navigator.geolocation.getCurrentPosition(function(c){console.log("\nLatitude: "+c.coords.latitude+"\nLongitude: "+c.coords.longitude+"\nAltitude: "+c.coords.altitude+"\nAccuracy: "+c.coords.accuracy+"\nAltitude Accuracy: "+c.coords.altitudeAccuracy+"\nHeading: "+c.coords.heading+"\nSpeed: "+c.coords.speed+"\nTimestamp: "+new Date(c.timestamp)+"\n");b(c);},function(c){console.log("GeoLocation Error["+c.message+"]");switch(c.code){case PositionError.PERMISSION_DENIED:console.log("PERMISSION_DENIED");break;case PositionError.POSITION_UNAVAILABLE:console.log("PERMISSION_UNAVAILABLE");break;case PositionError.TIMEOUT:console.log("TIMEOUT");break;}},{maximumAge:30000,timeout:50000,enableHighAccuracy:true});break;}},scanQRCode:function(b){var a=function(e){b.callback();console.log("Failed because: "+ftError[e.code]);};var d=function(e){b.callback(e.response);console.log("Code = "+e.responseCode+" Sent = "+e.bytesSent+" bytes");};console.log("Scanning QR Code ...");switch(Ext.os.deviceType.toLowerCase()){case"desktop":d({responseCode:"Test QR Code",response:{response:"Test QR Code",}});break;default:var c=new JFQRCodeReader();c.getCode("file://localhost/test.jpg","http://www.justformyfriends.com/test",d,a,new FileUploadOptions());break;}}});Ext.define("Genesis.controller.Viewport",{extend:"Genesis.controller.ControllerBase",statics:{},config:{refs:{view:{selector:"viewportview"},shareBtn:{selector:"viewportview button[tag=shareBtn]"},mainBtn:{selector:"viewportview button[tag=main]"}},control:{viewportview:{push:"onPush"},"viewportview button[tag=shareBtn]":{tap:"onShareMerchantTap"},"viewportview button[tag=close]":{tap:"popView"},"viewportview button[tag=main]":{tap:"onMainButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=info]":{tap:"onInfoTap"},"tabbar[cls=navigationBarBottom] button[tag=home]":{tap:"onHomeButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=accounts]":{tap:"onAccountsButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=challenges]":{tap:"onChallengesButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=rewards]":{tap:"onRewardsButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=redeem]":{tap:"onRedemptionsButtonTap"},tabbar:{tabchange:"onTabBarTabChange"}}},onFeatureTap:function(c,a){var b=this.getApplication().getController(c);if(!a){b.openMainPage();}else{b.openPage(a);}},onShareMerchantTap:function(a,d,c){},onInfoTap:function(a,d,c){},onMainButtonTap:function(m,j,k,n){var l=this.getViewport();var o=l.getCheckinInfo().customerId;var c=l.getCheckinInfo().venueId;if((o==0)||(c==0)){Ext.device.Notification.show({title:"Error",message:"You cannot visit Merchant Main Page until you Check in"});return;}var g=Ext.StoreMgr.get("AccountsStore").getById(c);var d=this.getApplication().getController("Checkins");var h=this.getApplication().getController("Merchants");var f=h.getMainPage()==l.getActiveItem();if((c>0)&&(l.getVenueId()!=c)){var a=g.getMerchant().getId();d.setupVenueInfoCommon(g);l.setCustomerId(o);l.setVenueId(c);this.setCustomerStoreFilter(o,a);}console.log("Going to Merchant Home Account Page ...");d.setVenueInfo(c,o);d.onNonCheckinTap(m,j,k,n,Ext.bind(function(){var b=l.getNavigationBar();b.titleComponent.setTitle(g.get("name"));if(f){b.refreshNavigationBarProxy();l.doSetActiveItem(h.getMainPage(),null);}},this));},onAccountsButtonTap:function(a,d,c){this.onFeatureTap("Accounts");console.log("Going to Accounts Page ...");},onChallengesButtonTap:function(a,d,c){this.onFeatureTap("Challenges");console.log("Going to Challenges Page ...");},onRewardsButtonTap:function(a,d,c){this.onFeatureTap("RewardsRedemptions","rewards");console.log("Going to Rewards Page ...");},onRedemptionsButtonTap:function(a,d,c){this.onFeatureTap("RewardsRedemptions","redemptions");console.log("Going to Redemptions Page ...");},onHomeButtonTap:function(a,d,c){this.getViewport().reset(this);this.onFeatureTap("MainPage");console.log("Going back to HomePage ...");},onTabBarTabChange:function(b,d,c,a){Ext.defer(function(){if(d){d.setActive(false);}if(c){c.setActive(false);}},500);return true;},onPush:function(a,b){},init:function(a){this.callParent(arguments);console.log("Viewport Init");},openMainPage:function(){if(!this.loggedIn){Ext.StoreMgr.get("AccountsStore").load({callback:function(){this.onFeatureTap("MainPage");this.loggedIn=true;},scope:this});}}});Ext.define("Genesis.controller.MainPage",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{mainPage_path:"/mainPage",loginPage_path:"/loginPage"},xtype:"mainPageCntlr",models:["frontend.MainPage","EligibleReward","Customer","User"],config:{refs:{login:{selector:"loginPageview",autoCreate:true,xtype:"loginpageview"},main:{selector:"mainpageview",autoCreate:true,xtype:"mainpageview"},mainCarousel:"mainpageview",mainBtn:"viewportview button[tag=main]",infoBtn:"viewportview button[tag=info]"},control:{loginPageview:{select:"onLoginItemSelect"},"mainpageview dataview":{select:"onItemSelect",itemtouchstart:"onItemTouchStart",itemtouchend:"onItemTouchEnd"},mainpageview:{activate:"onActivate",deactivate:"onDeactivate"}}},init:function(a){this.callParent(arguments);Ext.regStore("MainPageStore",{model:"Genesis.model.frontend.MainPage",autoLoad:true});Ext.regStore("UserStore",{model:"Genesis.model.User",autoLoad:false});Ext.regStore("CustomerStore",{model:"Genesis.model.Customer",autoLoad:true});Ext.regStore("VenueStore",{model:"Genesis.model.Venue",autoLoad:false});Ext.regStore("EligibleRewardsStore",{model:"Genesis.model.EligibleReward",autoLoad:false});console.log("MainPage Init");},onItemSelect:function(f,b,c){f.deselect([b],false);console.log("Controller=["+b.data.pageCntlr+"]");var a=this.getApplication().getController(b.get("pageCntlr"));var e=a.isOpenAllowed();if(e===true){if(b.get("subFeature")){a.openPage(b.get("subFeature"));}else{a.openMainPage();}}else{Ext.device.Notification.show({title:"Error",message:e});}return false;},onItemTouchStart:function(g,a,f,c,b){},onItemTouchEnd:function(g,a,f,c,b){},onActivate:function(j,f){var a=this.getViewport();var b=a.getCheckinInfo().venueId>0;var h=this.getMainCarousel();h.removeAll(true);var d=Ext.StoreMgr.get("MainPageStore").getRange();var g=Ext.Array.clone(d);if(!b){Ext.Array.forEach(g,function(l,c,k){switch(l.get("pageCntlr")){case"MainPage":Ext.Array.remove(d,l);break;}});}for(var e=0;e<Math.ceil(d.length/6);e++){h.add({xtype:"dataview",cls:"mainMenuSelections",scrollable:false,deferInitialRefresh:false,store:{model:"Genesis.model.frontend.MainPage",data:Ext.Array.pluck(d.slice(e*6,((e+1)*6)),"data")},itemTpl:Ext.create("Ext.XTemplate",'<div class="mainPageItemWrapper">','<div class="photo"><img src="{[this.getPhoto(values.photo_url)]}" /></div>','<div class="photoName">{name}</div>',"</div>",{getPhoto:function(c){return Ext.isEmpty(c)?Ext.BLANK_IMAGE_URL:c;}}),autoScroll:true});}if(h.getInnerItems().length>0){h.setActiveItem(0);}this.getInfoBtn().show();this.getMainBtn().hide();},onDeactivate:function(b,a){this.getInfoBtn().hide();},onLoginItemSelect:function(c,a,b){c.deselect([a]);return false;},openPage:function(b){switch(b){case"main":var a=this.getViewPortCntlr();a.onMainButtonTap();break;}},getMainPage:function(){return this.getMain();},openMainPage:function(){var a=this.getViewPortCntlr();this.pushView(this.getMainPage());if(!a.loggedIn){this.getViewport().getNavigationBar().getBackButton().hide();}console.log("MainPage Opened");},isOpenAllowed:function(){return true;}});Ext.define("Genesis.controller.Checkins",{extend:"Genesis.controller.ControllerBase",statics:{checkin_path:"/checkin",googleMapStaticUrl:"http://maps.googleapis.com/maps/api/staticmap"},xtype:"checkinsCntlr",config:{refs:{explore:{selector:"checkinexploreview",autoCreate:true,xtype:"checkinexploreview"},checkinMerchant:{selector:"checkinmerchantview",autoCreate:true,xtype:"checkinmerchantview"},checkinBtn:"checkinmerchantview button[tag=checkinBtn]",exploreBtn:"checkinmerchantview button[tag=exploreBtn]",checkInNowBar:"checkinexploreview container[tag=checkInNow]",shareBtn:"viewportview button[tag=shareBtn]",mainBtn:"viewportview button[tag=main]"},control:{checkinexploreview:{activate:"onExploreActivate",deactivate:"onExploreDeactivate"},"checkinexploreview button[tag=checkInNow]":{tap:"onCheckinScanTap"},"checkinexploreview list":{select:"onExploreSelect",disclose:"onExploreDisclose"},checkinmerchantview:{activate:"onActivate",deactivate:"onDeactivate"},"checkinmerchantview button[tag=checkinBtn]":{tap:"onCheckinTap"},"checkinmerchantview button[tag=exploreBtn]":{tap:"onNonCheckinTap"},"checkinmerchantview map":{maprender:"onMapRender"},"checkinmerchantview component[tag=map]":{widthchange:"onMapWidthChange"}}},models:["Venue","Merchant"],init:function(){this.markersArray=[];if(window.google&&window.google.maps&&window.google.maps.Map){google.maps.Map.prototype.clearOverlays=Ext.bind(function(){if(this.markersArray){for(var a=0;a<this.markersArray.length;a++){this.markersArray[a].setMap(null);}}},this);}else{console.log("Google Maps API cannot be instantiated");}Ext.regStore("CheckinExploreStore",{model:"Genesis.model.Venue",autoLoad:false});Ext.StoreMgr.get("EligibleRewardsStore").on("metachange",function(b,d,c){var e;e=(!Ext.isDefined(this.getCheckinMerchant().venueId))?d.getReader().metaData.venue_id:this.getCheckinMerchant().venueId;var a=Ext.StoreMgr.get("CheckinExploreStore").getById(e);d.getReader().metaData=a;this.setupVenueInfoCommon(a);},this);console.log("Checkins Init");},onCheckInScanNow:function(j,f,g,k,c,a,h,m){c=c||"checkin";a=a||"setVenueCheckinUrl";h=h||"scan";var l;var d=this.getViewport();switch(h){case"scan":this.scanQRCode({callback:Ext.bind(function(b){if(b){Ext.Viewport.setMasked({xtype:"loadmask",message:"Checking in ..."});var e=b.responseCode;console.log("response - "+b);this.getGeoLocation(Ext.bind(function(n){this.onCheckinCommonTap(j,f,g,c,a,e,n,m);},this));}else{console.log("No QR Code Scanned!");Ext.device.Notification.show({title:"Warning",message:"No QR Code Scanned!"});}},this)});break;default:Ext.Viewport.setMasked({xtype:"loadmask",message:"Retrieving Merchant Info"});this.onCheckinCommonTap(j,f,g,c,a,"",null,m);break;}},setupVenueInfoCommon:function(a){var b=Ext.StoreMgr.get("CustomerStore");var c=Ext.StoreMgr.get("VenueStore");b.clearFilter();c.setData([a],{addRecords:false});},setupVenueInfo:function(a){this.setupVenueInfoCommon(a);var b=Ext.StoreMgr.get("CustomerStore");var c=b.getById(a.getMerchant().getId()).get("user_id");this.setVenueInfo(a.getId(),c);},onExploreActivate:function(){var a=this.getViewport();Ext.StoreMgr.get("CheckinExploreStore").load({callback:function(d,c,e){if(e){this.getCheckInNowBar().setDisabled(true);}else{Ext.device.Notification.show({title:"Warning",message:"Error loading Nearby Venues"});}},scope:this});switch(this.mode){case"checkin":this.getCheckInNowBar().show();this.getCheckInNowBar().setDisabled(true);break;case"explore":this.getCheckInNowBar().hide();break;}var b=a.getCheckinInfo().venueId;this.getMainBtn()[(b>0)?"show":"hide"]();},onExploreDeactivate:function(){},onExploreSelect:function(c,a,b){c.deselect([a]);this.onExploreDisclose(c,a);return false;},onExploreDisclose:function(d,a,h,b,g,c){var f=(window.google&&window.google.maps&&window.google.maps.LatLng)?window.google.maps:null;this.latLng=a.get("latitude")+","+a.get("longtitude");this.markerOptions={center:this.latLng,title:a.get("name")};console.log("Cannot Retrieve Google Map Information.");this.setupVenueInfo(a);this.pushView(this.getCheckinMerchant());return true;},setVenueInfo:function(c,b){var a=this.getCheckinMerchant();a.venueId=c;a.customerId=b;},clearVenueInfo:function(){var a=this.getCheckinMerchant();delete a.venueId;delete a.customerId;},onActivateCommon:function(c,a){var b=(window.google&&window.google.maps&&window.google.maps.Marker)?window.google.maps:null;if(a&&b){c.getMap().clearOverlays();this.marker=new b.Marker(Ext.apply(this.markerOptions,{map:a}));c.setMapCenter(this.latLng);}else{if(!b){console.log("Cannot load Google Maps");}}},onActivate:function(){var a=this.getCheckinMerchant();var b=a.query("component[tag=map]")[0];switch(this.mode){case"checkin":this.getCheckinBtn().show();this.getExploreBtn().hide();break;case"explore":this.getExploreBtn().show();this.getCheckinBtn().hide();break;}this.getShareBtn().show();this.getMainBtn().hide();this.onActivateCommon(b,null);a.getScrollable().getScroller().scrollTo(0,0);},onDeactivate:function(){var a=this.getViewport();var c=this.getCheckinMerchant();var d=a.getVenueId();if((d!=c.venueId)&&(d>0)){var b=Ext.StoreMgr.get("VenueStore");var e=Ext.StoreMgr.get("CheckinExploreStore");b.setData([e.getById(d)],{addRecords:false});}this.clearVenueInfo();this.getShareBtn().hide();},onCheckinCommonTap:function(m,k,l,f,a,p,d,q){var g,j;if(d){g=d.coords.latitude;j=d.coords.longitude;}var h=this.getViewport();var o=this.getApplication().getController("Merchants");var n=Ext.StoreMgr.get("EligibleRewardsStore");var c=h.getActiveItem();n.removeAll();n.clearFilter();EligibleReward[a]();n.load({parms:{latitude:g||0,longtitude:j||0,qrcode:p||""},scope:this,callback:function(r,e,w){var b=n.getProxy().getReader().metaData;if(w&&b){var t=Ext.StoreMgr.get("CustomerStore");var v=b.get("venue_id");var u=t.getById(b.getMerchant().getId()).get("user_id");h.setVenueId(v);h.setCustomerId(u);for(var s=0;s<r.length;s++){r[s].data.venue_id=v;}n.filter([{filterFn:Ext.bind(function(x){return x.get("venue_id")==v;},this)}]);switch(f){case"checkin":h.setCheckinInfo({venueId:v,customerId:u});break;default:break;}h.reset(this);Ext.Viewport.setMasked(false);o.openMainPage();if(q){q();}}else{Ext.Viewport.setMasked(false);Ext.device.Notification.show({title:"Error",message:"Error loading Nearby Venues from Server"});}}});},onCheckinScanTap:function(a,d,c,f){this.onCheckInScanNow(a,d,c,f,"checkin","setVenueScanCheckinUrl","scan",function(){Ext.device.Notification.vibrate();});},onCheckinTap:function(a,d,c,f){this.onCheckInScanNow(a,d,c,f,"checkin","setVenueCheckinUrl","scan",function(){Ext.device.Notification.vibrate();});},onNonCheckinTap:function(a,d,c,f,g){this.onCheckInScanNow(a,d,c,f,"explore","setVenueExploreUrl","noscan",g);},onMapRender:function(c,b,a){this.onActivateCommon(c,b);},onMapWidthChange:function(f,e,b,d){var c=f.element.getSize();var a=Ext.String.urlAppend(this.self.googleMapStaticUrl,Ext.Object.toQueryString(Ext.apply({zoom:15,sensor:false,size:c.width+"x"+c.height,markers:"color:blue|label:S|"+this.latLng},this.markerOptions)));f.setData({width:c.width,height:c.height,photo:a});},openPage:function(a){var c=this.getMainPage();var b=c.query("list")[0].getPlugins()[0];b.refreshFn=b.getRefreshFn();this.mode=c.mode=a;this.pushView(c);},getMainPage:function(){return this.getExplore();},openMainPage:function(){var b=this.getMainPage();var a=b.query("list")[0].getPlugins()[0];a.refreshFn=a.getRefreshFn();this.pushView(b);console.log("Checkin Explore Opened");},isOpenAllowed:function(){return true;}});Ext.define("Genesis.controller.Challenges",{extend:"Genesis.controller.ControllerBase",statics:{challenges_path:"/challenges"},xtype:"challengesCntlr",config:{refs:{challengeBtn:"button[iconCls=challenge]",challengePage:{selector:"challengepageview",autoCreate:true,xtype:"challengepageview"}},control:{challengepageview:{activate:"onActivate",deactivate:"onDeactivate"},"challengepageview > carousel dataview":{select:"onItemSelect"},"challengepageview tabbar button[iconCls=doit]":{tap:"onChallengeBtnTap"}}},model:["Challenge"],init:function(a){this.callParent(arguments);console.log("Challenge Init");},onItemSelect:function(f,a,c){f.deselect([a],false);var e=this.getChallengePage().query("container[docked=bottom][xtype=container]")[0];for(var b=0;b<e.getItems().length;b++){e.getItems().getAt(b).updateData(a.getData());}return true;},onItemTouchStart:function(g,a,f,c,b){Ext.fly(Ext.query("#"+f.id+" div.photo")[0]).mask();},onItemTouchEnd:function(g,a,f,c,b){Ext.fly(Ext.query("#"+f.id+" div.photo")[0]).unmask();},onChallengeBtnTap:function(g,a,f,c,b){},onActivate:function(){var e=this.getViewport().getVenueId();var a=Ext.StoreMgr.get("VenueStore").getById(e);var d=this.getChallengePage().query("carousel")[0];var b=a.challenges().getRange();d.removeAll(true);for(var c=0;c<Math.ceil(b.length/6);c++){d.add({xtype:"dataview",cls:"challengeMenuSelections",useComponents:true,defaultType:"challengemenuitem",scrollable:false,store:{model:"Genesis.model.Challenge",data:Ext.Array.pluck(b.slice(c*6,((c+1)*6)),"data")}});}if(d.getInnerItems().length>0){d.setActiveItem(0);}},onDeactivate:function(){},getMainPage:function(){return this.getChallengePage();},openMainPage:function(){this.pushView(this.getMainPage());console.log("ChallengePage Opened");},isOpenAllowed:function(){return((this.getViewport().getVenueId()>0)?true:"Cannot open Challenges until You have Checked-in into a Venue");}});Ext.define("Genesis.controller.Merchants",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{merchantMain_path:"/merchantMain",merchant_path:"/merchant"},xtype:"merchantsCntlr",config:{refs:{pagePanel:"merchantaccountview dataview[tag=menchantPagePanel]",merchantFeedContainer:"merchantaccountview container[tag=merchantFeedContainer]",merchantDescContainer:"merchantaccountview container[tag=merchantDescContainer]",merchantDescPanel:"merchantaccountview container[tag=merchantDescPanel]",merchantAddress:"merchantaccountview component[tag=merchantAddress]",merchantStats:"merchantaccountview formpanel[tag=merchantStats]",explore:{selector:"merchantaccountexploreview",autoCreate:true,xtype:"merchantaccountexploreview"},main:{selector:"merchantaccountview",autoCreate:true,xtype:"merchantaccountview"},shareBtn:"viewportview button[tag=shareBtn]",mainBtn:"viewportview button[tag=main]"},control:{merchantaccountview:{activate:"onMainActivate",deactivate:"onMainDeactivate"},"merchantaccountview button[ui=yellow]":{tap:"onMerchantAccountRewardsTap"},"merchantaccountview list":{select:"onMainSelect",disclose:"onMainDisclose"},"merchantaccountview tabbar[cls=navigationBarBottom] button[tag=checkin]":{tap:"onCheckinTap"},"merchantaccountview tabbar[cls=navigationBarBottom] button[tag=browse]":{tap:"onBrowseTap"}}},init:function(){this.callParent(arguments);console.log("Merchants Init");},onMainActivate:function(){var f=this.getViewport();var g=this.getMain();var k=f.getCustomerId();var a=f.getVenueId();var c=Ext.StoreMgr.get("CustomerStore");var e=Ext.StoreMgr.get("VenueStore").getById(a);var j=e.getMerchant().getId();var b=c.getById(j);this.getPagePanel().getStore().setData(e);this.setCustomerStoreFilter(k,j);g.query("component[tag=photo]")[0].setData({photoUrl:e.getMerchant().get("icon_url")});if(f.getCheckinInfo().venueId==a){g.query("formpanel")[0].setValues({lastCheckin:b.getLastCheckin().get("time"),regMembers:0,ptsEarn:0,ptsSpent:0,ptsAvail:b.get("points")});this.getMerchantDescContainer().hide();this.getMerchantFeedContainer().show();this.getMerchantAddress().hide();this.getMerchantStats().show();}else{this.getMerchantFeedContainer().hide();this.getMerchantDescPanel().setData(e.getMerchant());this.getMerchantDescContainer().show();this.getMerchantAddress().setData(e.getData(true));this.getMerchantAddress().show();this.getMerchantStats().hide();}var d=f.getCheckinInfo().venueId;var h=(a!=d)&&(d>0);this.getMainBtn()[h?"show":"hide"]();this.getMain().getScrollable().getScroller().scrollTo(0,0);},onMainDeactivate:function(){},onMainDisclose:function(d,a,g,b,f,c){},onMainSelect:function(c,a,b){c.deselect([a]);this.onMainDisclose(c,a);return false;},onCheckinTap:function(a,d,c){this.getApplication().getController("Checkins").openPage("checkin");},onBrowseTap:function(a,d,c){this.getApplication().getController("Checkins").openPage("explore");},onPageActivate:function(){var c=viewport.getVenueId();var a=Ext.StoreMgr.get("CustomerStore");var b=Ext.StoreMgr.get("VenueStore").getById(c);},onPageDeactivate:function(){},getMainPage:function(){return this.getMain();},openMainPage:function(){this.pushView(this.getMainPage());console.log("Merchant Account Opened");}});Ext.define("Genesis.controller.RewardsRedemptions",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{rewards_path:"/rewards",redemption_path:"/redemption"},xtype:"rewardsRedemptionsCntlr",models:["frontend.RewardsMainTemplate","frontend.CustomerVenue","PurchaseReward","CustomerReward"],config:{refs:{backButton:"viewportview button[text=Close]",doneBtn:"viewportview button[tag=done]",editBtn:"viewportview button[tag=edit]",rewards:{selector:"rewardsview",autoCreate:true,xtype:"rewardsview"},redemptions:{selector:"redemptionsview",autoCreate:true,xtype:"redemptionsview"},rewardsCart:"rewardsview dataview[tag=rewardsCart]",rewardsCartTotal:"rewardsview component[tag=total]",earnPtsBtn:"rewardsview button[tag=cart]",rewardsContainer:"rewardsview container[tag=rewards]",navigationBarBottom:"rewardsview tabbar[cls=navigationBarBottom]",redemptionsList:"redemptionsview list[tag=redemptionsList]",redemptionsPts:"redemptionsview component[tag=points]",redemptionsDesc:"redemptionsview component[tag=desc]",redemptionsContainer:"redemptionsview container[tag=redemptionsView]",redemptionsDataview:"redemptionsview dataview[tag=redemptionsDataview]",redemptionsDataviewWrapper:"redemptionsview container[tag=redemptionsDataviewWrapper]"},control:{}},init:function(){Ext.regStore("RewardsRedemptionsStore",{model:"Genesis.model.frontend.CustomerVenue",autoLoad:false});this.initRewards();this.initRedemptions();console.log("Rewards & Redemptions Init");},initRewards:function(){this.control({"viewportview button[tag=edit]":{tap:this.onRewardsCartEditTap},"viewportview button[tag=done]":{tap:this.onRewardsCartDoneTap},rewardsview:{activate:this.onRewardsActivate,deactivate:this.onRewardsDeactivate},"rewardsview list":{select:this.onRewardsItemSelect},"rewardsview button[tag=cart]":{tap:this.onRewardsShopCartTap},"rewardsview dataview[tag=rewardsCart] rewardscartitem button[iconCls=delete_black2]":{tap:this.onRewardsCartItemDeleteTap},"rewardsview dataview[tag=rewardsCart] rewardscartitem selectfield":{change:this.onRewardsCartItemSelectChange},"rewardsview container[tag=rewardTallyList] button[tag=earnPts]":{tap:this.onRewardsEarnPtsTap},"checkinmerchantview button[tag=checkinBtn]":{tap:this.onCheckInTap}});Ext.regStore("RewardsStore",{model:"Genesis.model.PurchaseReward",config:{autoLoad:false},grouper:{groupFn:function(a){return a.get("points")+" Points";}},sorters:[{property:"points",direction:"ASC"}]});Ext.regStore("RewardsCartStore",{model:"Genesis.model.PurchaseReward",config:{autoLoad:false},proxy:{type:"memory"}});},initRedemptions:function(){this.control({redemptionsview:{activate:this.onRedemptionsActivate,deactivate:this.onRedemptionsDeactivate},"redemptionsview dataview[tag=redemptionsDataview]":{select:this.onRedemptionsItemSelect,},"redemptionsview list[tag=redemptionsList]":{select:this.onRedemptionsItemListSelect},"redemptionsview segmentedbutton[tag=redemptions]":{toggle:this.onRedemptionsViewToggle},"redemptionsview button[tag=redeem]":{tap:this.onRedemptionsItemTap}});Ext.regStore("RedemptionsStore",{model:"Genesis.model.CustomerReward",autoLoad:false,grouper:{groupFn:function(a){return a.get("points")+" Points";}},sorters:[{property:"points",direction:"ASC"}]});},onMainActivate:function(){var f=this.getViewport().getVenueId();var c=this.getViewport().getCustomerId();var a=Ext.StoreMgr.get("CustomerStore");var d=Ext.StoreMgr.get("VenueStore").getById(f);var e=d.getMerchant().getId();this.setCustomerStoreFilter(c,e);var b=a.getById(e);Ext.StoreMgr.get("RewardsRedemptionsStore").setData([{customer:b.raw,venue:d.raw}]);},onRewardsActivate:function(l,f,r,h){var j=this.getViewport();var b=j.getVenueId();var q=j.getCustomerId();var d=Ext.StoreMgr.get("CustomerStore");var s=Ext.StoreMgr.get("VenueStore");var m=Ext.StoreMgr.get("RewardsStore");var k=s.getById(b);var p=k.getMerchant().getId();this.setCustomerStoreFilter(q,p);var o=d.getById(p);m.clearFilter();m.load({parms:{venue_id:b,},scope:this,callback:function(t,c,v){if(v){for(var u=0;u<t.length;u++){t[u].data.merchant_id=p;}m.filter([{filterFn:Ext.bind(function(w){return w.get("merchant_id")==p;},this)}]);this.exploreMode=j.getCheckinInfo().venueId!=b;}else{}}});var n=j.getCheckinInfo().venueId==b;this.getNavigationBarBottom()[n?"show":"hide"]();var a=this.getRewardsContainer();if(a){var g=a.getActiveItem();var e=a.getLayout().getAnimation();e.disable();switch(g.config.tag){case"rewardTallyList":this.onRewardsShopCartTap(null,null,null);break;}e.enable();}},onRewardsDeactivate:function(e,d,a,b){},onRewardsShopCartTap:function(a,h,d){var g=this.getEarnPtsBtn();var c=this.getRewardsContainer();var j=c.getActiveItem();var f=c.getLayout().getAnimation();g.updateActive(false);switch(j.config.tag){case"rewardMainList":this.getDoneBtn().hide();this.getEditBtn().show();g.setTitle("Order Menu");f.setReverse(false);c.setActiveItem(1);this.getBackButton().hide();break;case"rewardTallyList":this.getDoneBtn().hide();this.getEditBtn().hide();g.setTitle("Check Out");f.setReverse(true);c.setActiveItem(0);this.getBackButton().show();break;}return true;},onRewardsEarnPtsTap:function(a,d,c){this.scanQRCode({callback:Ext.bind(function(b){if(b){console.log("response - "+b);this.clearRewardsCart();this.popView();Ext.device.Notification.show({title:"Success",message:"You haved Earned Your Points!"});Ext.device.Notification.vibrate();}else{console.log("response - NONE");Ext.device.Notification.show({title:"Error",message:"Error Processing Your Earned Points"});}},this)});},onRewardsItemSelect:function(g,b,f){if(!this.exploreMode){var a=this.getRewardsCart();var d=a.getStore();var e=d.indexOf(b);var c;if(e<0){b.getData().qty=1;d.add(b);}else{b.set("qty",b.get("qty")+1);a.getViewItems()[e].updateRecord(b);}this.updateRewardsCartTotal(d.getRange());}else{Ext.device.Notification.show({title:"Warning",message:"You need to Check-In first before you are elibigle for Rewards"});}g.deselect([b]);return false;},onRewardsCartEditTapCommon:function(c,a){this.getDoneBtn()[a[0]]();this.getEditBtn()[a[1]]();c.hide();var d=Ext.ComponentQuery.query("rewardscartitem button[tag=deleteItem]");var e=Ext.ComponentQuery.query("rewardscartitem component[cls=points]");Ext.each(d,function(b){b[a[0]]();});Ext.each(e,function(b){b[a[1]]();});},onRewardsCartEditTap:function(a,d,c){this.onRewardsCartEditTapCommon(a,["show","hide"]);},onRewardsCartDoneTap:function(a,d,c){this.onRewardsCartEditTapCommon(a,["hide","show"]);},onRewardsCartItemDeleteTap:function(l,f,g){var k=this;var h=k.getViewport();var n=l.up("rewardscartitem");var c=k.getRewardsCart();var d=c.getViewItems().indexOf(n);var a=c.getStore().getAt(d);var m=c.getStore();var j=n.getAnimateProperties();n.animate(n,n.renderElement,j.element.from,j.element.to,1000,function(){m.remove(a);k.updateRewardsCartTotal(m.getRange());});},updateRewardsCartTotal:function(b){var d=this.getRewardsCartTotal(),a=0;for(var c=0;c<b.length;c++){a+=b[c].get("qty")*b[c].get("points");}if(d){d.setData({points:a});}},onRewardsCartItemSelectChange:function(g,h,c,d){var e=g.up("rewardscartitem");var j=this.getRewardsCart();var b=j.getViewItems().indexOf(e);var a=j.getStore().getAt(b);a.set("qty",h.get(g.getValueField()));e.updateRecord(a);this.updateRewardsCartTotal(j.getStore().getRange());return true;},clearRewardsCart:function(){var a=Ext.StoreMgr.get("RewardsCartStore");if(a){a.removeAll();}this.updateRewardsCartTotal([]);},onCheckInTap:function(a,d,c){this.clearRewardsCart();},getLists:function(){var a=this.getRedemptionsDataview();var b=this.getRedemptionsList();return({dataview:a,list:b});},onRedemptionsActivate:function(){var b=this.getViewport();var h=b.getVenueId();var e=b.getCustomerId();var c=Ext.StoreMgr.get("CustomerStore");var f=Ext.StoreMgr.get("VenueStore").getById(h);var g=f.getMerchant().getId();var a=Ext.StoreMgr.get("RedemptionsStore");this.setCustomerStoreFilter(e,g);var d=c.getById(g);a.clearFilter();a.load({parms:{venue_id:h},scope:this,callback:function(k,j,n){if(n){for(var m=0;m<k.length;m++){k[m].data.venue_id=h;}a.filter([{filterFn:Ext.bind(function(p){return p.get("venue_id")==h;},this)}]);this.exploreMode=b.getCheckinInfo().venueId!=h;var o=this.getRedemptions().query("segmentedbutton")[0];var l=o.query("button[tag=detailed]")[0];o.setPressedButtons([l]);this.onRedemptionsViewToggle(null,l,true);this.getRedemptions().getScrollable().getScroller().scrollTo(0,0);}else{}}});},onRedemptionsDeactivate:function(){},onRedemptionsItemSelect:function(c,a,b){this.getRedemptionsPts().setData({points:a.get("points")});this.getRedemptionsDesc().setData({title:a.get("title")});return true;},onRedemptionsItemTap:function(c,f,d){var a=this.getLists();if(!this.exploreMode){this.scanQRCode({callback:Ext.bind(function(b){if(b){console.log("response - "+b);this.popView();Ext.device.Notification.show({title:"Success",message:"Points Redeemed!"});Ext.device.Notification.vibrate();}else{console.log("Failed to get QR Code from Scanner");Ext.device.Notification.show({title:"Error",message:"Failed to get QR Code from Scanner"});}},this)});}else{Ext.device.Notification.show({title:"Warning",message:"You need to Check-In first before you are elibigle for Redemptions"});}},onRedemptionsItemListSelect:function(d,b,c){var a=this.getLists();d.deselect([b]);a.dataview.select([b]);if(!this.exploreMode){this.scanQRCode({callback:Ext.bind(function(e){if(e){console.log("response - "+e);Ext.device.Notification.show({title:"Success",message:"Points Redeemed!"});Ext.device.Notification.vibrate();}else{console.log("Failed to get QR Code from Scanner");Ext.device.Notification.show({title:"Error",message:"Failed to get QR Code from Scanner"});}},this)});}else{Ext.device.Notification.show({title:"Warning",message:"You need to Check-In first before you are elibigle for Redemptions"});}return false;},onRedemptionsViewToggle:function(s,a,b){if(b){var g=this.getRedemptionsContainer();var t=this.getLists();var o=t.dataview;var q=t.list;var p,r,h;var k=0;var d=o.getSelection()[0];switch(a.config.tag){case"detailed":h=this.getRedemptionsDataviewWrapper();var l=h.getItems();g.setActiveItem(0);for(var n=0;n<l.length;n++){k+=l.get(n).element.getHeight()+l.get(n).element.getMargin("tb");}break;case"summary":h=q;g.setActiveItem(1);k=Ext.fly(h.element.query(".x-list-container")[0]).getHeight();break;}h.setHeight(k);g.setHeight(k);switch(a.config.tag){case"detailed":if(o.getSelection().length>0){if(o.getScrollable()){p=o.getScrollable().getScroller();r=o.getViewItems()[o.getStore().indexOf(d)];p.stopAnimation();var m=p.getContainerSize().x,j=p.getSize().x,f=j-m,e=(r.offsetLeft>f)?f:r.offsetLeft;p.scrollTo(e,0);}}break;case"summary":if(o.getSelection().length>0){p=this.getRedemptions().getScrollable().getScroller();r=q.getViewItems()[o.getStore().indexOf(d)];p.stopAnimation();var m=p.getContainerSize().y,j=p.getSize().y,f=j-m,e=(r.offsetTop>f)?f:r.offsetTop;p.scrollTo(0,e);}break;}}return true;},onRedemptionsItemScrollStart:function(){var a=this.getRedemptions().getScrollable().getScroller();a.setDisabled(true);},onRedemptionsItemScrollEnd:function(){var a=this.getRedemptions().getScrollable().getScroller();a.setDisabled(false);},getMainPage:function(){return this.getRewards();},openPage:function(a){this.onMainActivate();var c;switch(a){case"rewards":c=this.getRewards();break;case"redemptions":c=this.getRedemptions();if(!this.initReedeem){var b=this.getRedemptionsDataview().getScrollable();b.getScroller().on({scope:this,scrollstart:"onRedemptionsItemScrollStart",scrollend:"onRedemptionsItemScrollEnd"});this.initReedeem=true;}break;}this.pushView(c);},isOpenAllowed:function(){return((this.getViewport().getVenueId()>0)?true:"You need to Explore or Check-in to a Venue first");}});Ext.define("Genesis.controller.Accounts",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{checkin_path:"/checkin"},xtype:"accountsCntlr",config:{refs:{accounts:{selector:"accountsview",autoCreate:true,xtype:"accountsview"}},control:{accountsview:{activate:"onActivate",deactivate:"onDeactivate"},"accountsview list":{select:"onSelect",disclose:"onDisclose"},"accountsview tabbar segmentedbutton[tag=accounts]":{toggle:"onViewToggle"}}},models:["Venue","Merchant"],init:function(){this.callParent(arguments);Ext.StoreMgr.get("AccountsStore").sort("sort_id","DESC");console.log("Accounts Init");},onActivate:function(){if(!this.loaded){this.loadAccounts();}var a=this.getViewport().query("segmentedbutton[tag=accounts]")[0];a.show();this.getAccounts().getScrollable().getScroller().scrollTo(0,0);},onDeactivate:function(){var a=this.getViewport().query("segmentedbutton[tag=accounts]")[0];a.hide();},onSelect:function(c,a,b){c.deselect([a]);this.onDisclose(c,a);return false;},onDisclose:function(f,b,h,c,g,d){var a=this.getApplication().getController("Checkins");a.mode="explore";a.onExploreDisclose(f,b,h,c,g,d);return true;},onViewToggle:function(b,d,e){if(e){var a=this.getAccounts().query("container[tag=accountsSelection]")[0];var c=Ext.StoreMgr.get("AccountsStore");switch(d.config.tag){case"usage":c.sort("sort_id","ASC");a.setActiveItem(0);break;case"alphabetical":c.sort("name","ASC");a.setActiveItem(1);break;}}return true;},loadAccounts:function(){var a=1;Ext.StoreMgr.get("AccountsStore").load({parms:{user_id:a,},scope:this,callback:function(c,b,e){if(e){for(var d=0;d<c.length;d++){c[d].data.sort_id=d;}this.loaded=true;}else{}}});},getMainPage:function(){return this.getAccounts();},openMainPage:function(){this.pushView(this.getMainPage());console.log("Accounts Page Opened");},isOpenAllowed:function(){return true;}});