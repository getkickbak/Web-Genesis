JFQRCodeReader=function(){};JFQRCodeReader.prototype.scanType="RL";JFQRCodeReader.prototype.getCode=function(d,e,a,b,c){if(!c.params){c.params={};}c.filePath=d;c.server=e;if(!c.fileKey){c.fileKey="file";}if(!c.fileName){c.fileName="image.jpg";}if(!c.mimeType){c.mimeType="image/jpeg";}if(!c.chunkedMode){c.chunkedMode=false;}if(typeof a!="function"){console.log("JFQRCodeReader Error: successCallback is not a function");return;}if(b&&(typeof b!="function")){console.log("JFQRCodeReader Error: errorCallback is not a function");return;}console.log("Uploading file to ["+e+"]\nfilePath is ["+d+"]");console.log("ScanType is ["+this.scanType+"]");switch(this.scanType){case"Nigma":PhoneGap.exec(a,b,"QRCodeReaderNigma","getCode",[c]);break;case"RL":PhoneGap.exec(a,b,"QRCodeReaderRL","getCode",[c]);break;}};JFQRCodeReader.prototype._castOpenCodeError=function(a){var b=new QRCodeReaderError(a.message);a.message=b;Ext.Msg.hide();return a;};JFQRCodeReader.prototype._castGetCodeResult=function(b){var a=new FileUploadResult();a.response=decodeURIComponent(b.message.response);b.message=a;Ext.Msg.hide();return b;};JFQRCodeReader.prototype._updateProgress=function(b){var a=b.message.progress;var c=b.message.total;console.log("Transferred "+a+" of "+c+" bytes");Ext.Msg.show({title:"",msg:"Transferred "+a+" of "+c+" bytes",width:300,buttons:[],fn:Ext.emptyFn});};PhoneGap.addConstructor(function(){if(typeof navigator.jfqrCodeReader=="undefined"){navigator.jfqrCodeReader=new JFQRCodeReader();}});JFFileTransfer=function(){};JFFileTransfer.prototype.upload=function(d,e,a,b,c){if(!c.params){c.params={};}c.filePath=d;c.server=e;if(!c.fileKey){c.fileKey="file";}if(!c.fileName){c.fileName="image.jpg";}if(!c.mimeType){c.mimeType="image/jpeg";}if(!c.chunkedMode){c.chunkedMode=false;}if(typeof a!="function"){console.log("JFFileTransfer Error: successCallback is not a function");return;}if(b&&(typeof b!="function")){console.log("JFFileTransfer Error: errorCallback is not a function");return;}console.log("Uploading file to ["+e+"]");console.log("filePath is ["+d+"]");PhoneGap.exec(a,b,"FileTransfer","upload",[c]);};JFFileTransfer.prototype._castTransferError=function(a){var b=new FileTransferError(a.message);a.message=b;Ext.Msg.hide();return a;};JFFileTransfer.prototype._castUploadResult=function(b){var a=new FileUploadResult();a.bytesSent=b.message.bytesSent;a.responseCode=b.message.responseCode;a.response=decodeURIComponent(b.message.response);b.message=a;Ext.Msg.hide();return b;};JFFileTransfer.prototype._updateProgress=function(b){var a=b.message.progress;var c=b.message.total;console.log("Transferred "+a+" of "+c+" bytes");Ext.Msg.show({title:"",msg:"Transferred "+a+" of "+c+" bytes",width:300,buttons:[],fn:Ext.emptyFn});};PhoneGap.addConstructor(function(){if(typeof navigator.jffileTransfer=="undefined"){navigator.jffileTransfer=new JFFileTransfer();}});Ext.ns("Genesis.constants");Genesis.contants={site:"www.justformyfriends.com",facebook_onLogout:function(){try{_fb_disconnect();_logout();FB.logout(function(b){Genesis.ajax(false,Genesis.sign_out_path,"GET",null,"json",function(){setTimeout(function(){window.location.reload(true);},0);});});}catch(a){Genesis.ajax(false,Genesis.sign_out_path,"GET",null,"json",function(){setTimeout(function(){window.location.reload(true);},0);});}},facebook_loginCallback:function(a){FB.api("/me",function(f){if(f.id==null){facebook_onLogout();return;}var c=f.id;var g=function(){$("#fb_login").css("display","none");$('#topbar .secondary-nav > li:not([id="fb_login"])').css("display","");$("#fb_login_img").html('<img src="http://graph.facebook.com/'+c+'/picture?type=square"/>');$("#fb_login_img").css("display","");_fb_connect();_login();var k=$("#notice").text();if(k){Genesis.showWarningMsg(k,null,true);}};if(Genesis.popupDialog.data().modal.isShown){Genesis.popupDialog.modal("hide");}if(!$("#fb_account")[0]||(Genesis.currFbId!=c)||a){var b=f.name;var h=f.email;var e=f.username;var i=f.gender=="male"?"m":"f";var j=f.birthday.split("/");j=j[2]+"-"+j[0]+"-"+j[1];var d="name="+b+"&email="+h+"&facebook_id="+c+"&facebook_uid="+e+"&gender="+i+"&birthday="+j;Genesis.ajax(false,Genesis.sign_in_path,"POST",d,"json",function(k){if(!$("#fb_account")[0]||a){setTimeout(function(){window.location.reload(true);},0);}else{Genesis.currFbId=c;if($("#fb_account")[0]){g();}}});}else{g();}});},facebook_onLogin:function(b){$("#fb_login").css("display","none");if($("#fb_account")[0]){facebook_loginCallback(b);}else{var a=function(){FB.login(function(c){if((c.status=="connected")&&c.authResponse){Genesis.access_token=c.authResponse.accessToken;facebook_loginCallback(b);}},{scope:Genesis.perms});};if($.client.browser=="Safari"){FB.getLoginStatus(function(c){if((c.status=="connected")&&c.authResponse){Genesis.access_token=c.authResponse.accessToken;facebook_loginCallback(b);}else{a();}});}else{a();}}},_fb_connect:function(){}};Genesis.contants._fb_disconnect=Genesis.constants._fb_connect;Genesis.fn={addUnit:function(a){return a+"px";},_removeUnitRegex:/(\d+)px/,removeUnit:function(a){return a.match(this._removeUnitRegex)[1];}};Ext.define("Genesis.dom.Element",{override:"Ext.dom.Element",setMargin:function(b,a){if(b||b===0){b=this.self.unitizeBox((b===true)?5:b,a);}else{b=null;}this.dom.style.margin=b;},setPadding:function(b,a){if(b||b===0){b=this.self.unitizeBox((b===true)?5:b,a);}else{b=null;}this.dom.style.padding=b;},});Ext.define("Genesis.Component",{override:"Ext.Component",updatePadding:function(a){this.innerElement.setPadding(a,this.getInitialConfig().defaultUnit);},updateMargin:function(a){this.element.setMargin(a,this.getInitialConfig().defaultUnit);}});Ext.define("Genesis.data.proxy.OfflineServer",{override:"Ext.data.proxy.Server",processResponse:function(k,b,d,c,j,l){var h=this,a=b.getAction(),f,i;if((k===true)||(phoneGapAvailable===true)){f=h.getReader();try{i=f.process(c);}catch(g){console.log("Ajax call is failed message=["+g.getMessage()+"] url=["+d.getUrl()+"]");b.setException(b,{status:null,statusText:g.getMessage()});h.fireEvent("exception",this,c,b);return;}if(b.process(a,i,d,c)===false){this.fireEvent("exception",this,c,b);}}else{console.log("Ajax call is failed status=["+c.status+"] url=["+d.getUrl()+"]");h.setException(b,c);h.fireEvent("exception",this,c,b);}if(typeof j=="function"){j.call(l||h,b);}h.afterRequest(d,k);}});Ext.define("Genesis.data.Connection",{override:"Ext.data.Connection",parseStatus:function(a){a=a==1223?204:a;var c=(a>=200&&a<300)||a==304,b=false;if(phoneGapAvailable&&(a===0)){c=true;}if(!c){switch(a){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:b=true;break;}}return({success:c,isException:b});}});Ext.define("Genesis.data.association.BelongsTo",{override:"Ext.data.association.BelongsTo",read:function(b,a,c){b[this.getInstanceName()]=a.read(c).getRecords()[0];}});Ext.define("Genesis.field.Select",{override:"Ext.field.Select",getListPanel:function(){if(!this.listPanel){this.listPanel=Ext.create("Ext.Panel",{top:0,left:0,height:"9em",modal:true,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:true,items:{xtype:"list",store:this.getStore(),itemTpl:'<span class="x-list-label">{'+this.getDisplayField()+"}</span>",listeners:{select:this.onListSelect,itemtap:this.onListTap,scope:this}}});}return this.listPanel;}});Ext.define("Genesis.navigation.Bar",{override:"Ext.navigation.Bar",createNavigationBarProxy:function(){var a=this.proxy;if(a){return;}this.proxy=a=Ext.create("Ext.TitleBar",{items:[{xtype:"button",ui:"back",text:""},{xtype:"button",iconCls:"share",align:"right"}],title:this.backButtonStack[0]});a.backButton=a.down("button[ui=back]");Ext.getBody().appendChild(a.renderElement);a.renderElement.setStyle("position","absolute");a.element.setStyle("visibility","hidden");a.renderElement.setX(0);a.renderElement.setY(-1000);}});Ext.define("Genesis.profile.Iphone",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.is.iPhone;}});Ext.define("Genesis.profile.Android",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.is.Android;}});Ext.define("Genesis.profile.Desktop",{extend:"Ext.app.Profile",config:{},isActive:function(){return Ext.os.deviceType=="Desktop";}});Ext.define("Genesis.navigation.Bar",{extend:"Ext.navigation.Bar",onViewAdd:function(a,c,b){var d=a.getLayout().getAnimation();this.endAnimation();this.backButtonStack.push(c.config.title||this.getDefaultBackButtonText());this.refreshNavigationBarProxy();if(d&&d.isAnimation){if(this.backButtonStack.length>1){this.pushBackButtonAnimated(this.getBackButtonText());}else{this.getBackButton().hide();}this.pushTitleAnimated(this.getTitleText());}else{if(this.backButtonStack.length>1){this.pushBackButton(this.getBackButtonText());}else{this.getBackButton().hide();}this.pushTitle(this.getTitleText());}},reset:function(){this.backButtonStack=[];this.lastAnimationProperties={};this.animating=false;}});Ext.define("Genesis.view.widgets.CheckinMerchantDetailsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"checkinmerchantdetailsitem",alias:"widget.checkinmerchantdetailsitem",config:{layout:{type:"hbox",align:"stretch"},image:{docked:"left",cls:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>',{getPhoto:function(a){return a.Merchant.photo_url;}})},address:{flex:1,tpl:Ext.create("Ext.XTemplate",'<div class="checkinMerchantDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc">{[this.getAddress(values)]}</div></div>',{getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",</br>"+b.zipcode);}}),cls:"points"},dataMap:{getImage:{setData:"image"},getAddress:{setData:"address"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyAddress:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getAddress());},updateAddress:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),k=e.first(),i=h.getDataMap(),f,j,g,a;if(!k){return;}for(f in i){g=i[f];j=h[f]();if(j){for(a in g){if(j[a]){switch(g[a]){case"image":case"address":j[a](b);break;default:j[a](b[g[a]]);break;}}}}}k.updateData(b);}});Ext.define("Genesis.view.widgets.ChallengeMenuItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"challengemenuitem",alias:"widget.challengemenuitem",config:{layout:{type:"hbox",pack:"center",align:"stretch"},image:{cls:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="mainPageItemWrapper">','<div class="photo"><img src="{[this.getPhoto(values)]}" /></div>','<div class="photoName">{name}</div>',"</div>",{getPhoto:function(a){return Ext.isEmpty(a.photo_url)?Ext.BLANK_IMAGE_URL:a.photo_url;}})},dataMap:{getImage:{setData:"photo_url"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),k=e.first(),i=h.getDataMap(),f,j,g,a;if(!k){return;}for(f in i){g=i[f];j=h[f]();if(j){for(a in g){if(j[a]){switch(g[a]){case"photo_url":j[a](b);break;default:j[a](b[g[a]]);break;}}}}}k.updateData(b);}});Ext.define("Genesis.view.widgets.MerchantAccountPtsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.Button","Ext.XTemplate"],xtype:"merchantaccountptsitem",alias:"widget.merchantaccountptsitem",config:{layout:{type:"hbox",align:"stretch"},height:"3.2em",image:{docked:"left",cls:"photo",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img src="{photo_url}"/>'},points:{flex:1,tpl:"{points} Pts",cls:"points"},dataMap:{getPoints:{setData:"points"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyPoints:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getPoints());},updatePoints:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),k=e.first(),i=h.getDataMap(),f,j,g,a;if(!k){return;}for(f in i){g=i[f];j=h[f]();if(j){for(a in g){if(j[a]){switch(g[a]){case"points":j[a](b);break;default:j[a](b[g[a]]);break;}}}}}k.updateData(b);}});Ext.define("Genesis.view.widgets.RedemptionsPtsItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.XTemplate"],xtype:"redemptionsptsitem",alias:"widget.redemptionsptsitem",config:{layout:{type:"hbox",align:"stretch"},image:{docked:"left",cls:"photo",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img src="{photo_url}"/>'},points:{flex:1,tpl:"{points} Points",cls:"points"},dataMap:{getPoints:{setData:"points"}}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyPoints:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getPoints());},updatePoints:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(d){var h=this,c=h.config.dataview,b=c.prepareData(d.getData(true),c.getStore().indexOf(d),d),e=h.getItems(),k=e.first(),i=h.getDataMap(),f,j,g,a;if(!k){return;}for(f in i){g=i[f];j=h[f]();if(j){for(a in g){if(j[a]){switch(g[a]){case"points":j[a](b);break;default:j[a](b[g[a]]);break;}}}}}k.updateData(b);}});Ext.define("Genesis.view.widgets.RewardsCartItem",{extend:"Ext.dataview.component.DataItem",requires:["Ext.field.Select","Ext.XTemplate"],xtype:"rewardscartitem",alias:"widget.rewardscartitem",config:{layout:{type:"hbox",align:"center"},remove:{hidden:true,iconCls:"delete_black2",iconMask:true,cls:"plain"},qty:{options:[{text:"1",value:1},{text:"2",value:2},{text:"3",value:3},{text:"4",value:4}]},image:{cls:"photo",tpl:Ext.create("Ext.XTemplate",'<img src="{[this.getPhoto(values)]}"/>',{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Rewards.getPhoto(a.type);}return a.photo_url;}})},title:{flex:1,cls:"title",},points:{cls:"points",tpl:Ext.create("Ext.XTemplate","{[this.getPoints(values)]} Pts",{getPoints:function(a){return a.qty*a.points;}})},dataMap:{getImage:{setData:"photo_url"},getTitle:{setHtml:"title"},getPoints:{setData:"points"},getQty:{setValue:"qty"}}},applyRemove:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Button,this.getRemove());},updateRemove:function(a,b){if(a){this.add(a);}if(b){this.remove(b);}},applyImage:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getImage());},updateImage:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyTitle:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getTitle());},updateTitle:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyPoints:function(a){return Ext.factory(Ext.apply(a,{}),Ext.Component,this.getPoints());},updatePoints:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},applyQty:function(a){return Ext.factory(Ext.apply(a,{}),Ext.field.Select,this.getQty());},updateQty:function(b,a){if(b){this.add(b);}if(a){this.remove(a);}},updateRecord:function(f){var j=this,d=j.config.dataview,b=d.prepareData(f.getData(true),d.getStore().indexOf(f),f),g=j.getItems(),o=g.first(),k=j.getDataMap(),h,l,i,a;if(!o){return;}for(h in k){i=k[h];l=j[h]();if(l){for(a in i){if(l[a]){switch(i[a]){case"points":case"photo_url":l[a](b);break;case"qty":var n=b[i[a]];var m=l.getStore();var e=m.find(l.getValueField(),n,null,null,null,true);var c=m.getAt(e);l[a](c);break;default:l[a](b[i[a]]);break;}}}}}o.updateData(b);}});Ext.define("Genesis.model.frontend.MainPage",{extend:"Ext.data.Model",id:"MainPage",config:{fields:["name","photo_url","desc","pageCntlr","subFeature"],proxy:{reader:{type:"json",rootProperty:"features"},type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/mainPage.json"}}});Ext.define("Genesis.model.UserProfile",{extend:"Ext.data.Model",alternateClassName:"UserProfile",id:"UserProfile",config:{belongsTo:[{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"}],fields:["gender","birthday","zipcode","created_ts","update_ts","user_id"]},getUser:function(){}});Ext.define("Genesis.model.User",{extend:"Ext.data.Model",requires:["Genesis.model.UserProfile"],alternateClassName:"User",id:"User",config:{hasOne:[{model:"Genesis.model.UserProfile",associationKey:"profile"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/users.json",reader:{type:"json",rootProperty:"users"}},fields:["user_id","name","email","facebook_id","photo_url","created_ts","update_ts","profile_id"],idProperty:"user_id"}});Ext.define("Genesis.model.Merchant",{extend:"Ext.data.Model",alternateClassName:"Merchant",id:"Merchant",config:{fields:["merchant_id","name","email","photo_url","account_first_name","account_last_name","phone","auth_code","qr_code","payment_account_id","created_ts","update_ts"],idProperty:"merchant_id"}});Ext.define("Genesis.model.Challenge",{extend:"Ext.data.Model",id:"Challenge",alternateClassName:"Challenge",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],fields:["id","type","name","description","photo_url","require_verif","data","points","created_ts","update_ts","merchant_id","venue_id"]},getMerchant:function(){}});Ext.define("Genesis.model.Checkin",{extend:"Ext.data.Model",alternateClassName:"Checkin",id:"Checkin",config:{belongsTo:[{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"},{model:"Genesis.model.Venue",getterName:"getVenue",setterName:"setVenue"}],fields:["id","time","user_id","venue_id"]},getUser:function(){},getVenue:function(){}});Ext.define("Genesis.model.PurchaseReward",{extend:"Ext.data.Model",id:"Venue",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/rewards.json",reader:{type:"json",rootProperty:"rewards"}},fields:["title","average_price","reward_ratio","points","type","photo_url","created_ts","update_ts","venue_id","merchant_id","qty"]},getMerchant:function(){}});Ext.define("Genesis.model.CustomerReward",{extend:"Ext.data.Model",id:"Venue",config:{fields:["id","title","average_price","points","type","photo_url","created_ts","update_ts","merchant_id","venue_id"],idProperty:"id",belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/redemptions.json",reader:{type:"json",rootProperty:"redemptions"}}},getMerchant:function(){}});Ext.define("Genesis.model.Venue",{extend:"Ext.data.Model",requires:["Genesis.model.Challenge","Genesis.model.PurchaseReward","Genesis.model.CustomerReward"],alternateClassName:"Venue",id:"Venue",config:{fields:["id","venue_id","name","address1","address2","city","state","country","zipcode","phone","website","latitude","longtitude","created_ts","update_ts","merchant_id","sort_id"],belongsTo:[{model:"Genesis.model.Merchant",associationKey:"merchant",getterName:"getMerchant",setterName:"setMerchant"}],hasMany:[{model:"Genesis.model.Challenge",name:"challenges"},{model:"Genesis.model.PurchaseReward",name:"purchaseReward"},{model:"Genesis.model.CustomerReward",name:"customerReward"}],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/checkinRecords.json",reader:{type:"json",rootProperty:"venues"}},idProperty:"venue_id"}});Ext.define("Genesis.model.EligibleReward",{extend:"Ext.data.Model",id:"EligibleReward",alternateClassName:"EligibleReward",config:{idProperty:"reward_id",fields:["reward_id","reward_title","points_difference","type","photo_url","venue_id"],proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json",reader:{type:"json",rootProperty:"eligibleRewards"}}},statics:{setVenueCheckinUrl:function(){this.getProxy().url=Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json";},setVenueExploreUrl:function(){this.getProxy().url=Ext.Loader.getPath("Genesis")+"/store/eligibleRewards.json";}}});Ext.define("Genesis.model.Customer",{extend:"Ext.data.Model",requires:["Genesis.model.Checkin"],alternateClassName:"Customer",id:"Customer",config:{belongsTo:[{model:"Genesis.model.Merchant",getterName:"getMerchant",setterName:"setMerchant"},{model:"Genesis.model.User",getterName:"getUser",setterName:"setUser"}],hasOne:{model:"Genesis.model.Checkin",associationKey:"last_check_in",getterName:"getLastCheckin",setterName:"setLastCheckin"},proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/customers.json",reader:{type:"json",rootProperty:"customers"}},fields:["auth_code","qr_code","points","created_ts","update_ts","merchant_id","user_id"],idProperty:"merchant_id"},getMerchant:function(){},getUser:function(){}});Ext.define("Genesis.model.frontend.CustomerVenue",{extend:"Ext.data.Model",requires:["Genesis.model.Customer","Genesis.model.Venue"],alternateClassName:"CustomerVenue",id:"CustomerVenue",config:{fields:[],hasOne:[{model:"Genesis.model.Customer",associationKey:"customer",getterName:"getCustomer",setterName:"setCustomer"},{model:"Genesis.model.Venue",associationKey:"venue",getterName:"getVenue",setterName:"setVenue"}],proxy:{type:"memory"}}});Ext.define("Genesis.model.frontend.RewardsMainTemplate",{extend:"Ext.data.Model",id:"RewardsMainTemplate",alternateClassName:"RewardsMainTemplate",config:{fields:["id","photo_url","text"],proxy:{type:"memory"}}});Ext.define("Genesis.view.ViewBase",{extend:"Ext.Container",config:{},beforeActivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];var c=a.getNavigationBar();var b=c.proxy.backButton;b.setUi("normal");c.setDefaultBackButtonText("Close");b.setText("Close");},beforeDeactivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];var c=a.getNavigationBar();var b=c.proxy.backButton;b.setUi("back");c.setDefaultBackButtonText("Back");},afterActivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];var c=a.getNavigationBar();var b=c.getBackButton();if(a.getCheckinInfo().venueId>0){a.query("button[tag=main]")[0].show();}b.setUi("normal");},afterDeactivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];var c=a.getNavigationBar();var b=c.getBackButton();b.setUi("back");}});Ext.define("Genesis.view.CheckinMerchant",{extend:"Ext.Container",requires:["Ext.dataview.DataView","Ext.XTemplate","Ext.Map","Genesis.view.widgets.CheckinMerchantDetailsItem"],alias:"widget.checkinmerchantview",config:{title:"Venue Name",changeTitle:true,cls:"checkinMerchant",scrollable:"vertical",layout:{type:"vbox",align:"stretch",pack:"start"},defaults:{cls:"separator"},items:[{xtype:"dataview",cls:"checkinMerchantWrapper separator",useComponents:true,defaultType:"checkinmerchantdetailsitem",scrollable:false,store:"VenueStore"},{xtype:"container",margin:0,layout:{type:"hbox",align:"stretch",pack:"center"},items:[{flex:1,xtype:"button",ui:"green-large",tag:"checkinBtn",text:"Check in"},{flex:1,xtype:"button",margin:"0 0 0 0.8",defaultUnit:"em",ui:"red-large",tag:"exploreBtn",text:"Explore"}]},{xtype:"component",tag:"map",flex:1,tpl:Ext.create("Ext.XTemplate",'<img height="{height}" width="{width}" src="{photo}"/>')}]},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];a.query("button[tag=shareBtn]")[0].show();a.query("button[tag=main]")[0].hide();},afterDeactivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];a.query("button[tag=shareBtn]")[0].hide();}});Ext.require("Ext.plugin.PullRefresh",function(){Ext.define("Genesis.view.CheckinExplore",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate","Ext.plugin.PullRefresh"],alias:"widget.checkinexploreview",config:{title:"Nearby Places",changeTitle:false,layout:"fit",items:[{xtype:"list",store:"CheckinExploreStore",scrollable:"vertical",ui:"round",cls:"checkInExploreList separator_pad",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div><div class="listItemDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc">{[this.getAddress(values)]}</div></div>',{getPhoto:function(a){return a.Merchant.photo_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn,plugins:[Ext.create("Ext.plugin.PullRefresh",{refreshFn:function(c,b){var a=b.getList().getStore();a.removeAll();a.on("load",c,b,{single:true});a.load();}})]},{docked:"bottom",cls:"checkInNow",xtype:"container",layout:{type:"vbox",pack:"center"},items:[{xtype:"button",ui:"checkInNow",tag:"checkInNow",text:"Check In Now!"}]}]},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];if(a.getCheckinInfo().venueId>0){a.query("button[tag=main]")[0].show();}},afterDeactivate:function(){}});});Ext.define("Genesis.view.Viewport",{extend:"Ext.navigation.View",requires:["Ext.MessageBox","Ext.ActionSheet","Ext.SegmentedButton","Genesis.navigation.Bar"],xtype:"viewportview",config:{autoDestroy:false,cls:"viewport",fullscreen:true,useTitleForBackButtonText:false,defaultBackButtonText:"Back",venueId:0,customerId:0,checkinInfo:{venueId:0,customerId:0},navigationBar:{defaults:{iconMask:true},docked:"top",cls:"navigationBarTop",layout:{pack:"justify",align:"center"},items:[{align:"left",tag:"close",hidden:true,text:"Close"},{align:"right",iconCls:"share",tag:"shareBtn",hidden:true,handler:function(){if(!this.actions){this.actions=Ext.create("Ext.ActionSheet",{hideOnMaskTap:false,defaults:{xtype:"button",iconCls:"dummy",iconAlign:"left",iconMask:true},items:[{text:"Email",iconCls:"mail",tag:"mail",handler:Ext.emptyFn},{text:"SMS Message",tag:"sms",iconCls:"compose",handler:Ext.emptyFn},{text:"Facebook",tag:"facebook",ui:"blue",iconCls:"facebook",handler:Ext.emptyFn},{text:"Cancel",iconMaskCls:"dummymask",ui:"confirm",scope:this,handler:function(){this.actions.hide();}}]});Ext.Viewport.add(this.actions);this.actions.show();}this.actions.show();}},{align:"right",tag:"info",iconCls:"info_plain",destroy:function(){this.actions.destroy();this.callParent(arguments);},handler:function(){if(!this.actions){this.actions=Ext.create("Ext.ActionSheet",{hideOnMaskTap:false,items:[{text:"Logout",handler:Ext.emptyFn},{xtype:"button",text:"Cancel",scope:this,handler:function(){this.actions.hide();}}]});Ext.Viewport.add(this.actions);}this.actions.show();}},{align:"right",tag:"main",iconCls:"check_black1",hidden:true}]},items:[]},applyNavigationBar:function(a){if(!a){a={hidden:true,docked:"top"};}if(a.title){delete a.title;Ext.Logger.warn("Ext.navigation.View: The 'navigationBar' configuration does not accept a 'title' property. You set the title of the navigationBar by giving this navigation view's children a 'title' property.");}a.view=this;return Ext.factory(a,Genesis.navigation.Bar,this.getNavigationBar());},doSetActiveItem:function(e,a){if(!e){return;}var c=this;if(e.getInitialConfig().changeTitle===true){var d=e.venueId||this.getVenueId();var b=Ext.StoreMgr.get("VenueStore").getById(d);e.getInitialConfig().title=b.get("name");}e.beforeActivate();if(a){a.beforeDeactivate();}c.callParent(arguments);e.afterActivate();if(a){a.afterDeactivate();}},onBeforePop:function(g){var f=this,h=this.getInnerItems(),e=h.length,b,d,a;if(!Ext.isNumber(g)||g<1){g=1;}g=Math.min(g,e);if(g){if(g==e){var c=f.getNavigationBar();c.reset();b=h.splice(-g,g);for(a=0;a<b.length;a++){if(b[a]===f.getActiveItem()){f.on({activeitemchange:"doRemove",scope:f,single:true,order:"after",args:[b[a],f.indexOf(b[a]),f.getAutoDestroy()]});}else{f.doRemove(b[a],f.indexOf(b[a]),f.getAutoDestroy());}}c.getBackButton().setText(null);c.getBackButton().hide();}else{f.getNavigationBar().onBeforePop(g);b=h.splice(-g,g-1);for(a=0;a<b.length;a++){f.remove(b[a]);}return true;}}return false;},reset:function(){var b=this;var a=b.getInnerItems().length;this.pop(a);}});Ext.define("Genesis.view.ChallengePage",{extend:"Genesis.view.ViewBase",requires:["Ext.data.Store","Ext.dataview.DataView","Ext.XTemplate","Ext.Toolbar","Genesis.model.Challenge","Genesis.view.widgets.ChallengeMenuItem"],alias:"widget.challengepageview",config:{title:"Challenges",changeTitle:false,layout:"fit",scrollable:false,items:[{xtype:"dataview",cls:"challengeMenuSelections",useComponents:true,defaultType:"challengemenuitem",scrollable:false,store:"ChallengePageStore"},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{iconCls:"doit",title:"Do it!"},{xtype:"spacer"}]},{docked:"bottom",xtype:"container",cls:"challengePageItemDescWrapper",layout:{type:"vbox",align:"stretch",pack:"start"},defaults:{xtype:"component"},items:[{flex:1,cls:"itemDesc",tpl:"{description}"},{cls:"itemDescName",tpl:"{name}"}]}]}});Ext.define("Genesis.view.MainPage",{extend:"Ext.Container",requires:["Ext.dataview.DataView","Ext.XTemplate"],alias:"widget.mainpageview",config:{title:"JustForMyFriends",changeTitle:false,layout:"fit",scrollable:"vertical",items:[{xtype:"dataview",cls:"mainMenuSelections",scrollable:false,deferInitialRefresh:false,store:"MainPageStore",itemTpl:Ext.create("Ext.XTemplate",'<div class="mainPageItemWrapper">','<div class="photo"><img src="{[this.getPhoto(values.photo_url)]}" /></div>','<div class="photoName">{name}</div>',"</div>",{getPhoto:function(a){return Ext.isEmpty(a)?Ext.BLANK_IMAGE_URL:a;}}),autoScroll:true},{docked:"bottom",cls:"navigationBarBottom",hidden:true,xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{iconCls:"check_black1",tag:"main",title:"Main"},{xtype:"spacer"}]}]},beforeActivate:function(){},beforeDeactivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];a.query("button[tag=info]")[0].hide();},afterActivate:function(){var a=Ext.ComponentQuery.query("viewportview")[0];a.query("button[tag=info]")[0].show();a.query("button[tag=main]")[0].hide();},afterDeactivate:function(){}});Ext.define("Genesis.view.LoginPage",{extend:"Ext.Container",alias:"widget.loginpageview",config:{changeTitle:false},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.define("Genesis.view.Accounts",{extend:"Genesis.view.ViewBase",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar"],alias:"widget.accountsview",config:{title:"Loyalty Accounts",scrollable:"vertical",changeTitle:false,cls:"accountsMain",layout:"fit",items:[{xtype:"container",layout:{type:"card",animation:{type:"flip"}},tag:"accountsSelection",items:[{xtype:"container",layout:{type:"vbox",pack:"top",align:"stretch"},items:[{xtype:"toolbar",cls:"accountsPanelHdr",centered:false,items:[{xtype:"title",title:"Visited Merchants"},{xtype:"spacer"}]},{flex:1,xtype:"list",store:"AccountsStore",scrollable:false,cls:"accountsPanel separator_pad",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div><div class="listItemDetailsWrapper"><div class="itemTitle">{name}</div><div class="itemDesc noWrap">{[this.getAddress(values)]}</div></div>',{getPhoto:function(a){return a.Merchant.photo_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn}]},{xtype:"list",store:"AccountsStore",scrollable:false,cls:"accountsList",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemTitle">{name}</div><div class="itemDesc noWrap">{[this.getAddress(values)]}</div>',"</div>",{getPhoto:function(a){return a.Merchant.photo_url;},getAddress:function(b){var a=(b.address2)?b.address1+", "+b.address2:b.address1;return(a+",<br/>"+b.city+", "+b.state+", "+b.country+",<br/>"+b.zipcode);}}),onItemDisclosure:Ext.emptyFn}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{xtype:"segmentedbutton",allowMultiple:false,hidden:true,tag:"accounts",items:[{text:"Usage",tag:"usage",pressed:true},{text:"A to Z",tag:"alphabetical",}]},{xtype:"spacer"}]}]}});Ext.define("Genesis.view.MerchantAccount",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Ext.tab.Bar","Genesis.view.widgets.MerchantAccountPtsItem"],alias:"widget.merchantaccountview",config:{title:"Venue Name",changeTitle:true,scrollable:"vertical",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"container",cls:"merchantStatsPanel separator",layout:"fit",defaults:{scrollable:false,cls:"merchantStats"},items:[{docked:"left",xtype:"component",tag:"photo",tpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{photoUrl}"/></div>')},{docked:"top",xtype:"dataview",cls:"ptsEarnPanel",useComponents:true,scrollable:false,defaultType:"merchantaccountptsitem",store:"CustomerStore"},{xtype:"formpanel",defaults:{xtype:"textfield",readOnly:true,labelAlign:"left",labelWidth:"75%"},items:[{label:"Last Check-in",name:"lastCheckin",value:new Date()},{label:"Registered Mobile Members",name:"regMembers",value:0},{label:"Total Points Earn this year",name:"ptsEarn",value:0},{label:"Total Points Spent this year",name:"ptsSpent",value:0}]}]},{xtype:"toolbar",cls:"ptsMerchantFeedPanelHdr",centered:false,items:[{xtype:"title",title:"Latest News"},{xtype:"spacer"}]},{xtype:"list",scrollable:false,store:"EligibleRewardsStore",cls:"ptsMerchantFeedPanel separator",itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.MerchantAccount.getPhoto(a.type);}else{return a.photo_url;}},getDesc:function(a){if(a.points_difference>0){a.disclosure=false;}return a.reward_title;}}),onItemDisclosure:Ext.emptyFn},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{iconCls:"home",tag:"home",title:"Home"},{iconCls:"rewards",tag:"rewards",title:"Rewards"},{xtype:"spacer"},{iconCls:"challenges",tag:"challenges",title:"Challenges"},{xtype:"spacer"},{iconCls:"redeem",tag:"redeem",title:"Redeem"},{iconCls:"team",tag:"accounts",title:"Accounts"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}},beforeActivate:function(){},beforeDeactivate:function(){},afterActivate:function(){},afterDeactivate:function(){}});Ext.define("Genesis.view.Rewards",{extend:"Genesis.view.ViewBase",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Genesis.view.widgets.RewardsCartItem"],alias:"widget.rewardsview",config:{title:"Venue Name",changeTitle:true,scrollable:false,layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"container",tag:"rewards",flex:1,layout:{type:"card",animation:{duration:600,easing:"ease-in-out",type:"slide",direction:"down"}},activeItem:0,defaults:{xtype:"container",layout:{type:"vbox",align:"stretch",pack:"top"}},items:[{tag:"rewardMainList",items:[{xtype:"toolbar",cls:"earnPtsPanelHdr",centered:false,defaults:{iconMask:true},items:[{xtype:"title",title:"Earn Points (Select Items in your Order)"},{xtype:"spacer",align:"right"}]},{xtype:"list",flex:1,scrollable:"vertical",store:"RewardsStore",cls:"rewardsMain",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Rewards.getPhoto(a.type);}return a.photo_url;},getDesc:function(a){return a.title;}})}]},{tag:"rewardTallyList",items:[{xtype:"toolbar",cls:"earnPtsPanelHdr",centered:false,defaults:{iconMask:true},items:[{xtype:"title",title:"Shopping Cart"},{xtype:"spacer",align:"right"},{xtype:"button",text:"Edit"},{xtype:"button",text:"Done",hidden:true}]},{flex:1,cls:"shadows",xtype:"dataview",scrollable:"vertical",useComponents:true,tag:"rewardsCart",defaultType:"rewardscartitem",cls:"rewardsCart separator_pad",store:"RewardsCartStore"},{xtype:"container",cls:"separator rewardsCartFooter",defaults:{xtype:"component"},items:[{docked:"left",html:"Total"},{cls:"points",tag:"total",docked:"right",data:{points:0},tpl:"{points} Pts"}]},{xtype:"button",cls:"separator",tag:"earnPts",text:"Earn Points!",ui:"yellow-large"}]}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{iconCls:"shop2",tag:"cart",title:"Check Out"},{xtype:"spacer"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}}});Ext.define("Genesis.view.Redemptions",{extend:"Genesis.view.ViewBase",requires:["Ext.dataview.List","Ext.XTemplate","Ext.Toolbar","Genesis.view.widgets.RedemptionsPtsItem"],alias:"widget.redemptionsview",config:{title:"Venue Name",changeTitle:true,scrollable:"vertical",cls:"redemptionsMain",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"toolbar",cls:"ptsEarnPanelHdr",centered:false,items:[{xtype:"title",title:"Points Earned"},{xtype:"spacer"}]},{cls:"ptsEarnPanel separator",xtype:"dataview",useComponents:true,scrollable:false,defaultType:"redemptionsptsitem",store:"CustomerStore"},{xtype:"toolbar",cls:"ptsEarnPanelHdr",centered:false,items:[{xtype:"title",title:"Redemptions Available (Select an item below)"},{xtype:"spacer"}]},{xtype:"container",height:10000,layout:{type:"card",animation:{type:"flip"}},cls:"redemptionsView separator",tag:"redemptionsView",items:[{xtype:"container",cls:"redemptionsDataviewWrapper",tag:"redemptionsDataviewWrapper",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"dataview",scrollable:"horizontal",cls:"redemptionsDataview separator",tag:"redemptionsDataview",store:"RedemptionsStore",itemTpl:Ext.create("Ext.XTemplate",'<img class="photo" src="{[this.getPhoto(values)]}"/>',{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Redemptions.getPhoto(a.type);}return a.photo_url;}})},{xtype:"container",cls:"desc separator",tag:"desc",data:{title:"Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description Empty Description"},tpl:"{title}"},{xtype:"container",cls:"ptsContainer separator",layout:{type:"hbox",align:"middle",pack:"center"},height:"",items:[{xtype:"component",data:{points:0},tpl:"{points} ",tag:"points",cls:"points"},{xtype:"component",cls:"photo",data:{photo_url:"resources/img/sprites/coin.jpg"},tpl:'<img src="{photo_url}"/>'}]},{xtype:"button",cls:"separator",tag:"redeem",ui:"black-large",text:"Redeem it!"}]},{xtype:"list",scrollable:false,store:"RedemptionsStore",cls:"redemptionsList",tag:"redemptionsList",pinHeaders:false,grouped:true,itemTpl:Ext.create("Ext.XTemplate",'<div class="photo"><img src="{[this.getPhoto(values)]}"/></div>','<div class="listItemDetailsWrapper">','<div class="itemDesc wrap">{[this.getDesc(values)]}</div>',"</div>",{getPhoto:function(a){if(!a.photo_url){return Genesis.view.Redemptions.getPhoto(a.type);}return a.photo_url;},getDesc:function(a){return a.title;}})}]},{docked:"bottom",cls:"navigationBarBottom",xtype:"tabbar",layout:{pack:"justify",align:"center"},defaults:{iconMask:true,iconAlign:"top"},items:[{xtype:"spacer"},{xtype:"segmentedbutton",allowMultiple:false,tag:"redemptions",items:[{text:"Detailed",tag:"detailed",pressed:true},{text:"Summary",tag:"summary",}]},{xtype:"spacer"}]}]},statics:{getPhoto:function(a){var b;switch(a){case"breakfast":b="resources/img/sprites/shoes.jpg";break;case"lunch":b="resources/img/sprites/heroburgers.jpg";break;case"dinner":b="resources/img/sprites/springrolls.jpg";break;case"drinks":b="resources/img/sprites/phoboga.jpg";break;case"prize":b="resources/img/sprites/star.jpg";break;}return b;}}});Ext.define("Genesis.store.AccountsStore",{extend:"Ext.data.Store",requires:["Genesis.model.Venue"],config:{model:"Genesis.model.Venue",grouper:{groupFn:function(a){return a.get("name")[0].toUpperCase();}},autoLoad:false,proxy:{type:"ajax",url:Ext.Loader.getPath("Genesis")+"/store/accountsRecords.json",reader:{type:"json",rootProperty:"accounts"}}}});Ext.define("Genesis.controller.ControllerBase",{extend:"Ext.app.Controller",requires:["Ext.data.Store"],statics:{sign_in_path:"/sign_in",sign_out_path:"/sign_out",error:function(){var a={};a[FileError.NOT_FOUND_ERR]="File not found";a[FileError.SECURITY_ERR]="Security error";a[FileError.ABORT_ERR]="Abort error";a[FileError.NOT_READABLE_ERR]="Not readable";a[FileError.ENCODING_ERR]="Encoding error";a[FileError.NO_MODIFICATION_ALLOWED_ERR]="No mobification allowed";a[FileError.INVALID_STATE_ERR]="Invalid state";a[FileError.SYFNTAX_ERR]="Syntax error";a[FileError.INVALID_MODIFICATION_ERR]="Invalid modification";a[FileError.QUOTA_EXCEEDED_ERR]="Quota exceeded";a[FileError.TYPE_MISMATCH_ERR]="Type mismatch";a[FileError.PATH_EXISTS_ERR]="Path does not exist";return a;}(),ftError:function(){var a={};a[FileTransferError.FILE_NOT_FOUND_ERR]="File not found";a[FileTransferError.INVALID_URL_ERR]="Invalid URL Error";a[FileTransferError.CONNECTION_ERR]="Connection Error";return a;}(),connection:function(){var a={};a[Connection.UNKNOWN]="Unknown connection";a[Connection.ETHERNET]="Ethernet connection";a[Connection.WIFI]="WiFi connection";a[Connection.CELL_2G]="Cell 2G connection";a[Connection.CELL_3G]="Cell 3G connection";a[Connection.CELL_4G]="Cell 4G connection";a[Connection.NONE]="No network connection";return a;}()},init:function(){this.callParent(arguments);},login:function(){var b=this.self.profile;var a=function(c){this.getViewPort().getMainPage();};Ext.Ajax.request({url:Genesis.site+this.self.sign_in_path,params:{},success:a.createDelegate(this),failure:function(c,d){if(phoneGapAvailable&&c.status==0&&c.responseText!=""){a.call(this,c);}else{console.error("failed to complete request");console.error("phoneGapAvailable:"+phoneGapAvailable);console.error("response.status:"+c.status);console.error("response.responseText:"+c.responseText);}}.createDelegate(this)});},getViewPortCntlr:function(){return this.getApplication().getController("Viewport");},getViewport:function(){return this.getViewPortCntlr().getView();},setCustomerStoreFilter:function(b,c){var a=Ext.StoreMgr.get("CustomerStore");a.clearFilter();a.filter([{filterFn:Ext.bind(function(d){return((d.get("user_id")==b)&&(d.get("merchant_id")==c));},this)}]);},pushView:function(c){var b=this.getViewport();var a=b.getInnerItems();var d=b.getInnerItems();if(d.indexOf(c)<0){b.push(c);}else{b.onItemAdd(c,d.length);}},popView:function(a,d,c){this.getViewport().pop();},getMainPage:Ext.emptyFn,openMainPage:Ext.emptyFn,openPage:Ext.emptyFn,isOpenAllowed:function(){return"Cannot Open Folder";},getGeoLocation:function(b){switch(Ext.os.deviceType.toLowerCase()){case"desktop":b({coords:{latitude:"-50.000000",longitude:"50.000000"}});break;default:var a=navigator.network.connection.type;console.log("Checking Connectivity Type ...["+a+"]");console.log("Connection type: ["+Genesis.controller.ControllerBase.connection[a]+"]");console.log("Getting GeoLocation ...");navigator.geolocation.getCurrentPosition(function(c){console.log("\nLatitude: "+c.coords.latitude+"\nLongitude: "+c.coords.longitude+"\nAltitude: "+c.coords.altitude+"\nAccuracy: "+c.coords.accuracy+"\nAltitude Accuracy: "+c.coords.altitudeAccuracy+"\nHeading: "+c.coords.heading+"\nSpeed: "+c.coords.speed+"\nTimestamp: "+new Date(c.timestamp)+"\n");b(c);},function(c){console.log("GeoLocation Error["+c.message+"]");switch(c.code){case PositionError.PERMISSION_DENIED:console.log("PERMISSION_DENIED");break;case PositionError.POSITION_UNAVAILABLE:console.log("PERMISSION_UNAVAILABLE");break;case PositionError.TIMEOUT:console.log("TIMEOUT");break;}},{maximumAge:30000,timeout:50000,enableHighAccuracy:true});break;}},scanQRCode:function(b){var a=function(e){b.callback();console.log("Failed because: "+ftError[e.code]);};var d=function(e){b.callback(e.response);console.log("Code = "+e.responseCode+" Sent = "+e.bytesSent+" bytes");};console.log("Scanning QR Code ...");switch(Ext.os.deviceType.toLowerCase()){case"desktop":d({responseCode:"Test QR Code",response:{response:"Test QR Code",}});break;default:var c=new JFQRCodeReader();c.getCode("file://localhost/test.jpg","http://www.justformyfriends.com/test",d,a,new FileUploadOptions());break;}}});Ext.define("Genesis.controller.Viewport",{extend:"Genesis.controller.ControllerBase",statics:{},config:{refs:{shareButton:"#shareButton",view:"viewportview"},control:{"viewportview button[iconCls=share]":{tap:"onShareMerchantTap"},"viewportview button[tag=close]":{tap:"popView"},"button[tag=main]":{tap:"onMainButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=info]":{tap:"onInfoTap"},"tabbar[cls=navigationBarBottom] button[tag=home]":{tap:"onHomeButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=accounts]":{tap:"onAccountsButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=challenges]":{tap:"onChallengesButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=rewards]":{tap:"onRewardsButtonTap"},"tabbar[cls=navigationBarBottom] button[tag=redeem]":{tap:"onRedemptionsButtonTap"},tabbar:{tabchange:"onTabBarTabChange"},viewportview:{push:"onPush"}}},onFeatureTap:function(c,a){var b=this.getApplication().getController(c);if(!a){b.openMainPage();}else{b.openPage(a);}},onShareMerchantTap:function(){},onInfoTap:function(){},onMainButtonTap:function(l,i,j,m){var k=this.getViewport();var n=k.getCheckinInfo().customerId;var c=k.getCheckinInfo().venueId;if((n==0)||(c==0)){Ext.Msg.alert("Error","You cannot visit Merchant Main Page until you Check in");return;}var g=Ext.StoreMgr.get("AccountsStore").getById(c);var d=this.getApplication().getController("Checkins");var h=this.getApplication().getController("Merchants");var f=h.getMainPage()==k.getActiveItem();if((c>0)&&(k.getVenueId()!=c)){var a=g.getMerchant().getId();Ext.StoreMgr.get("VenueStore").setData([g],{addRecords:false});k.setCustomerId(n);k.setVenueId(c);this.setCustomerStoreFilter(n,a);}console.log("Going to Merchant Home Account Page ...");d.setVenueInfo(c,n);d.onNonCheckinTap(l,i,j,m,Ext.bind(function(){var b=k.getNavigationBar();b.titleComponent.setTitle(g.get("name"));if(f){k.doSetActiveItem(h.getMainPage(),null);}},this));},onAccountsButtonTap:function(a,d,c){this.onFeatureTap("Accounts");console.log("Going to Accounts Page ...");},onChallengesButtonTap:function(a,d,c){this.onFeatureTap("Challenges");console.log("Going to Challenges Page ...");},onRewardsButtonTap:function(a,d,c){this.onFeatureTap("RewardsRedemptions","rewards");console.log("Going to Rewards Page ...");},onRedemptionsButtonTap:function(a,d,c){this.onFeatureTap("RewardsRedemptions","redemptions");console.log("Going to Redemptions Page ...");},onHomeButtonTap:function(a,d,c){this.getViewport().reset();this.onFeatureTap("MainPage");console.log("Going back to HomePage ...");},onTabBarTabChange:function(b,d,c,a){if(d){d.setActive(false);}if(c){c.setActive(false);}return false;},onPush:function(a,b){},init:function(a){this.callParent(arguments);console.log("Viewport Init");},openMainPage:function(){if(!this.loggedIn){Ext.StoreMgr.get("AccountsStore").load({callback:function(){this.onFeatureTap("MainPage");this.loggedIn=true;},scope:this});}}});Ext.define("Genesis.controller.MainPage",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{mainPage_path:"/mainPage",loginPage_path:"/loginPage"},xtype:"mainPageCntlr",models:["frontend.MainPage","EligibleReward","Customer","User"],config:{refs:{login:{selector:"loginPageview",autoCreate:true,xtype:"loginpageview"},main:{selector:"mainpageview",autoCreate:true,xtype:"mainpageview"}},control:{loginPageview:{select:"onLoginItemSelect"},"mainpageview dataview":{select:"onItemSelect",itemtouchstart:"onItemTouchStart",itemtouchend:"onItemTouchEnd"},mainpageview:{activate:"onActivate",deactivate:"onDeactivate"}}},init:function(a){this.callParent(arguments);Ext.regStore("MainPageStore",{model:"Genesis.model.frontend.MainPage",autoLoad:true});Ext.regStore("UserStore",{model:"Genesis.model.User",autoLoad:false});Ext.regStore("CustomerStore",{model:"Genesis.model.Customer",autoLoad:true});Ext.regStore("VenueStore",{model:"Genesis.model.Venue",autoLoad:false});Ext.regStore("EligibleRewardsStore",{model:"Genesis.model.EligibleReward",autoLoad:false});console.log("MainPage Init");},onItemSelect:function(f,b,c){f.deselect([b],false);console.log("Controller=["+b.data.pageCntlr+"]");var a=this.getApplication().getController(b.get("pageCntlr"));var e=a.isOpenAllowed();if(e===true){if(b.get("subFeature")){a.openPage(b.get("subFeature"));}else{a.openMainPage();}}else{Ext.Msg.alert("",e);}return false;},onItemTouchStart:function(g,a,f,c,b){},onItemTouchEnd:function(g,a,f,c,b){},onActivate:function(d,b){var a=this.getViewport().getCheckinInfo().venueId>0;this.getMain().query("tabbar[cls=navigationBarBottom]")[0][a?"show":"hide"]();},onDeactivate:function(b,a){},onLoginItemSelect:function(c,a,b){c.deselect([a]);return false;},getMainPage:function(){return this.getMain();},openMainPage:function(){var a=this.getViewPortCntlr();this.pushView(this.getMainPage());if(!a.loggedIn){this.getViewport().getNavigationBar().getBackButton().hide();}console.log("MainPage Opened");},isOpenAllowed:function(){return true;}});Ext.define("Genesis.controller.Checkins",{extend:"Genesis.controller.ControllerBase",statics:{checkin_path:"/checkin",googleMapStaticUrl:"http://maps.googleapis.com/maps/api/staticmap"},xtype:"checkinsCntlr",config:{refs:{explore:{selector:"checkinexploreview",autoCreate:true,xtype:"checkinexploreview"},checkinMerchant:{selector:"checkinmerchantview",autoCreate:true,xtype:"checkinmerchantview"}},control:{checkinexploreview:{activate:"onExploreActivate",deactivate:"onExploreDeactivate"},"checkinexploreview button[tag=checkInNow]":{tap:"onCheckinNowTap"},"checkinexploreview list":{select:"onExploreSelect",disclose:"onExploreDisclose"},checkinmerchantview:{activate:"onActivate",deactivate:"onDeactivate"},"checkinmerchantview button[tag=checkinBtn]":{tap:"onCheckinTap"},"checkinmerchantview button[tag=exploreBtn]":{tap:"onNonCheckinTap"},"checkinmerchantview map":{maprender:"onMapRender"},"checkinmerchantview component[tag=map]":{widthchange:"onMapWidthChange"}}},models:["Venue","Merchant"],init:function(){this.markersArray=[];if(window.google&&window.google.maps&&window.google.maps.Map){google.maps.Map.prototype.clearOverlays=Ext.bind(function(){if(this.markersArray){for(var a=0;a<this.markersArray.length;a++){this.markersArray[a].setMap(null);}}},this);}else{console.log("Google Maps API cannot be instantiated");}Ext.regStore("CheckinExploreStore",{model:"Genesis.model.Venue",autoLoad:false});console.log("Checkins Init");},onCheckInScanNow:function(h,d,f,i,c,a,g,k){c=c||"checkin";a=a||"setVenueCheckinUrl";g=g||"scan";var j;switch(g){case"scan":this.scanQRCode({callback:Ext.bind(function(b){if(b){var e=b.responseCode;console.log("response - "+b);this.getGeoLocation(Ext.bind(function(l){this.onCheckinCommonTap(h,d,f,c,a,e,l,k);},this));}else{console.log("No QR Code Scanned!");Ext.Msg.alert("","No QR Code Scanned!");}},this)});break;default:this.onCheckinCommonTap(h,d,f,c,a,"",null,k);break;}},setupVenueInfo:function(a){var b=Ext.StoreMgr.get("CustomerStore");var c=Ext.StoreMgr.get("VenueStore");b.clearFilter();c.setData([a],{addRecords:false});this.setVenueInfo(a.getId(),b.getById(a.getMerchant().getId()).get("user_id"));},onExploreActivate:function(){Ext.StoreMgr.get("CheckinExploreStore").load();},onExploreDeactivate:function(){},onExploreSelect:function(c,a,b){c.deselect([a]);this.onExploreDisclose(c,a);return false;},onExploreDisclose:function(d,a,h,b,g,c){var f=(window.google&&window.google.maps&&window.google.maps.LatLng)?window.google.maps:null;this.latLng=a.get("latitude")+","+a.get("longtitude");this.markerOptions={center:this.latLng,title:a.get("name")};console.log("Cannot Retrieve Google Map Information.");this.setupVenueInfo(a);this.pushView(this.getCheckinMerchant());return true;},onCheckinNowTap:function(a,d,c){Ext.Msg.alert("","Scan QRCode && Check into Venue");},setVenueInfo:function(c,b){var a=this.getCheckinMerchant();a.venueId=c;a.customerId=b;},clearVenueInfo:function(){var a=this.getCheckinMerchant();delete a.venueId;delete a.customerId;},onActivateCommon:function(c,a){var b=(window.google&&window.google.maps&&window.google.maps.Marker)?window.google.maps:null;if(a&&b){c.getMap().clearOverlays();this.marker=new b.Marker(Ext.apply(this.markerOptions,{map:a}));c.setMapCenter(this.latLng);}else{if(!b){console.log("Cannot load Google Maps");}}},onActivate:function(){var a=this.getCheckinMerchant();var b=a.query("component[tag=map]")[0];this.onActivateCommon(b,null);},onDeactivate:function(){var b=this.getCheckinMerchant();var c=this.getViewport().getVenueId();if((c!=b.venueId)&&(c>0)){var a=Ext.StoreMgr.get("VenueStore");var d=Ext.StoreMgr.get("CheckinExploreStore");a.setData([d.getById(c)],{addRecords:false});}this.clearVenueInfo();},onCheckinCommonTap:function(m,j,k,f,a,o,d,p){var g,i;if(d){g=d.coords.latitude;i=d.coords.longitude;}var l=this.getCheckinMerchant();var h=this.getViewport();var c=this.getApplication().getController("Merchants");var n=Ext.StoreMgr.get("EligibleRewardsStore");n.removeAll();n.clearFilter();EligibleReward[a]();n.load({parms:{latitude:g||0,longtitude:i||0,qrcode:o||"",customerId:l.customerId},scope:this,callback:function(e,b,r){if(r){h.setVenueId(l.venueId);h.setCustomerId(l.customerId);for(var q=0;q<e.length;q++){e[q].data.venue_id=l.venueId;}n.filter([{filterFn:Ext.bind(function(s){return s.get("venue_id")==l.venueId;},this)}]);switch(f){case"checkin":h.setCheckinInfo({venueId:l.venueId,customerId:l.customerId});break;default:break;}h.reset();c.openMainPage();switch(f){case"toMain":this.clearVenueInfo();break;default:break;}if(p){p();}}else{Ext.Msg.alert("Error","Cannot log into Venue");}}});},onCheckinTap:function(a,d,c,f,g){this.onCheckInScanNow(a,d,c,f,"checkin","setVenueCheckinUrl","scan",g);},onNonCheckinTap:function(a,d,c,f,g){this.onCheckInScanNow(a,d,c,f,"explore","setVenueExploreUrl","noscan",g);},onMapRender:function(c,b,a){this.onActivateCommon(c,b);},onMapWidthChange:function(f,e,b,d){var c=f.element.getSize();var a=Ext.String.urlAppend(this.self.googleMapStaticUrl,Ext.Object.toQueryString(Ext.apply({zoom:15,sensor:false,size:c.width+"x"+c.height,markers:"color:blue|label:S|"+this.latLng},this.markerOptions)));f.setData({width:c.width,height:c.height,photo:a});},getMainPage:function(){return this.getExplore();},openMainPage:function(){var b=this.getMainPage();var a=b.query("list")[0].getPlugins()[0];a.refreshFn=a.getRefreshFn();this.pushView(b);console.log("Checkin Explore Opened");},isOpenAllowed:function(){return true;}});Ext.define("Genesis.controller.Challenges",{extend:"Genesis.controller.ControllerBase",statics:{challenges_path:"/challenges"},xtype:"challengesCntlr",config:{refs:{challengeBtn:"button[iconCls=challenge]",challengePage:{selector:"challengepageview",autoCreate:true,xtype:"challengepageview"}},control:{challengepageview:{activate:"onActivate",deactivate:"onDeactivate"},"challengepageview > dataview":{select:"onItemSelect"},"challengepageview tabbar button[iconCls=doit]":{tap:"onChallengeBtnTap"}}},model:["Challenge"],init:function(a){this.callParent(arguments);Ext.regStore("ChallengePageStore",{model:"Genesis.model.Challenge",autoLoad:false});console.log("Challenge Init");},onItemSelect:function(f,a,c){f.deselect([a],false);var e=this.getChallengePage().query("container[docked=bottom][xtype=container]")[0];for(var b=0;b<e.getItems().length;b++){e.getItems().getAt(b).updateData(a.getData());}return true;},onItemTouchStart:function(g,a,f,c,b){Ext.fly(Ext.query("#"+f.id+" div.photo")[0]).mask();},onItemTouchEnd:function(g,a,f,c,b){Ext.fly(Ext.query("#"+f.id+" div.photo")[0]).unmask();},onChallengeBtnTap:function(g,a,f,c,b){},onActivate:function(){var b=this.getViewport().getVenueId();var a=Ext.StoreMgr.get("VenueStore").getById(b);Ext.StoreMgr.get("ChallengePageStore").setData(a.challenges().getRange());},onDeactivate:function(){},getMainPage:function(){return this.getChallengePage();},openMainPage:function(){this.pushView(this.getMainPage());console.log("ChallengePage Opened");},isOpenAllowed:function(){return((this.getViewport().getVenueId()>0)?true:"Cannot open Challenges until You have Checked-in into a Venue");}});Ext.define("Genesis.controller.Merchants",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{merchantMain_path:"/merchantMain",merchant_path:"/merchant"},xtype:"merchantsCntlr",config:{refs:{page:{selector:"merchantaccountpageview",autoCreate:true,xtype:"merchantaccountpageview"},explore:{selector:"merchantaccountexploreview",autoCreate:true,xtype:"merchantaccountexploreview"},main:{selector:"merchantaccountview",autoCreate:true,xtype:"merchantaccountview"}},control:{merchantaccountview:{activate:"onMainActivate"},"merchantaccountview button[ui=yellow]":{tap:"onMerchantAccountRewardsTap"},"merchantaccountview list":{select:"onMainSelect",disclose:"onMainDisclose"}}},init:function(){this.callParent(arguments);console.log("Merchants Init");},onMainActivate:function(){var f=this.getViewport();var g=this.getMain();var j=f.getCustomerId();var a=f.getVenueId();var c=Ext.StoreMgr.get("CustomerStore");var e=Ext.StoreMgr.get("VenueStore").getById(a);var i=e.getMerchant().getId();var b=c.getById(i);this.setCustomerStoreFilter(j,i);g.query("component[tag=photo]")[0].setData({photoUrl:e.getMerchant().data.photo_url});g.query("formpanel")[0].setValues({lastCheckin:b.getLastCheckin().data.time,regMembers:0,ptsEarn:0,ptsSpent:0,ptsAvail:b.get("points")});var d=f.getCheckinInfo().venueId;var h=(a!=d)&&(d>0);f.query("button[tag=main]")[0][h?"show":"hide"]();},onMainDisclose:function(d,a,g,b,f,c){},onMainSelect:function(c,a,b){c.deselect([a]);this.onMainDisclose(c,a);return false;},getMainPage:function(){var a=(this.getViewport().getCustomerId()>0);return this[a?"getMain":"getPage"]();},openMainPage:function(){this.pushView(this.getMainPage());console.log("Merchant Account Opened");}});Ext.define("Genesis.controller.RewardsRedemptions",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{rewards_path:"/rewards",redemption_path:"/redemption"},xtype:"rewardsRedemptionsCntlr",models:["frontend.RewardsMainTemplate","frontend.CustomerVenue","PurchaseReward","CustomerReward"],config:{refs:{rewards:{selector:"rewardsview",autoCreate:true,xtype:"rewardsview"},redemptions:{selector:"redemptionsview",autoCreate:true,xtype:"redemptionsview"}},control:{}},init:function(){Ext.regStore("RewardsRedemptionsStore",{model:"Genesis.model.frontend.CustomerVenue",autoLoad:false});this.initRewards();this.initRedemptions();console.log("Rewards & Redemptions Init");},initRewards:function(){this.control({rewardsview:{activate:this.onRewardsActivate,deactivate:this.onRewardsDeactivate},"rewardsview list":{select:this.onRewardsItemSelect},"rewardsview button[tag=cart]":{tap:this.onRewardsShopCartTap},"rewardsview button[text=Edit]":{tap:this.onRewardsCartEditTap},"rewardsview button[text=Done]":{tap:this.onRewardsCartDoneTap},"rewardsview dataview[tag=rewardsCart] rewardscartitem button[iconCls=delete_black2]":{tap:this.onRewardsCartItemDeleteTap},"rewardsview dataview[tag=rewardsCart] rewardscartitem selectfield":{change:this.onRewardsCartItemSelectChange},"rewardsview container[tag=rewardTallyList] button[tag=earnPts]":{tap:this.onRewardsEarnPtsTap},"checkinmerchantview button[tag=checkinBtn]":{tap:this.onCheckInTap}});Ext.regStore("RewardsStore",{model:"Genesis.model.PurchaseReward",config:{autoLoad:false},grouper:{groupFn:function(a){return a.get("points")+" Points";}},sorters:[{property:"points",direction:"ASC"}]});Ext.regStore("RewardsCartStore",{model:"Genesis.model.PurchaseReward",config:{autoLoad:false},proxy:{type:"memory"}});},initRedemptions:function(){this.control({redemptionsview:{activate:this.onRedemptionsActivate,deactivate:this.onRedemptionsDeactivate},"redemptionsview dataview[tag=redemptionsDataview]":{select:this.onRedemptionsItemSelect,},"redemptionsview list[tag=redemptionsList]":{select:this.onRedemptionsItemListSelect},"redemptionsview segmentedbutton[tag=redemptions]":{toggle:this.onRedemptionsViewToggle},"redemptionsview button[tag=redeem]":{tap:this.onRedemptionsItemTap}});Ext.regStore("RedemptionsStore",{model:"Genesis.model.CustomerReward",autoLoad:false,grouper:{groupFn:function(a){return a.get("points")+" Points";}},sorters:[{property:"points",direction:"ASC"}]});},onMainActivate:function(){var f=this.getViewport().getVenueId();var c=this.getViewport().getCustomerId();var a=Ext.StoreMgr.get("CustomerStore");var d=Ext.StoreMgr.get("VenueStore").getById(f);var e=d.getMerchant().getId();this.setCustomerStoreFilter(c,e);var b=a.getById(e);Ext.StoreMgr.get("RewardsRedemptionsStore").setData([{customer:b.raw,venue:d.raw}]);},getRewardsCart:function(){return this.getRewards().query("dataview[tag=rewardsCart]")[0];},getEarnPtsBtn:function(){return this.getRewards().query("button[tag=cart]")[0];},onRewardsActivate:function(h,d,n,e){var f=this.getViewport();var a=f.getVenueId();var m=f.getCustomerId();var b=Ext.StoreMgr.get("CustomerStore");var o=Ext.StoreMgr.get("VenueStore");var i=Ext.StoreMgr.get("RewardsStore");var g=o.getById(a);var l=g.getMerchant().getId();this.setCustomerStoreFilter(m,l);var k=b.getById(l);i.clearFilter();i.load({parms:{venue_id:a,},scope:this,callback:function(p,c,r){if(r){for(var q=0;q<p.length;q++){p[q].data.merchant_id=l;}i.filter([{filterFn:Ext.bind(function(s){return s.get("merchant_id")==l;},this)}]);this.exploreMode=f.getCheckinInfo().venueId!=a;}else{}}});var j=f.getCheckinInfo().venueId==a;this.getRewards().query("tabbar[cls=navigationBarBottom]")[0][j?"show":"hide"]();},onRewardsDeactivate:function(g,e,b,d){var a=this.getRewards().query("container[tag=rewards]")[0];if(a){var f=a.getActiveItem();switch(f.config.tag){case"rewardTallyList":this.onRewardsShopCartTap(null,null,null);break;}}},onRewardsShopCartTap:function(a,h,d){var g=this.getEarnPtsBtn();g.updateActive(false);var c=this.getRewards().query("container[tag=rewards]")[0];var i=c.getActiveItem();var f=c.getLayout().getAnimation();switch(i.config.tag){case"rewardMainList":g.setTitle("Order Menu");f.setReverse(false);c.setActiveItem(1);break;case"rewardTallyList":g.setTitle("Check Out");f.setReverse(true);c.setActiveItem(0);break;}return true;},onRewardsEarnPtsTap:function(a,d,c){this.scanQRCode({callback:Ext.bind(function(b){if(b){console.log("response - "+b);}else{console.log("response - NONE");}},this)});},onRewardsItemSelect:function(g,b,f){if(!this.exploreMode){var a=this.getRewardsCart();var d=a.getStore();var e=d.indexOf(b);var c;if(e<0){b.getData().qty=1;d.add(b);}else{b.set("qty",b.get("qty")+1);a.getViewItems()[e].updateRecord(b);}this.updateRewardsCartTotal(d.getRange());}else{Ext.Msg.alert("","You need to Check-In first before you are elibigle for rewards");}g.deselect([b]);return false;},onRewardsCartEditTap:function(a,f,c){a.hide();Ext.ComponentQuery.query("button[text=Done]")[0].show();var d=Ext.ComponentQuery.query("rewardscartitem button[iconCls=delete_black2]");var g=Ext.ComponentQuery.query("rewardscartitem component[cls=points]");Ext.each(d,function(b){b.show();});Ext.each(g,function(b){b.hide();});},onRewardsCartDoneTap:function(a,f,c){a.hide();Ext.ComponentQuery.query(" button[text=Edit]")[0].show();var d=Ext.ComponentQuery.query("rewardscartitem button[iconCls=delete_black2]");var g=Ext.ComponentQuery.query("rewardscartitem component[cls=points]");Ext.each(d,function(b){b.hide();});Ext.each(g,function(b){b.show();});},onRewardsCartItemDeleteTap:function(a,i,g){var h=a.up("rewardscartitem");var j=this.getRewardsCart();var f=j.getViewItems().indexOf(h);var c=j.getStore().getAt(f);var d=j.getStore();d.remove(c);this.updateRewardsCartTotal(d.getRange());},updateRewardsCartTotal:function(b){var d=this.getRewards().query("component[tag=total]")[0],a=0;for(var c=0;c<b.length;c++){a+=b[c].get("qty")*b[c].get("points");}if(d){d.setData({points:a});}},onRewardsCartItemSelectChange:function(g,h,c,d){var e=g.up("rewardscartitem");var i=this.getRewardsCart();var b=i.getViewItems().indexOf(e);var a=i.getStore().getAt(b);a.set("qty",h.get(g.getValueField()));e.updateRecord(a);this.updateRewardsCartTotal(i.getStore().getRange());return true;},onCheckInTap:function(c,f,d){var a=Ext.StoreMgr.get("RewardsCartStore");if(a){a.removeAll();}this.updateRewardsCartTotal([]);},getLists:function(){var a=this.getRedemptions().query("dataview[tag=redemptionsDataview]")[0];var b=this.getRedemptions().query("list[tag=redemptionsList]")[0];return({dataview:a,list:b});},onRedemptionsActivate:function(){var b=this.getViewport();var h=b.getVenueId();var e=b.getCustomerId();var c=Ext.StoreMgr.get("CustomerStore");var f=Ext.StoreMgr.get("VenueStore").getById(h);var g=f.getMerchant().getId();var a=Ext.StoreMgr.get("RedemptionsStore");this.setCustomerStoreFilter(e,g);var d=c.getById(g);a.clearFilter();a.load({parms:{venue_id:h},scope:this,callback:function(k,j,n){if(n){for(var m=0;m<k.length;m++){k[m].data.venue_id=h;}a.filter([{filterFn:Ext.bind(function(i){return i.get("venue_id")==h;},this)}]);this.exploreMode=b.getCheckinInfo().venueId!=h;var o=this.getRedemptions().query("segmentedbutton")[0];var l=o.query("button[tag=detailed]")[0];o.setPressedButtons([l]);this.onRedemptionsViewToggle(null,l,true);}else{}}});},onRedemptionsDeactivate:function(){},onRedemptionsItemSelect:function(e,a,b){var c=this.getRedemptions();c.query("component[tag=points]")[0].setData({points:a.get("points")});c.query("component[tag=desc]")[0].setData({title:a.get("title")});return true;},onRedemptionsItemTap:function(c,f,d){var a=this.getLists();if(!this.exploreMode){this.scanQRCode({callback:Ext.bind(function(b){if(b){console.log("response - "+b);}else{console.log("Failed to get QR Code from Scanner");Ext.Msg.alert("","Failed to get QR Code from Scanner");}},this)});}else{Ext.Msg.alert("","You need to Check-In first before you are elibigle for redemptions");}},onRedemptionsItemListSelect:function(d,b,c){var a=this.getLists();d.deselect([b]);a.dataview.select([b]);if(!this.exploreMode){Ext.Msg.alert("","Show QR Code Scanner");}else{Ext.Msg.alert("","You need to Check-In first before you are elibigle for redemptions");}return false;},onRedemptionsViewToggle:function(s,a,b){if(b){var g=this.getRedemptions().query("container[tag=redemptionsView]")[0];var t=this.getLists();var o=t.dataview;var q=t.list;var p,r,h;var k=0;var d=o.getSelection()[0];switch(a.config.tag){case"detailed":h=this.getRedemptions().query("container[tag=redemptionsDataviewWrapper]")[0];var l=h.getItems();g.setActiveItem(0);for(var n=0;n<l.length;n++){k+=l.get(n).element.getHeight()+l.get(n).element.getMargin("tb");}break;case"summary":h=q;g.setActiveItem(1);k=Ext.fly(h.element.query(".x-list")[0]).getHeight();break;}h.setHeight(k);g.setHeight(k);switch(a.config.tag){case"detailed":if(o.getSelection().length>0){if(o.getScrollable()){p=o.getScrollable().getScroller();r=o.getViewItems()[o.getStore().indexOf(d)];p.stopAnimation();var m=p.getContainerSize().x,j=p.getSize().x,f=j-m,e=(r.offsetLeft>f)?f:r.offsetLeft;p.scrollTo(e,0);}}break;case"summary":if(o.getSelection().length>0){p=this.getRedemptions().getScrollable().getScroller();r=q.getViewItems()[o.getStore().indexOf(d)];p.stopAnimation();var m=p.getContainerSize().y,j=p.getSize().y,f=j-m,e=(r.offsetTop>f)?f:r.offsetTop;p.scrollTo(0,e);}break;}}return true;},onRedemptionsItemScrollStart:function(){var a=this.getRedemptions().getScrollable().getScroller();a.setDisabled(true);},onRedemptionsItemScrollEnd:function(){var a=this.getRedemptions().getScrollable().getScroller();a.setDisabled(false);},getMainPage:function(){return this.getRewards();},openPage:function(a){this.onMainActivate();var c;switch(a){case"rewards":c=this.getRewards();break;case"redemptions":c=this.getRedemptions();if(!this.initReedeem){var b=c.query("dataview[tag=redemptionsDataview]")[0].getScrollable();b.getScroller().on({scope:this,scrollstart:"onRedemptionsItemScrollStart",scrollend:"onRedemptionsItemScrollEnd"});this.initReedeem=true;}break;}this.pushView(c);},isOpenAllowed:function(){return((this.getViewport().getVenueId()>0)?true:"You need to Explore or Check-in to a Venue first");}});Ext.define("Genesis.controller.Accounts",{extend:"Genesis.controller.ControllerBase",requires:["Ext.data.Store"],statics:{checkin_path:"/checkin"},xtype:"accountsCntlr",config:{refs:{accounts:{selector:"accountsview",autoCreate:true,xtype:"accountsview"}},control:{accountsview:{activate:"onActivate",deactivate:"onDeactivate"},"accountsview list":{select:"onSelect",disclose:"onDisclose"},"accountsview tabbar segmentedbutton[tag=accounts]":{toggle:"onViewToggle"}}},models:["Venue","Merchant"],init:function(){this.callParent(arguments);Ext.StoreMgr.get("AccountsStore").sort("sort_id","DESC");console.log("Accounts Init");},onActivate:function(){if(!this.loaded){this.loadAccounts();}var a=this.getViewport().query("segmentedbutton[tag=accounts]")[0];a.show();},onDeactivate:function(){var a=this.getViewport().query("segmentedbutton[tag=accounts]")[0];a.hide();},onSelect:function(c,a,b){c.deselect([a]);this.onDisclose(c,a);return false;},onDisclose:function(f,b,h,c,g,d){var a=this.getApplication().getController("Checkins");a.onExploreDisclose(f,b,h,c,g,d);return true;},onViewToggle:function(b,d,e){if(e){var a=this.getAccounts().query("container[tag=accountsSelection]")[0];var c=Ext.StoreMgr.get("AccountsStore");switch(d.config.tag){case"usage":c.sort("sort_id","ASC");a.setActiveItem(0);break;case"alphabetical":c.sort("name","ASC");a.setActiveItem(1);break;}}return true;},loadAccounts:function(){var a=1;Ext.StoreMgr.get("AccountsStore").load({parms:{user_id:a,},scope:this,callback:function(c,b,e){if(e){for(var d=0;d<c.length;d++){c[d].data.sort_id=d;}this.loaded=true;}else{}}});},getMainPage:function(){return this.getAccounts();},openMainPage:function(){this.pushView(this.getMainPage());console.log("Accounts Page Opened");},isOpenAllowed:function(){return true;}});