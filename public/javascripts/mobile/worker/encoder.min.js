if(typeof(importScripts)!="undefined"){if(location.href.match("testing")){prefix="..";}else{if(location.href.match(/mobileCilent/i)){prefix="../..";}else{prefix="/";}}importScripts(prefix+"lib/libmp3lame.min.js");}else{}var encoder_mp3codec=null;var encoder_init=function(a,b){var d,c=function(){if(typeof(Lame)!="undefined"){encoder_mp3codec=Lame.init();Lame.set_mode(encoder_mp3codec,a.mode||Lame.JOINT_STEREO);Lame.set_num_channels(encoder_mp3codec,a.channels||2);Lame.set_out_samplerate(encoder_mp3codec,a.samplerate||44100);Lame.set_bitrate(encoder_mp3codec,a.bitrate||128);Lame.init_params(encoder_mp3codec);b.postMessage({cmd:"init"});clearInterval(d);}};if(!a){a={};}d=setInterval(c,0.1*1000);};var encoder_encode=function(a,c){var b=Lame.encode_buffer_ieee_float(encoder_mp3codec,a,[]);c.postMessage({cmd:"data",buf:b.data});};var encoder_finish=function(b){var a=Lame.encode_flush(encoder_mp3codec);b.postMessage({cmd:"end",buf:a.data});Lame.close(encoder_mp3codec);encoder_mp3codec=null;};if((typeof(Worker)=="undefined")&&(typeof(Ext)!="undefined")){Ext.define("Worker",{constructor:function(a){var b=this;b.responseHandler={postMessage:function(c){b.onmessage({data:c});}};},postMessage:function(a){switch(a.cmd){case"init":encoder_init(a.config,this.responseHandler);break;case"encode":encoder_encode(a.buf,this.responseHandler);break;case"finish":encoder_finish(this.responseHandler);break;}},onmessage:Ext.emptyFn});}else{onmessage=function(b){var a=b.data;switch(a.cmd){case"init":encoder_init(a.config,self);break;case"encode":encoder_encode(a.buf,self);break;case"finish":encoder_finish(self);break;}};}